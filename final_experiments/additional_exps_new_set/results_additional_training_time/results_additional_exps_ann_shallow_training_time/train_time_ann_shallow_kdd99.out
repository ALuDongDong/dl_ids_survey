Using TensorFlow backend.
/home/sunanda/anaconda3/envs/ml_env_cpu/lib/python3.7/site-packages/tensorflow/python/framework/dtypes.py:526: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/sunanda/anaconda3/envs/ml_env_cpu/lib/python3.7/site-packages/tensorflow/python/framework/dtypes.py:527: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/sunanda/anaconda3/envs/ml_env_cpu/lib/python3.7/site-packages/tensorflow/python/framework/dtypes.py:528: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/sunanda/anaconda3/envs/ml_env_cpu/lib/python3.7/site-packages/tensorflow/python/framework/dtypes.py:529: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/sunanda/anaconda3/envs/ml_env_cpu/lib/python3.7/site-packages/tensorflow/python/framework/dtypes.py:530: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/sunanda/anaconda3/envs/ml_env_cpu/lib/python3.7/site-packages/tensorflow/python/framework/dtypes.py:535: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
2020-01-15 00:09:18,413 [INFO] Read 3 experiments from file: experiment_specs/additional_exps/training_time/train_time_ann.csv
2020-01-15 00:09:18,413 [INFO] ================= Started running experiments ================= 

2020-01-15 00:09:18,414 [INFO] Created directory: results_additional_exps/train_time_kdd99_ann_shallow_rep1
2020-01-15 00:09:18,414 [INFO] Initialized logging. log_filename = results_additional_exps/train_time_kdd99_ann_shallow_rep1/run_log.log
2020-01-15 00:09:18,414 [INFO] ================= Running experiment no. 1  ================= 

2020-01-15 00:09:18,414 [INFO] Experiment parameters given below
2020-01-15 00:09:18,414 [INFO] 
{'experiment_num': 1, 'results_dir': 'results_additional_exps/train_time_kdd99_ann_shallow_rep1', 'model_type': 'classifier', 'model': 'ann', 'normal_label': 'normal', 'training_data_feed': 'preload', 'scaling_type': 'NA', 'ann_layer_units': [256], 'ann_layer_activations': ['relu'], 'ann_layer_dropout_rates': [0.2], 'epochs': 100, 'early_stop_patience': 100, 'batch_size': 256, 'goal_metric': 0.921328918, 'training_set': 'train_set_only', 'dataset_dir': '../Datasets/full_datasets/kdd99_five_classes', 'description': 'train_time_kdd99_ann_shallow_rep1'}
2020-01-15 00:09:18,414 [INFO] Created tensorboard log directory: results_additional_exps/train_time_kdd99_ann_shallow_rep1/tf_logs_run_2020_01_15-00_09_18
2020-01-15 00:09:18,414 [INFO] Loading datsets from: ../Datasets/full_datasets/kdd99_five_classes
2020-01-15 00:09:18,415 [INFO] Reading X, y files
2020-01-15 00:09:18,415 [INFO] Reading HDF dataset ../Datasets/full_datasets/kdd99_five_classes/X_train.h5
2020-01-15 00:09:18,424 [INFO] NumExpr defaulting to 8 threads.
2020-01-15 00:09:24,850 [INFO] Reading complete. time_to_read=6.44 seconds
2020-01-15 00:09:24,850 [INFO] Reading HDF dataset ../Datasets/full_datasets/kdd99_five_classes/X_val.h5
2020-01-15 00:09:26,475 [INFO] Reading complete. time_to_read=1.62 seconds
2020-01-15 00:09:26,475 [INFO] Reading HDF dataset ../Datasets/full_datasets/kdd99_five_classes/X_test.h5
2020-01-15 00:09:26,929 [INFO] Reading complete. time_to_read=0.45 seconds
2020-01-15 00:09:26,929 [INFO] Reading HDF dataset ../Datasets/full_datasets/kdd99_five_classes/y_train.h5
2020-01-15 00:09:27,150 [INFO] Reading complete. time_to_read=0.22 seconds
2020-01-15 00:09:27,150 [INFO] Reading HDF dataset ../Datasets/full_datasets/kdd99_five_classes/y_val.h5
2020-01-15 00:09:27,205 [INFO] Reading complete. time_to_read=0.06 seconds
2020-01-15 00:09:27,205 [INFO] Reading HDF dataset ../Datasets/full_datasets/kdd99_five_classes/y_test.h5
2020-01-15 00:09:27,224 [INFO] Reading complete. time_to_read=0.02 seconds
OMP: Info #212: KMP_AFFINITY: decoding x2APIC ids.
OMP: Info #210: KMP_AFFINITY: Affinity capable, using global cpuid leaf 11 info
OMP: Info #154: KMP_AFFINITY: Initial OS proc set respected: 0-7
OMP: Info #156: KMP_AFFINITY: 8 available OS procs
OMP: Info #157: KMP_AFFINITY: Uniform topology
OMP: Info #179: KMP_AFFINITY: 1 packages x 4 cores/pkg x 2 threads/core (4 total cores)
OMP: Info #214: KMP_AFFINITY: OS proc to physical thread map:
OMP: Info #171: KMP_AFFINITY: OS proc 0 maps to package 0 core 0 thread 0 
OMP: Info #171: KMP_AFFINITY: OS proc 4 maps to package 0 core 0 thread 1 
OMP: Info #171: KMP_AFFINITY: OS proc 1 maps to package 0 core 1 thread 0 
OMP: Info #171: KMP_AFFINITY: OS proc 5 maps to package 0 core 1 thread 1 
OMP: Info #171: KMP_AFFINITY: OS proc 2 maps to package 0 core 2 thread 0 
OMP: Info #171: KMP_AFFINITY: OS proc 6 maps to package 0 core 2 thread 1 
OMP: Info #171: KMP_AFFINITY: OS proc 3 maps to package 0 core 3 thread 0 
OMP: Info #171: KMP_AFFINITY: OS proc 7 maps to package 0 core 3 thread 1 
OMP: Info #250: KMP_AFFINITY: pid 32617 tid 32617 thread 0 bound to OS proc set 0
OMP: Info #250: KMP_AFFINITY: pid 32617 tid 32628 thread 1 bound to OS proc set 1
OMP: Info #250: KMP_AFFINITY: pid 32617 tid 32629 thread 2 bound to OS proc set 2
OMP: Info #250: KMP_AFFINITY: pid 32617 tid 32630 thread 3 bound to OS proc set 3
2020-01-15 00:09:34,445 [INFO] Initializing model
WARNING:tensorflow:From /home/sunanda/anaconda3/envs/ml_env_cpu/lib/python3.7/site-packages/tensorflow/python/framework/op_def_library.py:263: colocate_with (from tensorflow.python.framework.ops) is deprecated and will be removed in a future version.
Instructions for updating:
Colocations handled automatically by placer.
2020-01-15 00:09:34,459 [WARNING] From /home/sunanda/anaconda3/envs/ml_env_cpu/lib/python3.7/site-packages/tensorflow/python/framework/op_def_library.py:263: colocate_with (from tensorflow.python.framework.ops) is deprecated and will be removed in a future version.
Instructions for updating:
Colocations handled automatically by placer.
WARNING:tensorflow:From /home/sunanda/anaconda3/envs/ml_env_cpu/lib/python3.7/site-packages/keras/backend/tensorflow_backend.py:3445: calling dropout (from tensorflow.python.ops.nn_ops) with keep_prob is deprecated and will be removed in a future version.
Instructions for updating:
Please use `rate` instead of `keep_prob`. Rate should be set to `rate = 1 - keep_prob`.
2020-01-15 00:09:34,537 [WARNING] From /home/sunanda/anaconda3/envs/ml_env_cpu/lib/python3.7/site-packages/keras/backend/tensorflow_backend.py:3445: calling dropout (from tensorflow.python.ops.nn_ops) with keep_prob is deprecated and will be removed in a future version.
Instructions for updating:
Please use `rate` instead of `keep_prob`. Rate should be set to `rate = 1 - keep_prob`.
2020-01-15 00:09:34,579 [INFO] _________________________________________________________________
2020-01-15 00:09:34,579 [INFO] Layer (type)                 Output Shape              Param #   
2020-01-15 00:09:34,580 [INFO] =================================================================
2020-01-15 00:09:34,580 [INFO] dense_1 (Dense)              (None, 256)               31744     
2020-01-15 00:09:34,580 [INFO] _________________________________________________________________
2020-01-15 00:09:34,580 [INFO] batch_normalization_1 (Batch (None, 256)               1024      
2020-01-15 00:09:34,580 [INFO] _________________________________________________________________
2020-01-15 00:09:34,580 [INFO] dropout_1 (Dropout)          (None, 256)               0         
2020-01-15 00:09:34,580 [INFO] _________________________________________________________________
2020-01-15 00:09:34,580 [INFO] dense_2 (Dense)              (None, 5)                 1285      
2020-01-15 00:09:34,580 [INFO] =================================================================
2020-01-15 00:09:34,580 [INFO] Total params: 34,053
2020-01-15 00:09:34,580 [INFO] Trainable params: 33,541
2020-01-15 00:09:34,581 [INFO] Non-trainable params: 512
2020-01-15 00:09:34,581 [INFO] _________________________________________________________________
2020-01-15 00:09:34,581 [INFO] Training model
WARNING:tensorflow:From /home/sunanda/anaconda3/envs/ml_env_cpu/lib/python3.7/site-packages/tensorflow/python/ops/math_ops.py:3066: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.cast instead.
2020-01-15 00:09:34,988 [WARNING] From /home/sunanda/anaconda3/envs/ml_env_cpu/lib/python3.7/site-packages/tensorflow/python/ops/math_ops.py:3066: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.cast instead.
2020-01-15 00:09:35.307961: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX
2020-01-15 00:09:35.327570: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 3701985000 Hz
2020-01-15 00:09:35.327708: I tensorflow/compiler/xla/service/service.cc:150] XLA service 0x55ee495601e0 executing computations on platform Host. Devices:
2020-01-15 00:09:35.327729: I tensorflow/compiler/xla/service/service.cc:158]   StreamExecutor device (0): <undefined>, <undefined>
2020-01-15 00:09:35.327816: I tensorflow/core/common_runtime/process_util.cc:71] Creating new thread pool with default inter op setting: 2. Tune using inter_op_parallelism_threads for best performance.
OMP: Info #250: KMP_AFFINITY: pid 32617 tid 32643 thread 4 bound to OS proc set 4
OMP: Info #250: KMP_AFFINITY: pid 32617 tid 32662 thread 5 bound to OS proc set 5
OMP: Info #250: KMP_AFFINITY: pid 32617 tid 32663 thread 6 bound to OS proc set 6
OMP: Info #250: KMP_AFFINITY: pid 32617 tid 32664 thread 7 bound to OS proc set 7
OMP: Info #250: KMP_AFFINITY: pid 32617 tid 32665 thread 8 bound to OS proc set 0
OMP: Info #250: KMP_AFFINITY: pid 32617 tid 32644 thread 9 bound to OS proc set 1
OMP: Info #250: KMP_AFFINITY: pid 32617 tid 32666 thread 10 bound to OS proc set 2
OMP: Info #250: KMP_AFFINITY: pid 32617 tid 32668 thread 12 bound to OS proc set 4
OMP: Info #250: KMP_AFFINITY: pid 32617 tid 32667 thread 11 bound to OS proc set 3
OMP: Info #250: KMP_AFFINITY: pid 32617 tid 32670 thread 14 bound to OS proc set 6
OMP: Info #250: KMP_AFFINITY: pid 32617 tid 32669 thread 13 bound to OS proc set 5
OMP: Info #250: KMP_AFFINITY: pid 32617 tid 32672 thread 16 bound to OS proc set 0
OMP: Info #250: KMP_AFFINITY: pid 32617 tid 32671 thread 15 bound to OS proc set 7
Train on 3918744 samples, validate on 979687 samples
Epoch 1/100
 - 74s - loss: 0.0039 - val_loss: 0.0022
OMP: Info #250: KMP_AFFINITY: pid 32617 tid 32722 thread 17 bound to OS proc set 1
OMP: Info #250: KMP_AFFINITY: pid 32617 tid 32723 thread 18 bound to OS proc set 2
OMP: Info #250: KMP_AFFINITY: pid 32617 tid 32724 thread 19 bound to OS proc set 3
 - val_f1: 0.9994
 - out_of_sample_accuracy: 0.9181
Epoch 2/100
 - 72s - loss: 0.0020 - val_loss: 5.9264e-04
 - val_f1: 0.9997
 - out_of_sample_accuracy: 0.9211
Epoch 3/100
 - 72s - loss: 5.7666e-04 - val_loss: 4.9307e-04
/home/sunanda/anaconda3/envs/ml_env_cpu/lib/python3.7/site-packages/sklearn/metrics/classification.py:1437: UndefinedMetricWarning: F-score is ill-defined and being set to 0.0 in labels with no predicted samples.
  'precision', 'predicted', average, warn_for)
2020-01-15 00:14:22,121 [INFO] StopperOnGoal: reached goal_metric (accuracy). Stopping training. goal_metric = 0.9213, current_metric = 0.9233, num_epochs = 3
2020-01-15 00:14:22,122 [INFO] WeightRestorer::on_train_end(): restoring best weights
2020-01-15 00:16:01,049 [INFO] Last epoch loss evaluation: train_loss = 0.000440, val_loss = 0.000493
2020-01-15 00:16:01,049 [INFO] Training complete. time_to_train = 386.47 sec, 6.44 min
2020-01-15 00:16:01,128 [INFO] Model saved to results_additional_exps/train_time_kdd99_ann_shallow_rep1/best_model.pickle
2020-01-15 00:16:01,130 [INFO] Training history saved to: results_additional_exps/train_time_kdd99_ann_shallow_rep1/training_error_history.csv
2020-01-15 00:16:01,335 [INFO] Plot saved to: results_additional_exps/train_time_kdd99_ann_shallow_rep1/training_error_history.png
2020-01-15 00:16:01,523 [INFO] Plot saved to: results_additional_exps/train_time_kdd99_ann_shallow_rep1/training_f1_history.png
2020-01-15 00:16:01,523 [INFO] Making predictions on training, validation, testing data
2020-01-15 00:17:29,528 [INFO] Making predictions complete. time_to_predict = 88.00 sec, 1.47 min
2020-01-15 00:17:29,650 [INFO] Evaluating predictions (results)
/home/sunanda/anaconda3/envs/ml_env_cpu/lib/python3.7/site-packages/sklearn/metrics/classification.py:1437: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples.
  'precision', 'predicted', average, warn_for)
2020-01-15 00:17:38,513 [INFO] Dataset: Testing. Classification report below
2020-01-15 00:17:38,513 [INFO] 
              precision    recall  f1-score   support

         dos       1.00      0.97      0.99    229853
     normal.       0.73      0.98      0.84     60593
       probe       0.79      0.81      0.80      4166
         r2l       0.90      0.03      0.05     13781
         u2r       0.00      0.00      0.00      2636

    accuracy                           0.92    311029
   macro avg       0.68      0.56      0.53    311029
weighted avg       0.93      0.92      0.90    311029

2020-01-15 00:17:38,513 [INFO] Overall accuracy (micro avg): 0.9234347922540985
/home/sunanda/research/ids_experiments/utility.py:328: RuntimeWarning: invalid value encountered in true_divide
  PPV = TP / (TP + FP)    # Precision or positive predictive value
/home/sunanda/research/ids_experiments/utility.py:332: RuntimeWarning: invalid value encountered in true_divide
  FDR = FP / (TP + FP)    # False discovery rate
2020-01-15 00:17:47,890 [INFO] Average metrics for Testing dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9234         0.9234                       0.9234                0.0191                   0.0766  0.9234
1     Macro avg        0.9694         0.6828                       0.5589                0.0194                   0.4411  0.5342
2  Weighted avg        0.9681         0.9299                       0.9234                0.0203                   0.0766  0.9044
2020-01-15 00:18:18,309 [INFO] Dataset: Validation. Classification report below
2020-01-15 00:18:18,309 [INFO] 
              precision    recall  f1-score   support

         dos       1.00      1.00      1.00    776675
     normal.       1.00      1.00      1.00    194556
       probe       1.00      0.99      0.99      8221
         r2l       0.91      0.66      0.77       225
         u2r       0.00      0.00      0.00        10

    accuracy                           1.00    979687
   macro avg       0.78      0.73      0.75    979687
weighted avg       1.00      1.00      1.00    979687

2020-01-15 00:18:18,309 [INFO] Overall accuracy (micro avg): 0.9997550237984173
2020-01-15 00:18:51,134 [INFO] Average metrics for Validation dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9998         0.9998                       0.9998                0.0001                   0.0002  0.9998
1     Macro avg        0.9999         0.7817                       0.7309                0.0001                   0.2691  0.7523
2  Weighted avg        0.9999         0.9997                       0.9998                0.0002                   0.0002  0.9997
2020-01-15 00:21:05,132 [INFO] Dataset: Training. Classification report below
2020-01-15 00:21:05,133 [INFO] 
              precision    recall  f1-score   support

         dos       1.00      1.00      1.00   3106695
     normal.       1.00      1.00      1.00    778225
       probe       1.00      0.99      0.99     32881
         r2l       0.91      0.69      0.78       901
         u2r       0.00      0.00      0.00        42

    accuracy                           1.00   3918744
   macro avg       0.78      0.74      0.76   3918744
weighted avg       1.00      1.00      1.00   3918744

2020-01-15 00:21:05,133 [INFO] Overall accuracy (micro avg): 0.9997636997976903
2020-01-15 00:23:29,691 [INFO] Average metrics for Training dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9998         0.9998                       0.9998                0.0001                   0.0002  0.9998
1     Macro avg        0.9999         0.7813                       0.7361                0.0001                   0.2639  0.7556
2  Weighted avg        0.9999         0.9997                       0.9998                0.0002                   0.0002  0.9998
2020-01-15 00:23:29,739 [INFO] Results saved to: results_additional_exps/train_time_kdd99_ann_shallow_rep1/train_time_kdd99_ann_shallow_rep1_results.xlsx
2020-01-15 00:23:29,745 [INFO] ================= Finished running experiment no. 1 ================= 

2020-01-15 00:23:29,771 [INFO] Created directory: results_additional_exps/train_time_kdd99_ann_shallow_rep2
2020-01-15 00:23:29,772 [INFO] Initialized logging. log_filename = results_additional_exps/train_time_kdd99_ann_shallow_rep2/run_log.log
2020-01-15 00:23:29,772 [INFO] ================= Running experiment no. 2  ================= 

2020-01-15 00:23:29,772 [INFO] Experiment parameters given below
2020-01-15 00:23:29,772 [INFO] 
{'experiment_num': 2, 'results_dir': 'results_additional_exps/train_time_kdd99_ann_shallow_rep2', 'model_type': 'classifier', 'model': 'ann', 'normal_label': 'normal', 'training_data_feed': 'preload', 'scaling_type': 'NA', 'ann_layer_units': [256], 'ann_layer_activations': ['relu'], 'ann_layer_dropout_rates': [0.2], 'epochs': 100, 'early_stop_patience': 100, 'batch_size': 256, 'goal_metric': 0.921328918, 'training_set': 'train_set_only', 'dataset_dir': '../Datasets/full_datasets/kdd99_five_classes', 'description': 'train_time_kdd99_ann_shallow_rep2'}
2020-01-15 00:23:29,772 [INFO] Created tensorboard log directory: results_additional_exps/train_time_kdd99_ann_shallow_rep2/tf_logs_run_2020_01_15-00_23_29
2020-01-15 00:23:29,772 [INFO] Loading datsets from: ../Datasets/full_datasets/kdd99_five_classes
2020-01-15 00:23:29,772 [INFO] Reading X, y files
2020-01-15 00:23:29,773 [INFO] Reading HDF dataset ../Datasets/full_datasets/kdd99_five_classes/X_train.h5
2020-01-15 00:23:36,160 [INFO] Reading complete. time_to_read=6.39 seconds
2020-01-15 00:23:36,160 [INFO] Reading HDF dataset ../Datasets/full_datasets/kdd99_five_classes/X_val.h5
2020-01-15 00:23:37,775 [INFO] Reading complete. time_to_read=1.61 seconds
2020-01-15 00:23:37,775 [INFO] Reading HDF dataset ../Datasets/full_datasets/kdd99_five_classes/X_test.h5
2020-01-15 00:23:38,228 [INFO] Reading complete. time_to_read=0.45 seconds
2020-01-15 00:23:38,228 [INFO] Reading HDF dataset ../Datasets/full_datasets/kdd99_five_classes/y_train.h5
2020-01-15 00:23:38,436 [INFO] Reading complete. time_to_read=0.21 seconds
2020-01-15 00:23:38,436 [INFO] Reading HDF dataset ../Datasets/full_datasets/kdd99_five_classes/y_val.h5
2020-01-15 00:23:38,488 [INFO] Reading complete. time_to_read=0.05 seconds
2020-01-15 00:23:38,489 [INFO] Reading HDF dataset ../Datasets/full_datasets/kdd99_five_classes/y_test.h5
2020-01-15 00:23:38,508 [INFO] Reading complete. time_to_read=0.02 seconds
2020-01-15 00:23:45,674 [INFO] Initializing model
2020-01-15 00:23:45,793 [INFO] _________________________________________________________________
2020-01-15 00:23:45,793 [INFO] Layer (type)                 Output Shape              Param #   
2020-01-15 00:23:45,793 [INFO] =================================================================
2020-01-15 00:23:45,793 [INFO] dense_3 (Dense)              (None, 256)               31744     
2020-01-15 00:23:45,793 [INFO] _________________________________________________________________
2020-01-15 00:23:45,793 [INFO] batch_normalization_2 (Batch (None, 256)               1024      
2020-01-15 00:23:45,793 [INFO] _________________________________________________________________
2020-01-15 00:23:45,794 [INFO] dropout_2 (Dropout)          (None, 256)               0         
2020-01-15 00:23:45,794 [INFO] _________________________________________________________________
2020-01-15 00:23:45,794 [INFO] dense_4 (Dense)              (None, 5)                 1285      
2020-01-15 00:23:45,794 [INFO] =================================================================
2020-01-15 00:23:45,794 [INFO] Total params: 34,053
2020-01-15 00:23:45,794 [INFO] Trainable params: 33,541
2020-01-15 00:23:45,794 [INFO] Non-trainable params: 512
2020-01-15 00:23:45,794 [INFO] _________________________________________________________________
2020-01-15 00:23:45,794 [INFO] Training model
 - val_f1: 0.9997
 - out_of_sample_accuracy: 0.9233
Train on 3918744 samples, validate on 979687 samples
Epoch 1/100
 - 70s - loss: 0.0027 - val_loss: 7.6592e-04
2020-01-15 00:25:20,073 [INFO] StopperOnGoal: reached goal_metric (accuracy). Stopping training. goal_metric = 0.9213, current_metric = 0.9239, num_epochs = 1
2020-01-15 00:25:20,092 [INFO] WeightRestorer::on_train_end(): restoring best weights
2020-01-15 00:27:04,456 [INFO] Last epoch loss evaluation: train_loss = 0.000813, val_loss = 0.000766
2020-01-15 00:27:04,456 [INFO] Training complete. time_to_train = 198.66 sec, 3.31 min
2020-01-15 00:27:04,586 [INFO] Model saved to results_additional_exps/train_time_kdd99_ann_shallow_rep2/best_model.pickle
2020-01-15 00:27:04,588 [INFO] Training history saved to: results_additional_exps/train_time_kdd99_ann_shallow_rep2/training_error_history.csv
2020-01-15 00:27:04,772 [INFO] Plot saved to: results_additional_exps/train_time_kdd99_ann_shallow_rep2/training_error_history.png
2020-01-15 00:27:04,927 [INFO] Plot saved to: results_additional_exps/train_time_kdd99_ann_shallow_rep2/training_f1_history.png
2020-01-15 00:27:04,927 [INFO] Making predictions on training, validation, testing data
2020-01-15 00:28:38,469 [INFO] Making predictions complete. time_to_predict = 93.54 sec, 1.56 min
2020-01-15 00:28:38,587 [INFO] Evaluating predictions (results)
2020-01-15 00:28:47,351 [INFO] Dataset: Testing. Classification report below
2020-01-15 00:28:47,351 [INFO] 
              precision    recall  f1-score   support

         dos       1.00      0.97      0.99    229853
     normal.       0.73      0.99      0.84     60593
       probe       0.83      0.71      0.77      4166
         r2l       0.99      0.03      0.06     13781
         u2r       0.00      0.00      0.00      2636

    accuracy                           0.92    311029
   macro avg       0.71      0.54      0.53    311029
weighted avg       0.93      0.92      0.90    311029

2020-01-15 00:28:47,351 [INFO] Overall accuracy (micro avg): 0.9240553131701545
2020-01-15 00:28:56,727 [INFO] Average metrics for Testing dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9241         0.9241                       0.9241                0.0190                   0.0759  0.9241
1     Macro avg        0.9696         0.7089                       0.5417                0.0202                   0.4583  0.5310
2  Weighted avg        0.9676         0.9334                       0.9241                0.0249                   0.0759  0.9049
2020-01-15 00:29:27,049 [INFO] Dataset: Validation. Classification report below
2020-01-15 00:29:27,049 [INFO] 
              precision    recall  f1-score   support

         dos       1.00      1.00      1.00    776675
     normal.       1.00      1.00      1.00    194556
       probe       0.99      0.99      0.99      8221
         r2l       0.86      0.59      0.70       225
         u2r       0.00      0.00      0.00        10

    accuracy                           1.00    979687
   macro avg       0.77      0.72      0.74    979687
weighted avg       1.00      1.00      1.00    979687

2020-01-15 00:29:27,049 [INFO] Overall accuracy (micro avg): 0.9996468259760516
2020-01-15 00:29:59,753 [INFO] Average metrics for Validation dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9996         0.9996                       0.9996                0.0001                   0.0004  0.9996
1     Macro avg        0.9999         0.7699                       0.7150                0.0002                   0.2850  0.7374
2  Weighted avg        0.9998         0.9996                       0.9996                0.0005                   0.0004  0.9996
2020-01-15 00:32:13,742 [INFO] Dataset: Training. Classification report below
2020-01-15 00:32:13,742 [INFO] 
              precision    recall  f1-score   support

         dos       1.00      1.00      1.00   3106695
     normal.       1.00      1.00      1.00    778225
       probe       0.99      0.99      0.99     32881
         r2l       0.82      0.59      0.69       901
         u2r       0.00      0.00      0.00        42

    accuracy                           1.00   3918744
   macro avg       0.76      0.72      0.74   3918744
weighted avg       1.00      1.00      1.00   3918744

2020-01-15 00:32:13,742 [INFO] Overall accuracy (micro avg): 0.9996345767929724
2020-01-15 00:34:38,357 [INFO] Average metrics for Training dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9996         0.9996                       0.9996                0.0001                   0.0004  0.9996
1     Macro avg        0.9999         0.7624                       0.7160                0.0002                   0.2840  0.7356
2  Weighted avg        0.9998         0.9996                       0.9996                0.0005                   0.0004  0.9996
2020-01-15 00:34:38,404 [INFO] Results saved to: results_additional_exps/train_time_kdd99_ann_shallow_rep2/train_time_kdd99_ann_shallow_rep2_results.xlsx
2020-01-15 00:34:38,411 [INFO] ================= Finished running experiment no. 2 ================= 

2020-01-15 00:34:38,434 [INFO] Created directory: results_additional_exps/train_time_kdd99_ann_shallow_rep3
2020-01-15 00:34:38,435 [INFO] Initialized logging. log_filename = results_additional_exps/train_time_kdd99_ann_shallow_rep3/run_log.log
2020-01-15 00:34:38,435 [INFO] ================= Running experiment no. 3  ================= 

2020-01-15 00:34:38,435 [INFO] Experiment parameters given below
2020-01-15 00:34:38,435 [INFO] 
{'experiment_num': 3, 'results_dir': 'results_additional_exps/train_time_kdd99_ann_shallow_rep3', 'model_type': 'classifier', 'model': 'ann', 'normal_label': 'normal', 'training_data_feed': 'preload', 'scaling_type': 'NA', 'ann_layer_units': [256], 'ann_layer_activations': ['relu'], 'ann_layer_dropout_rates': [0.2], 'epochs': 100, 'early_stop_patience': 100, 'batch_size': 256, 'goal_metric': 0.921328918, 'training_set': 'train_set_only', 'dataset_dir': '../Datasets/full_datasets/kdd99_five_classes', 'description': 'train_time_kdd99_ann_shallow_rep3'}
2020-01-15 00:34:38,435 [INFO] Created tensorboard log directory: results_additional_exps/train_time_kdd99_ann_shallow_rep3/tf_logs_run_2020_01_15-00_34_38
2020-01-15 00:34:38,435 [INFO] Loading datsets from: ../Datasets/full_datasets/kdd99_five_classes
2020-01-15 00:34:38,435 [INFO] Reading X, y files
2020-01-15 00:34:38,436 [INFO] Reading HDF dataset ../Datasets/full_datasets/kdd99_five_classes/X_train.h5
2020-01-15 00:34:44,841 [INFO] Reading complete. time_to_read=6.41 seconds
2020-01-15 00:34:44,841 [INFO] Reading HDF dataset ../Datasets/full_datasets/kdd99_five_classes/X_val.h5
2020-01-15 00:34:46,463 [INFO] Reading complete. time_to_read=1.62 seconds
2020-01-15 00:34:46,463 [INFO] Reading HDF dataset ../Datasets/full_datasets/kdd99_five_classes/X_test.h5
2020-01-15 00:34:46,920 [INFO] Reading complete. time_to_read=0.46 seconds
2020-01-15 00:34:46,920 [INFO] Reading HDF dataset ../Datasets/full_datasets/kdd99_five_classes/y_train.h5
2020-01-15 00:34:47,144 [INFO] Reading complete. time_to_read=0.22 seconds
2020-01-15 00:34:47,144 [INFO] Reading HDF dataset ../Datasets/full_datasets/kdd99_five_classes/y_val.h5
2020-01-15 00:34:47,198 [INFO] Reading complete. time_to_read=0.05 seconds
2020-01-15 00:34:47,198 [INFO] Reading HDF dataset ../Datasets/full_datasets/kdd99_five_classes/y_test.h5
2020-01-15 00:34:47,217 [INFO] Reading complete. time_to_read=0.02 seconds
2020-01-15 00:34:54,410 [INFO] Initializing model
2020-01-15 00:34:54,618 [INFO] _________________________________________________________________
2020-01-15 00:34:54,618 [INFO] Layer (type)                 Output Shape              Param #   
2020-01-15 00:34:54,618 [INFO] =================================================================
2020-01-15 00:34:54,618 [INFO] dense_5 (Dense)              (None, 256)               31744     
2020-01-15 00:34:54,618 [INFO] _________________________________________________________________
2020-01-15 00:34:54,618 [INFO] batch_normalization_3 (Batch (None, 256)               1024      
2020-01-15 00:34:54,618 [INFO] _________________________________________________________________
2020-01-15 00:34:54,618 [INFO] dropout_3 (Dropout)          (None, 256)               0         
2020-01-15 00:34:54,618 [INFO] _________________________________________________________________
2020-01-15 00:34:54,619 [INFO] dense_6 (Dense)              (None, 5)                 1285      
2020-01-15 00:34:54,619 [INFO] =================================================================
2020-01-15 00:34:54,619 [INFO] Total params: 34,053
2020-01-15 00:34:54,619 [INFO] Trainable params: 33,541
2020-01-15 00:34:54,619 [INFO] Non-trainable params: 512
2020-01-15 00:34:54,619 [INFO] _________________________________________________________________
2020-01-15 00:34:54,619 [INFO] Training model
 - val_f1: 0.9996
 - out_of_sample_accuracy: 0.9239
Train on 3918744 samples, validate on 979687 samples
Epoch 1/100
 - 72s - loss: 0.0035 - val_loss: 9.0471e-04
 - val_f1: 0.9996
 - out_of_sample_accuracy: 0.9205
Epoch 2/100
 - 74s - loss: 7.7490e-04 - val_loss: 5.9747e-04
2020-01-15 00:38:12,413 [INFO] StopperOnGoal: reached goal_metric (accuracy). Stopping training. goal_metric = 0.9213, current_metric = 0.9238, num_epochs = 2
2020-01-15 00:38:12,414 [INFO] WeightRestorer::on_train_end(): restoring best weights
2020-01-15 00:40:07,950 [INFO] Last epoch loss evaluation: train_loss = 0.000579, val_loss = 0.000597
2020-01-15 00:40:07,950 [INFO] Training complete. time_to_train = 313.33 sec, 5.22 min
2020-01-15 00:40:08,135 [INFO] Model saved to results_additional_exps/train_time_kdd99_ann_shallow_rep3/best_model.pickle
2020-01-15 00:40:08,137 [INFO] Training history saved to: results_additional_exps/train_time_kdd99_ann_shallow_rep3/training_error_history.csv
2020-01-15 00:40:08,317 [INFO] Plot saved to: results_additional_exps/train_time_kdd99_ann_shallow_rep3/training_error_history.png
2020-01-15 00:40:08,485 [INFO] Plot saved to: results_additional_exps/train_time_kdd99_ann_shallow_rep3/training_f1_history.png
2020-01-15 00:40:08,485 [INFO] Making predictions on training, validation, testing data
2020-01-15 00:41:47,981 [INFO] Making predictions complete. time_to_predict = 99.50 sec, 1.66 min
2020-01-15 00:41:48,097 [INFO] Evaluating predictions (results)
2020-01-15 00:41:56,879 [INFO] Dataset: Testing. Classification report below
2020-01-15 00:41:56,879 [INFO] 
              precision    recall  f1-score   support

         dos       1.00      0.97      0.99    229853
     normal.       0.73      0.98      0.84     60593
       probe       0.78      0.84      0.81      4166
         r2l       0.93      0.03      0.06     13781
         u2r       0.33      0.01      0.01      2636

    accuracy                           0.92    311029
   macro avg       0.75      0.57      0.54    311029
weighted avg       0.93      0.92      0.91    311029

2020-01-15 00:41:56,879 [INFO] Overall accuracy (micro avg): 0.9238302537705487
2020-01-15 00:42:06,258 [INFO] Average metrics for Testing dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9238         0.9238                       0.9238                0.0190                   0.0762  0.9238
1     Macro avg        0.9695         0.7534                       0.5669                0.0192                   0.4331  0.5414
2  Weighted avg        0.9682         0.9343                       0.9238                0.0200                   0.0762  0.9053
2020-01-15 00:42:36,634 [INFO] Dataset: Validation. Classification report below
2020-01-15 00:42:36,635 [INFO] 
              precision    recall  f1-score   support

         dos       1.00      1.00      1.00    776675
     normal.       1.00      1.00      1.00    194556
       probe       0.99      0.99      0.99      8221
         r2l       0.93      0.57      0.71       225
         u2r       0.05      0.30      0.08        10

    accuracy                           1.00    979687
   macro avg       0.79      0.77      0.76    979687
weighted avg       1.00      1.00      1.00    979687

2020-01-15 00:42:36,635 [INFO] Overall accuracy (micro avg): 0.9996692821278633
2020-01-15 00:43:09,411 [INFO] Average metrics for Validation dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9997         0.9997                       0.9997                0.0001                   0.0003  0.9997
1     Macro avg        0.9999         0.7934                       0.7724                0.0001                   0.2276  0.7558
2  Weighted avg        0.9999         0.9997                       0.9997                0.0002                   0.0003  0.9997
2020-01-15 00:45:23,142 [INFO] Dataset: Training. Classification report below
2020-01-15 00:45:23,142 [INFO] 
              precision    recall  f1-score   support

         dos       1.00      1.00      1.00   3106695
     normal.       1.00      1.00      1.00    778225
       probe       0.99      0.99      0.99     32881
         r2l       0.93      0.58      0.71       901
         u2r       0.10      0.52      0.17        42

    accuracy                           1.00   3918744
   macro avg       0.80      0.82      0.77   3918744
weighted avg       1.00      1.00      1.00   3918744

2020-01-15 00:45:23,142 [INFO] Overall accuracy (micro avg): 0.9996965864572934
2020-01-15 00:47:47,569 [INFO] Average metrics for Training dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9997         0.9997                       0.9997                0.0001                   0.0003  0.9997
1     Macro avg        0.9999         0.8045                       0.8190                0.0001                   0.1810  0.7748
2  Weighted avg        0.9999         0.9997                       0.9997                0.0002                   0.0003  0.9997
2020-01-15 00:47:47,616 [INFO] Results saved to: results_additional_exps/train_time_kdd99_ann_shallow_rep3/train_time_kdd99_ann_shallow_rep3_results.xlsx
2020-01-15 00:47:47,624 [INFO] ================= Finished running experiment no. 3 ================= 

2020-01-15 00:47:47,647 [INFO] ================= Finished running 3 experiments ================= 

 - val_f1: 0.9997
 - out_of_sample_accuracy: 0.9238
