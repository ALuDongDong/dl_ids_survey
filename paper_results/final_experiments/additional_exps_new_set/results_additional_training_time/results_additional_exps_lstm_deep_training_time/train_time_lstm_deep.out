Using TensorFlow backend.
2020-01-13 20:46:59,089 [INFO] Initialized logging. log_filename = results_additional_exps/train_time_nsl_lstm_deep_rep1/run_log.log
2020-01-13 20:46:59,089 [INFO] ================= Running experiment no. 1  ================= 

2020-01-13 20:46:59,089 [INFO] Experiment parameters given below
2020-01-13 20:46:59,089 [INFO] 
{'experiment_num': 1, 'results_dir': 'results_additional_exps/train_time_nsl_lstm_deep_rep1', 'model': 'lstm', 'model_type': 'classifier', 'normal_label': 'normal', 'lstm_time_steps': 16, 'lstm_layer_units': [64, 32], 'lstm_layer_activations': ['relu', 'relu'], 'lstm_layer_dropout_rates': [0.2, 0.2], 'batch_size': 256, 'epochs': 100, 'early_stop_patience': 100, 'goal_metric': 0.755064154, 'training_set': 'train_set_only', 'dataset_dir': '../Datasets/small_datasets/nsl_kdd_five_classes', 'description': 'train_time_nsl_lstm_deep_rep1'}
2020-01-13 20:46:59,090 [INFO] Created tensorboard log directory: results_additional_exps/train_time_nsl_lstm_deep_rep1/tf_logs_run_2020_01_13-20_46_59
2020-01-13 20:46:59,090 [INFO] Loading datsets from: ../Datasets/small_datasets/nsl_kdd_five_classes
2020-01-13 20:46:59,098 [INFO] Reading X, y files
2020-01-13 20:46:59,098 [INFO] Reading HDF dataset ../Datasets/small_datasets/nsl_kdd_five_classes/X_train.h5
2020-01-13 20:46:59,591 [INFO] Reading complete. time_to_read=0.49 seconds
2020-01-13 20:46:59,592 [INFO] Reading HDF dataset ../Datasets/small_datasets/nsl_kdd_five_classes/X_val.h5
2020-01-13 20:46:59,726 [INFO] Reading complete. time_to_read=0.13 seconds
2020-01-13 20:46:59,726 [INFO] Reading HDF dataset ../Datasets/small_datasets/nsl_kdd_five_classes/X_test.h5
2020-01-13 20:46:59,843 [INFO] Reading complete. time_to_read=0.12 seconds
2020-01-13 20:46:59,843 [INFO] Reading HDF dataset ../Datasets/small_datasets/nsl_kdd_five_classes/y_train.h5
2020-01-13 20:46:59,868 [INFO] Reading complete. time_to_read=0.03 seconds
2020-01-13 20:46:59,868 [INFO] Reading HDF dataset ../Datasets/small_datasets/nsl_kdd_five_classes/y_val.h5
2020-01-13 20:46:59,888 [INFO] Reading complete. time_to_read=0.02 seconds
2020-01-13 20:46:59,888 [INFO] Reading HDF dataset ../Datasets/small_datasets/nsl_kdd_five_classes/y_test.h5
2020-01-13 20:46:59,904 [INFO] Reading complete. time_to_read=0.02 seconds
2020-01-13 20:47:00,063 [INFO] Preparing flow sequences
2020-01-13 20:47:02,293 [INFO] Extracting flows complete. time_taken = 2.23 sec
2020-01-13 20:47:02,344 [INFO] Initializing model
2020-01-13 20:47:02,344 [WARNING] From /home/hasitha/anaconda3/lib/python3.7/site-packages/keras/backend/tensorflow_backend.py:74: The name tf.get_default_graph is deprecated. Please use tf.compat.v1.get_default_graph instead.

2020-01-13 20:47:02,353 [WARNING] From /home/hasitha/anaconda3/lib/python3.7/site-packages/keras/backend/tensorflow_backend.py:517: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

2020-01-13 20:47:02,354 [WARNING] From /home/hasitha/anaconda3/lib/python3.7/site-packages/keras/backend/tensorflow_backend.py:4138: The name tf.random_uniform is deprecated. Please use tf.random.uniform instead.

2020-01-13 20:47:02,575 [WARNING] From /home/hasitha/anaconda3/lib/python3.7/site-packages/keras/backend/tensorflow_backend.py:133: The name tf.placeholder_with_default is deprecated. Please use tf.compat.v1.placeholder_with_default instead.

2020-01-13 20:47:02,589 [WARNING] From /home/hasitha/anaconda3/lib/python3.7/site-packages/keras/backend/tensorflow_backend.py:3445: calling dropout (from tensorflow.python.ops.nn_ops) with keep_prob is deprecated and will be removed in a future version.
Instructions for updating:
Please use `rate` instead of `keep_prob`. Rate should be set to `rate = 1 - keep_prob`.
2020-01-13 20:47:02,812 [WARNING] From /home/hasitha/anaconda3/lib/python3.7/site-packages/keras/optimizers.py:790: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

2020-01-13 20:47:02,825 [WARNING] From /home/hasitha/anaconda3/lib/python3.7/site-packages/keras/backend/tensorflow_backend.py:3376: The name tf.log is deprecated. Please use tf.math.log instead.

2020-01-13 20:47:02,828 [WARNING] From /home/hasitha/anaconda3/lib/python3.7/site-packages/tensorflow/python/ops/nn_impl.py:180: add_dispatch_support.<locals>.wrapper (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
2020-01-13 20:47:02,837 [INFO] _________________________________________________________________
2020-01-13 20:47:02,837 [INFO] Layer (type)                 Output Shape              Param #   
2020-01-13 20:47:02,837 [INFO] =================================================================
2020-01-13 20:47:02,837 [INFO] lstm_1 (LSTM)                (None, 16, 64)            47872     
2020-01-13 20:47:02,837 [INFO] _________________________________________________________________
2020-01-13 20:47:02,837 [INFO] batch_normalization_1 (Batch (None, 16, 64)            256       
2020-01-13 20:47:02,837 [INFO] _________________________________________________________________
2020-01-13 20:47:02,837 [INFO] dropout_1 (Dropout)          (None, 16, 64)            0         
2020-01-13 20:47:02,837 [INFO] _________________________________________________________________
2020-01-13 20:47:02,837 [INFO] lstm_2 (LSTM)                (None, 16, 32)            12416     
2020-01-13 20:47:02,837 [INFO] _________________________________________________________________
2020-01-13 20:47:02,838 [INFO] batch_normalization_2 (Batch (None, 16, 32)            128       
2020-01-13 20:47:02,838 [INFO] _________________________________________________________________
2020-01-13 20:47:02,838 [INFO] dropout_2 (Dropout)          (None, 16, 32)            0         
2020-01-13 20:47:02,838 [INFO] _________________________________________________________________
2020-01-13 20:47:02,838 [INFO] time_distributed_1 (TimeDist (None, 16, 5)             165       
2020-01-13 20:47:02,838 [INFO] =================================================================
2020-01-13 20:47:02,838 [INFO] Total params: 60,837
2020-01-13 20:47:02,838 [INFO] Trainable params: 60,645
2020-01-13 20:47:02,838 [INFO] Non-trainable params: 192
2020-01-13 20:47:02,838 [INFO] _________________________________________________________________
2020-01-13 20:47:02,838 [INFO] Training model
2020-01-13 20:47:06.485435: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA
2020-01-13 20:47:06.648971: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 2893425000 Hz
2020-01-13 20:47:06.649279: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x562dda07cb70 executing computations on platform Host. Devices:
2020-01-13 20:47:06.649308: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): <undefined>, <undefined>
2020-01-13 20:47:06.944262: W tensorflow/compiler/jit/mark_for_compilation_pass.cc:1412] (One-time warning): Not using XLA:CPU for cluster because envvar TF_XLA_FLAGS=--tf_xla_cpu_global_jit was not set.  If you want XLA:CPU, either set that envvar, or use experimental_jit_scope to enable XLA:CPU.  To confirm that XLA is active, pass --vmodule=xla_compilation_cache=1 (as a proper command-line flag, not via TF_XLA_FLAGS) or set the envvar XLA_FLAGS=--xla_hlo_profile.
2020-01-13 20:47:06,950 [WARNING] From /home/hasitha/anaconda3/lib/python3.7/site-packages/keras/callbacks.py:850: The name tf.summary.merge_all is deprecated. Please use tf.compat.v1.summary.merge_all instead.

2020-01-13 20:47:06,951 [WARNING] From /home/hasitha/anaconda3/lib/python3.7/site-packages/keras/callbacks.py:853: The name tf.summary.FileWriter is deprecated. Please use tf.compat.v1.summary.FileWriter instead.

Train on 6298 samples, validate on 1574 samples
Epoch 1/100
 - 2s - loss: 0.4812 - val_loss: 0.3194
 - val_f1: 0.6172
 - out_of_sample_accuracy: 0.3825
Epoch 2/100
 - 1s - loss: 0.1994 - val_loss: 0.1050
 - val_f1: 0.9298
 - out_of_sample_accuracy: 0.6683
Epoch 3/100
 - 1s - loss: 0.0910 - val_loss: 0.0679
 - val_f1: 0.9554
 - out_of_sample_accuracy: 0.6987
Epoch 4/100
 - 1s - loss: 0.0660 - val_loss: 0.0539
 - val_f1: 0.9631
 - out_of_sample_accuracy: 0.7049
Epoch 5/100
 - 1s - loss: 0.0547 - val_loss: 0.0455
 - val_f1: 0.9673
 - out_of_sample_accuracy: 0.7081
Epoch 6/100
 - 1s - loss: 0.0482 - val_loss: 0.0400
 - val_f1: 0.9694
 - out_of_sample_accuracy: 0.7112
Epoch 7/100
 - 1s - loss: 0.0431 - val_loss: 0.0352
 - val_f1: 0.9707
 - out_of_sample_accuracy: 0.7139
Epoch 8/100
 - 1s - loss: 0.0381 - val_loss: 0.0310
 - val_f1: 0.9723
 - out_of_sample_accuracy: 0.7180
Epoch 9/100
 - 1s - loss: 0.0333 - val_loss: 0.0264
 - val_f1: 0.9749
 - out_of_sample_accuracy: 0.7310
Epoch 10/100
 - 1s - loss: 0.0287 - val_loss: 0.0222
 - val_f1: 0.9792
 - out_of_sample_accuracy: 0.7407
Epoch 11/100
 - 1s - loss: 0.0245 - val_loss: 0.0192
/home/hasitha/anaconda3/lib/python3.7/site-packages/sklearn/metrics/classification.py:1143: UndefinedMetricWarning: F-score is ill-defined and being set to 0.0 in labels with no predicted samples.
  'precision', 'predicted', average, warn_for)
2020-01-13 20:47:20,989 [INFO] epoch = 10. Intermediate model saved to results_additional_exps/train_time_nsl_lstm_deep_rep1/_model_epoch_10.pickle
 - val_f1: 0.9818
 - out_of_sample_accuracy: 0.7478
Epoch 12/100
 - 1s - loss: 0.0223 - val_loss: 0.0171
 - val_f1: 0.9837
 - out_of_sample_accuracy: 0.7518
Epoch 13/100
 - 1s - loss: 0.0199 - val_loss: 0.0158
2020-01-13 20:47:23,398 [INFO] StopperOnGoal: reached goal_metric (accuracy). Stopping training. goal_metric = 0.7551, current_metric = 0.7564, num_epochs = 13
2020-01-13 20:47:23,399 [INFO] WeightRestorer::on_train_end(): restoring best weights
2020-01-13 20:47:24,110 [INFO] Last epoch loss evaluation: train_loss = 0.014795, val_loss = 0.015755
2020-01-13 20:47:24,110 [INFO] Training complete. time_to_train = 21.27 sec, 0.35 min
2020-01-13 20:47:24,115 [INFO] Model saved to results_additional_exps/train_time_nsl_lstm_deep_rep1/best_model.pickle
2020-01-13 20:47:24,127 [INFO] Training history saved to: results_additional_exps/train_time_nsl_lstm_deep_rep1/training_error_history.csv
2020-01-13 20:47:24,314 [INFO] Plot saved to: results_additional_exps/train_time_nsl_lstm_deep_rep1/training_error_history.png
2020-01-13 20:47:24,445 [INFO] Plot saved to: results_additional_exps/train_time_nsl_lstm_deep_rep1/training_f1_history.png
2020-01-13 20:47:24,445 [INFO] Making predictions on training, validation, testing data
2020-01-13 20:47:25,186 [INFO] Making predictions complete. time_to_predict = 0.74 sec, 0.01 min
2020-01-13 20:47:25,189 [INFO] Evaluating predictions (results)
2020-01-13 20:47:25,517 [INFO] Dataset: Testing. Classification report below
2020-01-13 20:47:25,517 [INFO] 
              precision    recall  f1-score   support

         dos       0.93      0.85      0.89      7458
      normal       0.68      0.93      0.78      9711
       probe       0.75      0.70      0.73      2421
         r2l       0.98      0.05      0.09      2421
         u2r       0.90      0.02      0.03       533

   micro avg       0.76      0.76      0.76     22544
   macro avg       0.85      0.51      0.51     22544
weighted avg       0.81      0.76      0.72     22544

2020-01-13 20:47:25,517 [INFO] Overall accuracy (micro avg): 0.7624201561391057
2020-01-13 20:47:25,850 [INFO] Average metrics for Testing dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.7624         0.7624                       0.7624                0.0594                   0.2376  0.7624
1     Macro avg        0.9050         0.8470                       0.5099                0.0792                   0.4901  0.5052
2  Weighted avg        0.8631         0.8061                       0.7624                0.1584                   0.2376  0.7201
2020-01-13 20:47:26,259 [INFO] Dataset: Validation. Classification report below
2020-01-13 20:47:26,259 [INFO] 
              precision    recall  f1-score   support

         dos       0.99      1.00      0.99      9183
      normal       0.99      0.99      0.99     13462
       probe       0.98      0.97      0.98      2330
         r2l       0.80      0.47      0.59       199
         u2r       1.00      0.20      0.33        10

   micro avg       0.99      0.99      0.99     25184
   macro avg       0.95      0.73      0.78     25184
weighted avg       0.99      0.99      0.99     25184

2020-01-13 20:47:26,259 [INFO] Overall accuracy (micro avg): 0.9872141041931385
2020-01-13 20:47:26,638 [INFO] Average metrics for Validation dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9872         0.9872                       0.9872                0.0032                   0.0128  0.9872
1     Macro avg        0.9949         0.9514                       0.7260                0.0044                   0.2740  0.7765
2  Weighted avg        0.9919         0.9866                       0.9872                0.0094                   0.0128  0.9864
2020-01-13 20:47:28,146 [INFO] Dataset: Training. Classification report below
2020-01-13 20:47:28,146 [INFO] 
              precision    recall  f1-score   support

         dos       0.99      1.00      1.00     36738
      normal       0.99      0.99      0.99     53871
       probe       0.98      0.97      0.98      9321
         r2l       0.87      0.52      0.65       796
         u2r       0.50      0.10      0.16        42

   micro avg       0.99      0.99      0.99    100768
   macro avg       0.87      0.72      0.75    100768
weighted avg       0.99      0.99      0.99    100768

2020-01-13 20:47:28,146 [INFO] Overall accuracy (micro avg): 0.9887761987932677
2020-01-13 20:47:29,854 [INFO] Average metrics for Training dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9888         0.9888                       0.9888                0.0028                   0.0112  0.9888
1     Macro avg        0.9955         0.8667                       0.7161                0.0040                   0.2839  0.7550
2  Weighted avg        0.9929         0.9882                       0.9888                0.0086                   0.0112  0.9881
2020-01-13 20:47:29,880 [INFO] Results saved to: results_additional_exps/train_time_nsl_lstm_deep_rep1/train_time_nsl_lstm_deep_rep1_results.xlsx
2020-01-13 20:47:29,881 [INFO] ================= Finished running experiment no. 1 ================= 

2020-01-13 20:47:29,884 [INFO] Created directory: results_additional_exps/train_time_nsl_lstm_deep_rep2
2020-01-13 20:47:29,884 [INFO] Initialized logging. log_filename = results_additional_exps/train_time_nsl_lstm_deep_rep2/run_log.log
2020-01-13 20:47:29,884 [INFO] ================= Running experiment no. 2  ================= 

2020-01-13 20:47:29,884 [INFO] Experiment parameters given below
2020-01-13 20:47:29,884 [INFO] 
{'experiment_num': 2, 'results_dir': 'results_additional_exps/train_time_nsl_lstm_deep_rep2', 'model': 'lstm', 'model_type': 'classifier', 'normal_label': 'normal', 'lstm_time_steps': 17, 'lstm_layer_units': [64, 33], 'lstm_layer_activations': ['relu', 'relu'], 'lstm_layer_dropout_rates': [0.2, 0.3], 'batch_size': 256, 'epochs': 100, 'early_stop_patience': 100, 'goal_metric': 0.755064154, 'training_set': 'train_set_only', 'dataset_dir': '../Datasets/small_datasets/nsl_kdd_five_classes', 'description': 'train_time_nsl_lstm_deep_rep2'}
2020-01-13 20:47:29,885 [INFO] Created tensorboard log directory: results_additional_exps/train_time_nsl_lstm_deep_rep2/tf_logs_run_2020_01_13-20_47_29
2020-01-13 20:47:29,885 [INFO] Loading datsets from: ../Datasets/small_datasets/nsl_kdd_five_classes
2020-01-13 20:47:29,885 [INFO] Reading X, y files
2020-01-13 20:47:29,885 [INFO] Reading HDF dataset ../Datasets/small_datasets/nsl_kdd_five_classes/X_train.h5
2020-01-13 20:47:30,142 [INFO] Reading complete. time_to_read=0.26 seconds
2020-01-13 20:47:30,142 [INFO] Reading HDF dataset ../Datasets/small_datasets/nsl_kdd_five_classes/X_val.h5
2020-01-13 20:47:30,205 [INFO] Reading complete. time_to_read=0.06 seconds
2020-01-13 20:47:30,205 [INFO] Reading HDF dataset ../Datasets/small_datasets/nsl_kdd_five_classes/X_test.h5
2020-01-13 20:47:30,266 [INFO] Reading complete. time_to_read=0.06 seconds
2020-01-13 20:47:30,266 [INFO] Reading HDF dataset ../Datasets/small_datasets/nsl_kdd_five_classes/y_train.h5
2020-01-13 20:47:30,273 [INFO] Reading complete. time_to_read=0.01 seconds
2020-01-13 20:47:30,273 [INFO] Reading HDF dataset ../Datasets/small_datasets/nsl_kdd_five_classes/y_val.h5
2020-01-13 20:47:30,277 [INFO] Reading complete. time_to_read=0.00 seconds
2020-01-13 20:47:30,277 [INFO] Reading HDF dataset ../Datasets/small_datasets/nsl_kdd_five_classes/y_test.h5
2020-01-13 20:47:30,281 [INFO] Reading complete. time_to_read=0.00 seconds
2020-01-13 20:47:30,433 [INFO] Preparing flow sequences
2020-01-13 20:47:32,551 [INFO] Extracting flows complete. time_taken = 2.12 sec
2020-01-13 20:47:32,599 [INFO] Initializing model
2020-01-13 20:47:33,046 [INFO] _________________________________________________________________
2020-01-13 20:47:33,046 [INFO] Layer (type)                 Output Shape              Param #   
2020-01-13 20:47:33,047 [INFO] =================================================================
2020-01-13 20:47:33,047 [INFO] lstm_3 (LSTM)                (None, 17, 64)            47872     
2020-01-13 20:47:33,047 [INFO] _________________________________________________________________
2020-01-13 20:47:33,047 [INFO] batch_normalization_3 (Batch (None, 17, 64)            256       
2020-01-13 20:47:33,047 [INFO] _________________________________________________________________
2020-01-13 20:47:33,047 [INFO] dropout_3 (Dropout)          (None, 17, 64)            0         
2020-01-13 20:47:33,047 [INFO] _________________________________________________________________
2020-01-13 20:47:33,047 [INFO] lstm_4 (LSTM)                (None, 17, 33)            12936     
2020-01-13 20:47:33,047 [INFO] _________________________________________________________________
2020-01-13 20:47:33,047 [INFO] batch_normalization_4 (Batch (None, 17, 33)            132       
2020-01-13 20:47:33,047 [INFO] _________________________________________________________________
2020-01-13 20:47:33,047 [INFO] dropout_4 (Dropout)          (None, 17, 33)            0         
2020-01-13 20:47:33,047 [INFO] _________________________________________________________________
2020-01-13 20:47:33,047 [INFO] time_distributed_2 (TimeDist (None, 17, 5)             170       
2020-01-13 20:47:33,047 [INFO] =================================================================
2020-01-13 20:47:33,048 [INFO] Total params: 61,366
2020-01-13 20:47:33,048 [INFO] Trainable params: 61,172
2020-01-13 20:47:33,048 [INFO] Non-trainable params: 194
2020-01-13 20:47:33,048 [INFO] _________________________________________________________________
2020-01-13 20:47:33,048 [INFO] Training model
 - val_f1: 0.9861
 - out_of_sample_accuracy: 0.7564
Train on 5928 samples, validate on 1482 samples
Epoch 1/100
 - 2s - loss: 0.5136 - val_loss: 0.3423
 - val_f1: 0.5380
 - out_of_sample_accuracy: 0.2963
Epoch 2/100
 - 1s - loss: 0.2513 - val_loss: 0.1167
 - val_f1: 0.9201
 - out_of_sample_accuracy: 0.6381
Epoch 3/100
 - 1s - loss: 0.1097 - val_loss: 0.0738
 - val_f1: 0.9529
 - out_of_sample_accuracy: 0.6932
Epoch 4/100
 - 1s - loss: 0.0730 - val_loss: 0.0558
 - val_f1: 0.9627
 - out_of_sample_accuracy: 0.7029
Epoch 5/100
 - 1s - loss: 0.0589 - val_loss: 0.0468
 - val_f1: 0.9671
 - out_of_sample_accuracy: 0.7073
Epoch 6/100
 - 1s - loss: 0.0510 - val_loss: 0.0400
 - val_f1: 0.9693
 - out_of_sample_accuracy: 0.7111
Epoch 7/100
 - 1s - loss: 0.0439 - val_loss: 0.0352
 - val_f1: 0.9709
 - out_of_sample_accuracy: 0.7139
Epoch 8/100
 - 1s - loss: 0.0391 - val_loss: 0.0308
 - val_f1: 0.9716
 - out_of_sample_accuracy: 0.7186
Epoch 9/100
 - 1s - loss: 0.0344 - val_loss: 0.0266
 - val_f1: 0.9742
 - out_of_sample_accuracy: 0.7247
Epoch 10/100
 - 1s - loss: 0.0298 - val_loss: 0.0230
 - val_f1: 0.9766
 - out_of_sample_accuracy: 0.7360
Epoch 11/100
 - 1s - loss: 0.0267 - val_loss: 0.0201
/home/hasitha/anaconda3/lib/python3.7/site-packages/sklearn/metrics/classification.py:1143: UndefinedMetricWarning: F-score is ill-defined and being set to 0.0 in labels with no predicted samples.
  'precision', 'predicted', average, warn_for)
2020-01-13 20:47:49,397 [INFO] epoch = 10. Intermediate model saved to results_additional_exps/train_time_nsl_lstm_deep_rep2/_model_epoch_10.pickle
 - val_f1: 0.9795
 - out_of_sample_accuracy: 0.7396
Epoch 12/100
 - 1s - loss: 0.0240 - val_loss: 0.0179
 - val_f1: 0.9820
 - out_of_sample_accuracy: 0.7432
Epoch 13/100
 - 1s - loss: 0.0220 - val_loss: 0.0165
 - val_f1: 0.9842
 - out_of_sample_accuracy: 0.7480
Epoch 14/100
 - 1s - loss: 0.0203 - val_loss: 0.0151
 - val_f1: 0.9854
 - out_of_sample_accuracy: 0.7538
Epoch 15/100
 - 1s - loss: 0.0189 - val_loss: 0.0147
 - val_f1: 0.9863
 - out_of_sample_accuracy: 0.7541
Epoch 16/100
 - 1s - loss: 0.0179 - val_loss: 0.0138
2020-01-13 20:47:55,053 [INFO] StopperOnGoal: reached goal_metric (accuracy). Stopping training. goal_metric = 0.7551, current_metric = 0.7617, num_epochs = 16
2020-01-13 20:47:55,054 [INFO] WeightRestorer::on_train_end(): restoring best weights
2020-01-13 20:47:55,862 [INFO] Last epoch loss evaluation: train_loss = 0.012298, val_loss = 0.013806
2020-01-13 20:47:55,862 [INFO] Training complete. time_to_train = 22.81 sec, 0.38 min
2020-01-13 20:47:55,868 [INFO] Model saved to results_additional_exps/train_time_nsl_lstm_deep_rep2/best_model.pickle
2020-01-13 20:47:55,869 [INFO] Training history saved to: results_additional_exps/train_time_nsl_lstm_deep_rep2/training_error_history.csv
2020-01-13 20:47:56,004 [INFO] Plot saved to: results_additional_exps/train_time_nsl_lstm_deep_rep2/training_error_history.png
2020-01-13 20:47:56,127 [INFO] Plot saved to: results_additional_exps/train_time_nsl_lstm_deep_rep2/training_f1_history.png
2020-01-13 20:47:56,128 [INFO] Making predictions on training, validation, testing data
2020-01-13 20:47:56,819 [INFO] Making predictions complete. time_to_predict = 0.69 sec, 0.01 min
2020-01-13 20:47:56,823 [INFO] Evaluating predictions (results)
2020-01-13 20:47:57,113 [INFO] Dataset: Testing. Classification report below
2020-01-13 20:47:57,113 [INFO] 
              precision    recall  f1-score   support

         dos       0.95      0.86      0.90      7458
      normal       0.68      0.93      0.78      9710
       probe       0.73      0.73      0.73      2420
         r2l       0.96      0.06      0.11      2421
         u2r       1.00      0.00      0.01       533

   micro avg       0.77      0.77      0.77     22542
   macro avg       0.86      0.51      0.51     22542
weighted avg       0.81      0.77      0.73     22542

2020-01-13 20:47:57,113 [INFO] Overall accuracy (micro avg): 0.7671457723360837
2020-01-13 20:47:57,439 [INFO] Average metrics for Testing dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.7671         0.7671                       0.7671                0.0582                   0.2329  0.7671
1     Macro avg        0.9069         0.8646                       0.5144                0.0773                   0.4856  0.5053
2  Weighted avg        0.8669         0.8130                       0.7671                0.1537                   0.2329  0.7257
/home/hasitha/anaconda3/lib/python3.7/site-packages/sklearn/metrics/classification.py:1143: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples.
  'precision', 'predicted', average, warn_for)
2020-01-13 20:47:57,783 [INFO] Dataset: Validation. Classification report below
2020-01-13 20:47:57,783 [INFO] 
              precision    recall  f1-score   support

         dos       0.99      1.00      1.00      9186
      normal       0.99      0.99      0.99     13469
       probe       0.98      0.98      0.98      2330
         r2l       0.91      0.54      0.68       199
         u2r       0.00      0.00      0.00        10

   micro avg       0.99      0.99      0.99     25194
   macro avg       0.77      0.70      0.73     25194
weighted avg       0.99      0.99      0.99     25194

2020-01-13 20:47:57,783 [INFO] Overall accuracy (micro avg): 0.9896800825593395
/home/hasitha/sunanda/ids_experiments/utility.py:328: RuntimeWarning: invalid value encountered in true_divide
  PPV = TP / (TP + FP)    # Precision or positive predictive value
/home/hasitha/sunanda/ids_experiments/utility.py:332: RuntimeWarning: invalid value encountered in true_divide
  FDR = FP / (TP + FP)    # False discovery rate
2020-01-13 20:47:58,174 [INFO] Average metrics for Validation dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9897         0.9897                       0.9897                0.0026                   0.0103  0.9897
1     Macro avg        0.9959         0.7737                       0.7020                0.0037                   0.2980  0.7284
2  Weighted avg        0.9935         0.9890                       0.9897                0.0080                   0.0103  0.9890
2020-01-13 20:47:59,681 [INFO] Dataset: Training. Classification report below
2020-01-13 20:47:59,681 [INFO] 
              precision    recall  f1-score   support

         dos       1.00      1.00      1.00     36740
      normal       0.99      0.99      0.99     53873
       probe       0.98      0.98      0.98      9325
         r2l       0.95      0.53      0.68       796
         u2r       1.00      0.07      0.13        42

   micro avg       0.99      0.99      0.99    100776
   macro avg       0.98      0.71      0.76    100776
weighted avg       0.99      0.99      0.99    100776

2020-01-13 20:47:59,681 [INFO] Overall accuracy (micro avg): 0.990652536318171
2020-01-13 20:48:01,385 [INFO] Average metrics for Training dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9907         0.9907                       0.9907                0.0023                   0.0093  0.9907
1     Macro avg        0.9963         0.9829                       0.7149                0.0034                   0.2851  0.7565
2  Weighted avg        0.9942         0.9905                       0.9907                0.0077                   0.0093  0.9899
2020-01-13 20:48:01,409 [INFO] Results saved to: results_additional_exps/train_time_nsl_lstm_deep_rep2/train_time_nsl_lstm_deep_rep2_results.xlsx
2020-01-13 20:48:01,409 [INFO] ================= Finished running experiment no. 2 ================= 

2020-01-13 20:48:01,413 [INFO] Created directory: results_additional_exps/train_time_nsl_lstm_deep_rep3
2020-01-13 20:48:01,413 [INFO] Initialized logging. log_filename = results_additional_exps/train_time_nsl_lstm_deep_rep3/run_log.log
2020-01-13 20:48:01,413 [INFO] ================= Running experiment no. 3  ================= 

2020-01-13 20:48:01,413 [INFO] Experiment parameters given below
2020-01-13 20:48:01,413 [INFO] 
{'experiment_num': 3, 'results_dir': 'results_additional_exps/train_time_nsl_lstm_deep_rep3', 'model': 'lstm', 'model_type': 'classifier', 'normal_label': 'normal', 'lstm_time_steps': 18, 'lstm_layer_units': [64, 34], 'lstm_layer_activations': ['relu', 'relu'], 'lstm_layer_dropout_rates': [0.2, 0.4], 'batch_size': 256, 'epochs': 100, 'early_stop_patience': 100, 'goal_metric': 0.755064154, 'training_set': 'train_set_only', 'dataset_dir': '../Datasets/small_datasets/nsl_kdd_five_classes', 'description': 'train_time_nsl_lstm_deep_rep3'}
2020-01-13 20:48:01,413 [INFO] Created tensorboard log directory: results_additional_exps/train_time_nsl_lstm_deep_rep3/tf_logs_run_2020_01_13-20_48_01
2020-01-13 20:48:01,413 [INFO] Loading datsets from: ../Datasets/small_datasets/nsl_kdd_five_classes
2020-01-13 20:48:01,413 [INFO] Reading X, y files
2020-01-13 20:48:01,414 [INFO] Reading HDF dataset ../Datasets/small_datasets/nsl_kdd_five_classes/X_train.h5
2020-01-13 20:48:01,671 [INFO] Reading complete. time_to_read=0.26 seconds
2020-01-13 20:48:01,671 [INFO] Reading HDF dataset ../Datasets/small_datasets/nsl_kdd_five_classes/X_val.h5
2020-01-13 20:48:01,735 [INFO] Reading complete. time_to_read=0.06 seconds
2020-01-13 20:48:01,735 [INFO] Reading HDF dataset ../Datasets/small_datasets/nsl_kdd_five_classes/X_test.h5
2020-01-13 20:48:01,793 [INFO] Reading complete. time_to_read=0.06 seconds
2020-01-13 20:48:01,793 [INFO] Reading HDF dataset ../Datasets/small_datasets/nsl_kdd_five_classes/y_train.h5
2020-01-13 20:48:01,801 [INFO] Reading complete. time_to_read=0.01 seconds
2020-01-13 20:48:01,801 [INFO] Reading HDF dataset ../Datasets/small_datasets/nsl_kdd_five_classes/y_val.h5
2020-01-13 20:48:01,805 [INFO] Reading complete. time_to_read=0.00 seconds
2020-01-13 20:48:01,805 [INFO] Reading HDF dataset ../Datasets/small_datasets/nsl_kdd_five_classes/y_test.h5
2020-01-13 20:48:01,809 [INFO] Reading complete. time_to_read=0.00 seconds
2020-01-13 20:48:01,963 [INFO] Preparing flow sequences
2020-01-13 20:48:03,973 [INFO] Extracting flows complete. time_taken = 2.01 sec
2020-01-13 20:48:04,025 [INFO] Initializing model
2020-01-13 20:48:04,467 [INFO] _________________________________________________________________
2020-01-13 20:48:04,467 [INFO] Layer (type)                 Output Shape              Param #   
2020-01-13 20:48:04,467 [INFO] =================================================================
2020-01-13 20:48:04,467 [INFO] lstm_5 (LSTM)                (None, 18, 64)            47872     
2020-01-13 20:48:04,467 [INFO] _________________________________________________________________
2020-01-13 20:48:04,467 [INFO] batch_normalization_5 (Batch (None, 18, 64)            256       
2020-01-13 20:48:04,467 [INFO] _________________________________________________________________
2020-01-13 20:48:04,467 [INFO] dropout_5 (Dropout)          (None, 18, 64)            0         
2020-01-13 20:48:04,467 [INFO] _________________________________________________________________
2020-01-13 20:48:04,467 [INFO] lstm_6 (LSTM)                (None, 18, 34)            13464     
2020-01-13 20:48:04,467 [INFO] _________________________________________________________________
2020-01-13 20:48:04,468 [INFO] batch_normalization_6 (Batch (None, 18, 34)            136       
2020-01-13 20:48:04,468 [INFO] _________________________________________________________________
2020-01-13 20:48:04,468 [INFO] dropout_6 (Dropout)          (None, 18, 34)            0         
2020-01-13 20:48:04,468 [INFO] _________________________________________________________________
2020-01-13 20:48:04,468 [INFO] time_distributed_3 (TimeDist (None, 18, 5)             175       
2020-01-13 20:48:04,468 [INFO] =================================================================
2020-01-13 20:48:04,468 [INFO] Total params: 61,903
2020-01-13 20:48:04,468 [INFO] Trainable params: 61,707
2020-01-13 20:48:04,468 [INFO] Non-trainable params: 196
2020-01-13 20:48:04,468 [INFO] _________________________________________________________________
2020-01-13 20:48:04,468 [INFO] Training model
 - val_f1: 0.9883
 - out_of_sample_accuracy: 0.7617
Train on 5598 samples, validate on 1399 samples
Epoch 1/100
 - 2s - loss: 0.5187 - val_loss: 0.3622
 - val_f1: 0.4742
 - out_of_sample_accuracy: 0.2752
Epoch 2/100
 - 1s - loss: 0.3244 - val_loss: 0.1800
 - val_f1: 0.8536
 - out_of_sample_accuracy: 0.5162
Epoch 3/100
 - 1s - loss: 0.1699 - val_loss: 0.0967
 - val_f1: 0.9429
 - out_of_sample_accuracy: 0.6669
Epoch 4/100
 - 1s - loss: 0.1053 - val_loss: 0.0699
 - val_f1: 0.9558
 - out_of_sample_accuracy: 0.6992
Epoch 5/100
 - 1s - loss: 0.0787 - val_loss: 0.0563
 - val_f1: 0.9625
 - out_of_sample_accuracy: 0.7078
Epoch 6/100
 - 1s - loss: 0.0651 - val_loss: 0.0485
 - val_f1: 0.9672
 - out_of_sample_accuracy: 0.7111
Epoch 7/100
 - 1s - loss: 0.0563 - val_loss: 0.0426
 - val_f1: 0.9691
 - out_of_sample_accuracy: 0.7131
Epoch 8/100
 - 1s - loss: 0.0506 - val_loss: 0.0378
 - val_f1: 0.9701
 - out_of_sample_accuracy: 0.7106
Epoch 9/100
 - 1s - loss: 0.0447 - val_loss: 0.0337
 - val_f1: 0.9710
 - out_of_sample_accuracy: 0.7115
Epoch 10/100
 - 1s - loss: 0.0404 - val_loss: 0.0301
 - val_f1: 0.9713
 - out_of_sample_accuracy: 0.7135
Epoch 11/100
 - 1s - loss: 0.0362 - val_loss: 0.0265
/home/hasitha/anaconda3/lib/python3.7/site-packages/sklearn/metrics/classification.py:1143: UndefinedMetricWarning: F-score is ill-defined and being set to 0.0 in labels with no predicted samples.
  'precision', 'predicted', average, warn_for)
2020-01-13 20:48:21,594 [INFO] epoch = 10. Intermediate model saved to results_additional_exps/train_time_nsl_lstm_deep_rep3/_model_epoch_10.pickle
 - val_f1: 0.9726
 - out_of_sample_accuracy: 0.7189
Epoch 12/100
 - 1s - loss: 0.0322 - val_loss: 0.0233
 - val_f1: 0.9750
 - out_of_sample_accuracy: 0.7240
Epoch 13/100
 - 1s - loss: 0.0289 - val_loss: 0.0209
 - val_f1: 0.9772
 - out_of_sample_accuracy: 0.7289
Epoch 14/100
 - 1s - loss: 0.0261 - val_loss: 0.0189
 - val_f1: 0.9790
 - out_of_sample_accuracy: 0.7281
Epoch 15/100
 - 1s - loss: 0.0235 - val_loss: 0.0174
 - val_f1: 0.9815
 - out_of_sample_accuracy: 0.7345
Epoch 16/100
 - 1s - loss: 0.0223 - val_loss: 0.0158
 - val_f1: 0.9837
 - out_of_sample_accuracy: 0.7342
Epoch 17/100
 - 1s - loss: 0.0210 - val_loss: 0.0151
 - val_f1: 0.9842
 - out_of_sample_accuracy: 0.7326
Epoch 18/100
 - 1s - loss: 0.0197 - val_loss: 0.0142
 - val_f1: 0.9864
 - out_of_sample_accuracy: 0.7405
Epoch 19/100
 - 1s - loss: 0.0187 - val_loss: 0.0138
 - val_f1: 0.9868
 - out_of_sample_accuracy: 0.7424
Epoch 20/100
 - 1s - loss: 0.0172 - val_loss: 0.0133
 - val_f1: 0.9884
 - out_of_sample_accuracy: 0.7492
Epoch 21/100
 - 1s - loss: 0.0166 - val_loss: 0.0125
2020-01-13 20:48:32,364 [INFO] epoch = 20. Intermediate model saved to results_additional_exps/train_time_nsl_lstm_deep_rep3/_model_epoch_20.pickle
 - val_f1: 0.9893
 - out_of_sample_accuracy: 0.7511
Epoch 22/100
 - 1s - loss: 0.0160 - val_loss: 0.0121
 - val_f1: 0.9895
 - out_of_sample_accuracy: 0.7505
Epoch 23/100
 - 1s - loss: 0.0153 - val_loss: 0.0119
 - val_f1: 0.9896
 - out_of_sample_accuracy: 0.7528
Epoch 24/100
 - 1s - loss: 0.0150 - val_loss: 0.0116
 - val_f1: 0.9897
 - out_of_sample_accuracy: 0.7525
Epoch 25/100
 - 1s - loss: 0.0140 - val_loss: 0.0112
 - val_f1: 0.9906
 - out_of_sample_accuracy: 0.7522
Epoch 26/100
 - 1s - loss: 0.0138 - val_loss: 0.0110
2020-01-13 20:48:37,963 [INFO] StopperOnGoal: reached goal_metric (accuracy). Stopping training. goal_metric = 0.7551, current_metric = 0.7551, num_epochs = 26
2020-01-13 20:48:37,964 [INFO] WeightRestorer::on_train_end(): restoring best weights
2020-01-13 20:48:38,871 [INFO] Last epoch loss evaluation: train_loss = 0.008716, val_loss = 0.010996
2020-01-13 20:48:38,871 [INFO] Training complete. time_to_train = 34.40 sec, 0.57 min
2020-01-13 20:48:38,877 [INFO] Model saved to results_additional_exps/train_time_nsl_lstm_deep_rep3/best_model.pickle
2020-01-13 20:48:38,878 [INFO] Training history saved to: results_additional_exps/train_time_nsl_lstm_deep_rep3/training_error_history.csv
2020-01-13 20:48:39,005 [INFO] Plot saved to: results_additional_exps/train_time_nsl_lstm_deep_rep3/training_error_history.png
2020-01-13 20:48:39,122 [INFO] Plot saved to: results_additional_exps/train_time_nsl_lstm_deep_rep3/training_f1_history.png
2020-01-13 20:48:39,122 [INFO] Making predictions on training, validation, testing data
2020-01-13 20:48:39,800 [INFO] Making predictions complete. time_to_predict = 0.68 sec, 0.01 min
2020-01-13 20:48:39,803 [INFO] Evaluating predictions (results)
/home/hasitha/anaconda3/lib/python3.7/site-packages/sklearn/metrics/classification.py:1143: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples.
  'precision', 'predicted', average, warn_for)
2020-01-13 20:48:40,095 [INFO] Dataset: Testing. Classification report below
2020-01-13 20:48:40,095 [INFO] 
              precision    recall  f1-score   support

         dos       0.96      0.84      0.89      7454
      normal       0.67      0.93      0.78      9708
       probe       0.73      0.73      0.73      2420
         r2l       0.91      0.05      0.10      2421
         u2r       0.00      0.00      0.00       533

   micro avg       0.76      0.76      0.76     22536
   macro avg       0.65      0.51      0.50     22536
weighted avg       0.78      0.76      0.72     22536

2020-01-13 20:48:40,095 [INFO] Overall accuracy (micro avg): 0.7620695775647852
/home/hasitha/sunanda/ids_experiments/utility.py:328: RuntimeWarning: invalid value encountered in true_divide
  PPV = TP / (TP + FP)    # Precision or positive predictive value
/home/hasitha/sunanda/ids_experiments/utility.py:332: RuntimeWarning: invalid value encountered in true_divide
  FDR = FP / (TP + FP)    # False discovery rate
2020-01-13 20:48:40,421 [INFO] Average metrics for Testing dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.7621         0.7621                       0.7621                0.0595                   0.2379  0.7621
1     Macro avg        0.9048         0.6536                       0.5100                0.0791                   0.4900  0.4999
2  Weighted avg        0.8634         0.7823                       0.7621                0.1577                   0.2379  0.7205
2020-01-13 20:48:40,763 [INFO] Dataset: Validation. Classification report below
2020-01-13 20:48:40,763 [INFO] 
              precision    recall  f1-score   support

         dos       0.99      1.00      1.00      9183
      normal       0.99      0.99      0.99     13460
       probe       0.99      0.98      0.98      2330
         r2l       0.93      0.68      0.79       199
         u2r       0.00      0.00      0.00        10

   micro avg       0.99      0.99      0.99     25182
   macro avg       0.78      0.73      0.75     25182
weighted avg       0.99      0.99      0.99     25182

2020-01-13 20:48:40,763 [INFO] Overall accuracy (micro avg): 0.991700420935589
2020-01-13 20:48:41,143 [INFO] Average metrics for Validation dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9917         0.9917                       0.9917                0.0021                   0.0083  0.9917
1     Macro avg        0.9967         0.7795                       0.7306                0.0030                   0.2694  0.7514
2  Weighted avg        0.9948         0.9912                       0.9917                0.0066                   0.0083  0.9913
2020-01-13 20:48:42,648 [INFO] Dataset: Training. Classification report below
2020-01-13 20:48:42,648 [INFO] 
              precision    recall  f1-score   support

         dos       1.00      1.00      1.00     36734
      normal       0.99      1.00      0.99     53871
       probe       0.99      0.98      0.98      9321
         r2l       0.92      0.73      0.82       796
         u2r       0.00      0.00      0.00        42

   micro avg       0.99      0.99      0.99    100764
   macro avg       0.78      0.74      0.76    100764
weighted avg       0.99      0.99      0.99    100764

2020-01-13 20:48:42,648 [INFO] Overall accuracy (micro avg): 0.9928248183875193
2020-01-13 20:48:44,351 [INFO] Average metrics for Training dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9928         0.9928                       0.9928                0.0018                   0.0072  0.9928
1     Macro avg        0.9971         0.7799                       0.7408                0.0026                   0.2592  0.7582
2  Weighted avg        0.9956         0.9923                       0.9928                0.0059                   0.0072  0.9925
2020-01-13 20:48:44,371 [INFO] Results saved to: results_additional_exps/train_time_nsl_lstm_deep_rep3/train_time_nsl_lstm_deep_rep3_results.xlsx
2020-01-13 20:48:44,371 [INFO] ================= Finished running experiment no. 3 ================= 

2020-01-13 20:48:44,374 [INFO] Created directory: results_additional_exps/train_time_ids17_lstm_deep_rep1
2020-01-13 20:48:44,375 [INFO] Initialized logging. log_filename = results_additional_exps/train_time_ids17_lstm_deep_rep1/run_log.log
2020-01-13 20:48:44,375 [INFO] ================= Running experiment no. 1  ================= 

2020-01-13 20:48:44,375 [INFO] Experiment parameters given below
2020-01-13 20:48:44,375 [INFO] 
{'experiment_num': 1, 'results_dir': 'results_additional_exps/train_time_ids17_lstm_deep_rep1', 'model': 'lstm', 'model_type': 'classifier', 'normal_label': 'BENIGN', 'lstm_time_steps': 32, 'lstm_layer_units': [64, 32], 'lstm_layer_activations': ['relu', 'relu'], 'lstm_layer_dropout_rates': [0.2, 0.2], 'batch_size': 256, 'epochs': 100, 'early_stop_patience': 100, 'goal_metric': 0.994779286, 'training_set': 'train_set_only', 'dataset_dir': '../Datasets/full_datasets/ids2017', 'description': 'train_time_ids17_lstm_deep_rep1'}
2020-01-13 20:48:44,375 [INFO] Created tensorboard log directory: results_additional_exps/train_time_ids17_lstm_deep_rep1/tf_logs_run_2020_01_13-20_48_44
2020-01-13 20:48:44,375 [INFO] Loading datsets from: ../Datasets/full_datasets/ids2017
2020-01-13 20:48:44,375 [INFO] Reading X, y files
2020-01-13 20:48:44,375 [INFO] Reading HDF dataset ../Datasets/full_datasets/ids2017/X_train.h5
2020-01-13 20:48:48,583 [INFO] Reading complete. time_to_read=4.21 seconds
2020-01-13 20:48:48,583 [INFO] Reading HDF dataset ../Datasets/full_datasets/ids2017/X_val.h5
2020-01-13 20:48:50,023 [INFO] Reading complete. time_to_read=1.44 seconds
2020-01-13 20:48:50,023 [INFO] Reading HDF dataset ../Datasets/full_datasets/ids2017/X_test.h5
2020-01-13 20:48:51,453 [INFO] Reading complete. time_to_read=1.43 seconds
2020-01-13 20:48:51,453 [INFO] Reading HDF dataset ../Datasets/full_datasets/ids2017/y_train.h5
2020-01-13 20:48:51,682 [INFO] Reading complete. time_to_read=0.23 seconds
2020-01-13 20:48:51,682 [INFO] Reading HDF dataset ../Datasets/full_datasets/ids2017/y_val.h5
2020-01-13 20:48:51,756 [INFO] Reading complete. time_to_read=0.07 seconds
2020-01-13 20:48:51,756 [INFO] Reading HDF dataset ../Datasets/full_datasets/ids2017/y_test.h5
2020-01-13 20:48:51,833 [INFO] Reading complete. time_to_read=0.08 seconds
2020-01-13 20:48:54,260 [INFO] Preparing flow sequences
2020-01-13 20:49:16,167 [INFO] Extracting flows complete. time_taken = 21.91 sec
2020-01-13 20:49:17,317 [INFO] Initializing model
2020-01-13 20:49:17,765 [INFO] _________________________________________________________________
2020-01-13 20:49:17,765 [INFO] Layer (type)                 Output Shape              Param #   
2020-01-13 20:49:17,765 [INFO] =================================================================
2020-01-13 20:49:17,765 [INFO] lstm_7 (LSTM)                (None, 32, 64)            36608     
2020-01-13 20:49:17,765 [INFO] _________________________________________________________________
2020-01-13 20:49:17,765 [INFO] batch_normalization_7 (Batch (None, 32, 64)            256       
2020-01-13 20:49:17,765 [INFO] _________________________________________________________________
2020-01-13 20:49:17,765 [INFO] dropout_7 (Dropout)          (None, 32, 64)            0         
2020-01-13 20:49:17,765 [INFO] _________________________________________________________________
2020-01-13 20:49:17,765 [INFO] lstm_8 (LSTM)                (None, 32, 32)            12416     
2020-01-13 20:49:17,765 [INFO] _________________________________________________________________
2020-01-13 20:49:17,765 [INFO] batch_normalization_8 (Batch (None, 32, 32)            128       
2020-01-13 20:49:17,765 [INFO] _________________________________________________________________
2020-01-13 20:49:17,765 [INFO] dropout_8 (Dropout)          (None, 32, 32)            0         
2020-01-13 20:49:17,765 [INFO] _________________________________________________________________
2020-01-13 20:49:17,766 [INFO] time_distributed_4 (TimeDist (None, 32, 12)            396       
2020-01-13 20:49:17,766 [INFO] =================================================================
2020-01-13 20:49:17,766 [INFO] Total params: 49,804
2020-01-13 20:49:17,766 [INFO] Trainable params: 49,612
2020-01-13 20:49:17,766 [INFO] Non-trainable params: 192
2020-01-13 20:49:17,766 [INFO] _________________________________________________________________
2020-01-13 20:49:17,766 [INFO] Training model
 - val_f1: 0.9910
 - out_of_sample_accuracy: 0.7551
Train on 53021 samples, validate on 17673 samples
Epoch 1/100
 - 14s - loss: 0.1430 - val_loss: 0.0523
 - val_f1: 0.8491
 - out_of_sample_accuracy: 0.8709
Epoch 2/100
 - 13s - loss: 0.0374 - val_loss: 0.0363
 - val_f1: 0.9054
 - out_of_sample_accuracy: 0.9104
Epoch 3/100
 - 13s - loss: 0.0270 - val_loss: 0.0264
 - val_f1: 0.9253
 - out_of_sample_accuracy: 0.9289
Epoch 4/100
 - 13s - loss: 0.0224 - val_loss: 0.0243
 - val_f1: 0.9360
 - out_of_sample_accuracy: 0.9369
Epoch 5/100
 - 13s - loss: 0.0195 - val_loss: 0.0177
 - val_f1: 0.9459
 - out_of_sample_accuracy: 0.9492
Epoch 6/100
 - 13s - loss: 0.0173 - val_loss: 0.0161
 - val_f1: 0.9614
 - out_of_sample_accuracy: 0.9629
Epoch 7/100
 - 13s - loss: 0.0156 - val_loss: 0.0125
 - val_f1: 0.9683
 - out_of_sample_accuracy: 0.9690
Epoch 8/100
 - 13s - loss: 0.0142 - val_loss: 0.0115
 - val_f1: 0.9708
 - out_of_sample_accuracy: 0.9712
Epoch 9/100
 - 13s - loss: 0.0133 - val_loss: 0.0118
 - val_f1: 0.9716
 - out_of_sample_accuracy: 0.9725
Epoch 10/100
 - 13s - loss: 0.0124 - val_loss: 0.0107
 - val_f1: 0.9740
 - out_of_sample_accuracy: 0.9745
Epoch 11/100
 - 13s - loss: 0.0117 - val_loss: 0.0094
/home/hasitha/anaconda3/lib/python3.7/site-packages/sklearn/metrics/classification.py:1143: UndefinedMetricWarning: F-score is ill-defined and being set to 0.0 in labels with no predicted samples.
  'precision', 'predicted', average, warn_for)
2020-01-13 20:52:40,944 [INFO] epoch = 10. Intermediate model saved to results_additional_exps/train_time_ids17_lstm_deep_rep1/_model_epoch_10.pickle
 - val_f1: 0.9757
 - out_of_sample_accuracy: 0.9756
Epoch 12/100
 - 13s - loss: 0.0111 - val_loss: 0.0088
 - val_f1: 0.9772
 - out_of_sample_accuracy: 0.9767
Epoch 13/100
 - 13s - loss: 0.0106 - val_loss: 0.0089
 - val_f1: 0.9769
 - out_of_sample_accuracy: 0.9771
Epoch 14/100
 - 13s - loss: 0.0100 - val_loss: 0.0088
 - val_f1: 0.9751
 - out_of_sample_accuracy: 0.9759
Epoch 15/100
 - 13s - loss: 0.0096 - val_loss: 0.0089
 - val_f1: 0.9721
 - out_of_sample_accuracy: 0.9731
Epoch 16/100
 - 13s - loss: 0.0088 - val_loss: 0.0100
 - val_f1: 0.9625
 - out_of_sample_accuracy: 0.9658
Epoch 17/100
 - 13s - loss: 0.0076 - val_loss: 0.0209
 - val_f1: 0.9552
 - out_of_sample_accuracy: 0.9596
Epoch 18/100
 - 13s - loss: 0.0065 - val_loss: 0.0063
 - val_f1: 0.9839
 - out_of_sample_accuracy: 0.9839
Epoch 19/100
 - 13s - loss: 0.0060 - val_loss: 0.0060
 - val_f1: 0.9855
 - out_of_sample_accuracy: 0.9860
Epoch 20/100
 - 13s - loss: 0.0058 - val_loss: 0.0065
 - val_f1: 0.9836
 - out_of_sample_accuracy: 0.9835
Epoch 21/100
 - 13s - loss: 0.0055 - val_loss: 0.0044
2020-01-13 20:55:45,299 [INFO] epoch = 20. Intermediate model saved to results_additional_exps/train_time_ids17_lstm_deep_rep1/_model_epoch_20.pickle
 - val_f1: 0.9910
 - out_of_sample_accuracy: 0.9913
Epoch 22/100
 - 13s - loss: 0.0056 - val_loss: 0.0033
 - val_f1: 0.9935
 - out_of_sample_accuracy: 0.9938
Epoch 23/100
 - 13s - loss: 0.0051 - val_loss: 0.0032
 - val_f1: 0.9926
 - out_of_sample_accuracy: 0.9930
Epoch 24/100
 - 13s - loss: 0.0049 - val_loss: 0.0033
 - val_f1: 0.9938
 - out_of_sample_accuracy: 0.9940
Epoch 25/100
 - 13s - loss: 0.0047 - val_loss: 0.0035
 - val_f1: 0.9917
 - out_of_sample_accuracy: 0.9920
Epoch 26/100
 - 13s - loss: 0.0046 - val_loss: 0.0049
 - val_f1: 0.9888
 - out_of_sample_accuracy: 0.9891
Epoch 27/100
 - 13s - loss: 0.0046 - val_loss: 0.0036
 - val_f1: 0.9915
 - out_of_sample_accuracy: 0.9917
Epoch 28/100
 - 13s - loss: 0.0043 - val_loss: 0.0053
 - val_f1: 0.9854
 - out_of_sample_accuracy: 0.9859
Epoch 29/100
 - 13s - loss: 0.0042 - val_loss: 0.0029
 - val_f1: 0.9941
 - out_of_sample_accuracy: 0.9943
Epoch 30/100
 - 13s - loss: 0.0041 - val_loss: 0.0036
 - val_f1: 0.9926
 - out_of_sample_accuracy: 0.9930
Epoch 31/100
 - 13s - loss: 0.0039 - val_loss: 0.0032
2020-01-13 20:58:49,569 [INFO] epoch = 30. Intermediate model saved to results_additional_exps/train_time_ids17_lstm_deep_rep1/_model_epoch_30.pickle
 - val_f1: 0.9930
 - out_of_sample_accuracy: 0.9933
Epoch 32/100
 - 13s - loss: 0.0041 - val_loss: 0.0039
 - val_f1: 0.9906
 - out_of_sample_accuracy: 0.9908
Epoch 33/100
 - 13s - loss: 0.0039 - val_loss: 0.0029
 - val_f1: 0.9941
 - out_of_sample_accuracy: 0.9945
Epoch 34/100
 - 13s - loss: 0.0043 - val_loss: 0.0029
 - val_f1: 0.9941
 - out_of_sample_accuracy: 0.9945
Epoch 35/100
 - 13s - loss: 0.0038 - val_loss: 0.0028
 - val_f1: 0.9933
 - out_of_sample_accuracy: 0.9935
Epoch 36/100
 - 13s - loss: 0.0039 - val_loss: 0.0030
 - val_f1: 0.9938
 - out_of_sample_accuracy: 0.9942
Epoch 37/100
 - 13s - loss: 0.0037 - val_loss: 0.0036
 - val_f1: 0.9919
 - out_of_sample_accuracy: 0.9922
Epoch 38/100
 - 13s - loss: 0.0037 - val_loss: 0.0059
 - val_f1: 0.9823
 - out_of_sample_accuracy: 0.9834
Epoch 39/100
 - 13s - loss: 0.0051 - val_loss: 0.0035
 - val_f1: 0.9917
 - out_of_sample_accuracy: 0.9919
Epoch 40/100
 - 13s - loss: 0.0040 - val_loss: 0.0037
 - val_f1: 0.9917
 - out_of_sample_accuracy: 0.9918
Epoch 41/100
 - 13s - loss: 0.0038 - val_loss: 0.0036
2020-01-13 21:01:54,083 [INFO] epoch = 40. Intermediate model saved to results_additional_exps/train_time_ids17_lstm_deep_rep1/_model_epoch_40.pickle
 - val_f1: 0.9919
 - out_of_sample_accuracy: 0.9922
Epoch 42/100
 - 13s - loss: 0.0037 - val_loss: 0.0031
 - val_f1: 0.9924
 - out_of_sample_accuracy: 0.9927
Epoch 43/100
 - 13s - loss: 0.0036 - val_loss: 0.0032
 - val_f1: 0.9934
 - out_of_sample_accuracy: 0.9938
Epoch 44/100
 - 13s - loss: 0.0035 - val_loss: 0.0028
 - val_f1: 0.9926
 - out_of_sample_accuracy: 0.9929
Epoch 45/100
 - 13s - loss: 0.0034 - val_loss: 0.0031
 - val_f1: 0.9932
 - out_of_sample_accuracy: 0.9937
Epoch 46/100
 - 13s - loss: 0.0034 - val_loss: 0.0026
2020-01-13 21:03:32,023 [INFO] StopperOnGoal: reached goal_metric (accuracy). Stopping training. goal_metric = 0.9948, current_metric = 0.9952, num_epochs = 46
2020-01-13 21:03:32,024 [INFO] WeightRestorer::on_train_end(): restoring best weights
2020-01-13 21:03:42,393 [INFO] Last epoch loss evaluation: train_loss = 0.002482, val_loss = 0.002601
2020-01-13 21:03:42,393 [INFO] Training complete. time_to_train = 864.63 sec, 14.41 min
2020-01-13 21:03:42,398 [INFO] Model saved to results_additional_exps/train_time_ids17_lstm_deep_rep1/best_model.pickle
2020-01-13 21:03:42,400 [INFO] Training history saved to: results_additional_exps/train_time_ids17_lstm_deep_rep1/training_error_history.csv
2020-01-13 21:03:42,531 [INFO] Plot saved to: results_additional_exps/train_time_ids17_lstm_deep_rep1/training_error_history.png
2020-01-13 21:03:42,653 [INFO] Plot saved to: results_additional_exps/train_time_ids17_lstm_deep_rep1/training_f1_history.png
2020-01-13 21:03:42,653 [INFO] Making predictions on training, validation, testing data
2020-01-13 21:03:54,784 [INFO] Making predictions complete. time_to_predict = 12.13 sec, 0.20 min
2020-01-13 21:03:54,846 [INFO] Evaluating predictions (results)
/home/hasitha/anaconda3/lib/python3.7/site-packages/sklearn/metrics/classification.py:1143: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples.
  'precision', 'predicted', average, warn_for)
2020-01-13 21:04:05,262 [INFO] Dataset: Testing. Classification report below
2020-01-13 21:04:05,263 [INFO] 
                        precision    recall  f1-score   support

                BENIGN       1.00      1.00      1.00    454243
                   Bot       0.90      0.38      0.54       391
                  DDoS       1.00      1.00      1.00     25604
         DoS GoldenEye       0.99      0.98      0.98      2058
              DoS Hulk       0.98      0.99      0.99     46023
      DoS Slowhttptest       0.89      0.99      0.93      1100
         DoS slowloris       0.97      0.98      0.98      1159
           FTP-Patator       1.00      0.99      0.99      1586
              PortScan       0.99      1.00      1.00     31761
           SSH-Patator       0.94      0.98      0.96      1179
Web Attack Brute Force       1.00      0.09      0.16       302
        Web Attack XSS       0.00      0.00      0.00       130

             micro avg       1.00      1.00      1.00    565536
             macro avg       0.89      0.78      0.79    565536
          weighted avg       1.00      1.00      0.99    565536

2020-01-13 21:04:05,263 [INFO] Overall accuracy (micro avg): 0.9952664375035365
/home/hasitha/sunanda/ids_experiments/utility.py:328: RuntimeWarning: invalid value encountered in true_divide
  PPV = TP / (TP + FP)    # Precision or positive predictive value
/home/hasitha/sunanda/ids_experiments/utility.py:332: RuntimeWarning: invalid value encountered in true_divide
  FDR = FP / (TP + FP)    # False discovery rate
2020-01-13 21:04:17,068 [INFO] Average metrics for Testing dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9953         0.9953                       0.9953                0.0004                   0.0047  0.9953
1     Macro avg        0.9992         0.8874                       0.7814                0.0011                   0.2186  0.7938
2  Weighted avg        0.9961         0.9951                       0.9953                0.0082                   0.0047  0.9949
2020-01-13 21:04:27,481 [INFO] Dataset: Validation. Classification report below
2020-01-13 21:04:27,481 [INFO] 
                        precision    recall  f1-score   support

                BENIGN       1.00      1.00      1.00    454243
                   Bot       0.90      0.35      0.50       391
                  DDoS       1.00      1.00      1.00     25605
         DoS GoldenEye       0.99      0.97      0.98      2059
              DoS Hulk       0.98      0.99      0.99     46023
      DoS Slowhttptest       0.89      0.98      0.93      1099
         DoS slowloris       0.97      0.98      0.98      1159
           FTP-Patator       0.99      0.99      0.99      1587
              PortScan       0.99      1.00      1.00     31758
           SSH-Patator       0.94      0.97      0.95      1180
Web Attack Brute Force       0.79      0.05      0.09       301
        Web Attack XSS       0.00      0.00      0.00       131

             micro avg       1.00      1.00      1.00    565536
             macro avg       0.87      0.77      0.78    565536
          weighted avg       0.99      1.00      0.99    565536

2020-01-13 21:04:27,481 [INFO] Overall accuracy (micro avg): 0.9951939399083347
2020-01-13 21:04:39,337 [INFO] Average metrics for Validation dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9952         0.9952                       0.9952                0.0004                   0.0048  0.9952
1     Macro avg        0.9992         0.8691                       0.7738                0.0011                   0.2262  0.7841
2  Weighted avg        0.9960         0.9949                       0.9952                0.0084                   0.0048  0.9948
2020-01-13 21:05:13,557 [INFO] Dataset: Training. Classification report below
2020-01-13 21:05:13,557 [INFO] 
                        precision    recall  f1-score   support

                BENIGN       1.00      1.00      1.00   1362781
                   Bot       0.91      0.37      0.53      1174
                  DDoS       1.00      1.00      1.00     76815
         DoS GoldenEye       0.99      0.98      0.98      6176
              DoS Hulk       0.98      0.99      0.99    138073
      DoS Slowhttptest       0.90      0.99      0.94      3300
         DoS slowloris       0.97      0.99      0.98      3478
           FTP-Patator       0.99      0.99      0.99      4761
              PortScan       0.99      1.00      1.00     95281
           SSH-Patator       0.95      0.98      0.97      3538
Web Attack Brute Force       0.83      0.07      0.13       904
        Web Attack XSS       0.00      0.00      0.00       391

             micro avg       1.00      1.00      1.00   1696672
             macro avg       0.88      0.78      0.79   1696672
          weighted avg       1.00      1.00      1.00   1696672

2020-01-13 21:05:13,557 [INFO] Overall accuracy (micro avg): 0.9954752598027197
2020-01-13 21:05:52,418 [INFO] Average metrics for Training dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9955         0.9955                       0.9955                0.0004                   0.0045  0.9955
1     Macro avg        0.9992         0.8764                       0.7795                0.0010                   0.2205  0.7917
2  Weighted avg        0.9963         0.9952                       0.9955                0.0079                   0.0045  0.9951
2020-01-13 21:05:52,442 [INFO] Results saved to: results_additional_exps/train_time_ids17_lstm_deep_rep1/train_time_ids17_lstm_deep_rep1_results.xlsx
2020-01-13 21:05:52,447 [INFO] ================= Finished running experiment no. 1 ================= 

2020-01-13 21:05:52,516 [INFO] Created directory: results_additional_exps/train_time_ids17_lstm_deep_rep2
2020-01-13 21:05:52,516 [INFO] Initialized logging. log_filename = results_additional_exps/train_time_ids17_lstm_deep_rep2/run_log.log
2020-01-13 21:05:52,517 [INFO] ================= Running experiment no. 2  ================= 

2020-01-13 21:05:52,517 [INFO] Experiment parameters given below
2020-01-13 21:05:52,517 [INFO] 
{'experiment_num': 2, 'results_dir': 'results_additional_exps/train_time_ids17_lstm_deep_rep2', 'model': 'lstm', 'model_type': 'classifier', 'normal_label': 'BENIGN', 'lstm_time_steps': 32, 'lstm_layer_units': [64, 32], 'lstm_layer_activations': ['relu', 'relu'], 'lstm_layer_dropout_rates': [0.2, 0.2], 'batch_size': 256, 'epochs': 100, 'early_stop_patience': 100, 'goal_metric': 0.994779286, 'training_set': 'train_set_only', 'dataset_dir': '../Datasets/full_datasets/ids2017', 'description': 'train_time_ids17_lstm_deep_rep2'}
2020-01-13 21:05:52,517 [INFO] Created tensorboard log directory: results_additional_exps/train_time_ids17_lstm_deep_rep2/tf_logs_run_2020_01_13-21_05_52
2020-01-13 21:05:52,517 [INFO] Loading datsets from: ../Datasets/full_datasets/ids2017
2020-01-13 21:05:52,517 [INFO] Reading X, y files
2020-01-13 21:05:52,517 [INFO] Reading HDF dataset ../Datasets/full_datasets/ids2017/X_train.h5
2020-01-13 21:05:56,675 [INFO] Reading complete. time_to_read=4.16 seconds
2020-01-13 21:05:56,676 [INFO] Reading HDF dataset ../Datasets/full_datasets/ids2017/X_val.h5
2020-01-13 21:05:58,106 [INFO] Reading complete. time_to_read=1.43 seconds
2020-01-13 21:05:58,106 [INFO] Reading HDF dataset ../Datasets/full_datasets/ids2017/X_test.h5
2020-01-13 21:05:59,539 [INFO] Reading complete. time_to_read=1.43 seconds
2020-01-13 21:05:59,539 [INFO] Reading HDF dataset ../Datasets/full_datasets/ids2017/y_train.h5
2020-01-13 21:05:59,761 [INFO] Reading complete. time_to_read=0.22 seconds
2020-01-13 21:05:59,761 [INFO] Reading HDF dataset ../Datasets/full_datasets/ids2017/y_val.h5
2020-01-13 21:05:59,835 [INFO] Reading complete. time_to_read=0.07 seconds
2020-01-13 21:05:59,835 [INFO] Reading HDF dataset ../Datasets/full_datasets/ids2017/y_test.h5
2020-01-13 21:05:59,909 [INFO] Reading complete. time_to_read=0.07 seconds
2020-01-13 21:06:02,324 [INFO] Preparing flow sequences
2020-01-13 21:06:24,264 [INFO] Extracting flows complete. time_taken = 21.94 sec
2020-01-13 21:06:25,412 [INFO] Initializing model
2020-01-13 21:06:25,859 [INFO] _________________________________________________________________
2020-01-13 21:06:25,859 [INFO] Layer (type)                 Output Shape              Param #   
2020-01-13 21:06:25,859 [INFO] =================================================================
2020-01-13 21:06:25,859 [INFO] lstm_9 (LSTM)                (None, 32, 64)            36608     
2020-01-13 21:06:25,859 [INFO] _________________________________________________________________
2020-01-13 21:06:25,859 [INFO] batch_normalization_9 (Batch (None, 32, 64)            256       
2020-01-13 21:06:25,859 [INFO] _________________________________________________________________
2020-01-13 21:06:25,859 [INFO] dropout_9 (Dropout)          (None, 32, 64)            0         
2020-01-13 21:06:25,859 [INFO] _________________________________________________________________
2020-01-13 21:06:25,860 [INFO] lstm_10 (LSTM)               (None, 32, 32)            12416     
2020-01-13 21:06:25,860 [INFO] _________________________________________________________________
2020-01-13 21:06:25,860 [INFO] batch_normalization_10 (Batc (None, 32, 32)            128       
2020-01-13 21:06:25,860 [INFO] _________________________________________________________________
2020-01-13 21:06:25,860 [INFO] dropout_10 (Dropout)         (None, 32, 32)            0         
2020-01-13 21:06:25,860 [INFO] _________________________________________________________________
2020-01-13 21:06:25,860 [INFO] time_distributed_5 (TimeDist (None, 32, 12)            396       
2020-01-13 21:06:25,860 [INFO] =================================================================
2020-01-13 21:06:25,860 [INFO] Total params: 49,804
2020-01-13 21:06:25,860 [INFO] Trainable params: 49,612
2020-01-13 21:06:25,860 [INFO] Non-trainable params: 192
2020-01-13 21:06:25,860 [INFO] _________________________________________________________________
2020-01-13 21:06:25,860 [INFO] Training model
 - val_f1: 0.9948
 - out_of_sample_accuracy: 0.9952
Train on 53021 samples, validate on 17673 samples
Epoch 1/100
 - 14s - loss: 0.1950 - val_loss: 0.1001
 - val_f1: 0.7783
 - out_of_sample_accuracy: 0.8048
Epoch 2/100
 - 13s - loss: 0.1027 - val_loss: 0.0905
 - val_f1: 0.7815
 - out_of_sample_accuracy: 0.8306
Epoch 3/100
 - 13s - loss: 0.0909 - val_loss: 0.0847
 - val_f1: 0.7977
 - out_of_sample_accuracy: 0.8399
Epoch 4/100
 - 13s - loss: 0.0865 - val_loss: 0.0830
 - val_f1: 0.7988
 - out_of_sample_accuracy: 0.8448
Epoch 5/100
 - 13s - loss: 0.0832 - val_loss: 0.0823
 - val_f1: 0.8050
 - out_of_sample_accuracy: 0.8487
Epoch 6/100
 - 13s - loss: 0.0818 - val_loss: 0.0810
 - val_f1: 0.8117
 - out_of_sample_accuracy: 0.8532
Epoch 7/100
 - 13s - loss: 0.0806 - val_loss: 0.0800
 - val_f1: 0.8152
 - out_of_sample_accuracy: 0.8562
Epoch 8/100
 - 13s - loss: 0.0797 - val_loss: 0.0796
 - val_f1: 0.8182
 - out_of_sample_accuracy: 0.8579
Epoch 9/100
 - 13s - loss: 0.0789 - val_loss: 0.0788
 - val_f1: 0.8234
 - out_of_sample_accuracy: 0.8612
Epoch 10/100
 - 13s - loss: 0.0783 - val_loss: 0.0778
 - val_f1: 0.8281
 - out_of_sample_accuracy: 0.8645
Epoch 11/100
 - 13s - loss: 0.0797 - val_loss: 0.0777
/home/hasitha/anaconda3/lib/python3.7/site-packages/sklearn/metrics/classification.py:1143: UndefinedMetricWarning: F-score is ill-defined and being set to 0.0 in labels with no predicted samples.
  'precision', 'predicted', average, warn_for)
2020-01-13 21:09:50,447 [INFO] epoch = 10. Intermediate model saved to results_additional_exps/train_time_ids17_lstm_deep_rep2/_model_epoch_10.pickle
 - val_f1: 0.8267
 - out_of_sample_accuracy: 0.8641
Epoch 12/100
 - 13s - loss: 0.0788 - val_loss: 0.0778
 - val_f1: 0.8263
 - out_of_sample_accuracy: 0.8638
Epoch 13/100
 - 13s - loss: 0.0781 - val_loss: 0.0767
 - val_f1: 0.8285
 - out_of_sample_accuracy: 0.8653
Epoch 14/100
 - 13s - loss: 0.0770 - val_loss: 0.0766
 - val_f1: 0.8263
 - out_of_sample_accuracy: 0.8638
Epoch 15/100
 - 13s - loss: 0.0757 - val_loss: 0.0753
 - val_f1: 0.8275
 - out_of_sample_accuracy: 0.8644
Epoch 16/100
 - 13s - loss: 0.0735 - val_loss: 0.0728
 - val_f1: 0.8324
 - out_of_sample_accuracy: 0.8680
Epoch 17/100
 - 13s - loss: 0.0695 - val_loss: 0.0676
 - val_f1: 0.8327
 - out_of_sample_accuracy: 0.8685
Epoch 18/100
 - 13s - loss: 0.0638 - val_loss: 0.0596
 - val_f1: 0.8365
 - out_of_sample_accuracy: 0.8702
Epoch 19/100
 - 13s - loss: 0.0585 - val_loss: 0.0522
 - val_f1: 0.8472
 - out_of_sample_accuracy: 0.8761
Epoch 20/100
 - 13s - loss: 0.0551 - val_loss: 0.0482
 - val_f1: 0.8556
 - out_of_sample_accuracy: 0.8805
Epoch 21/100
 - 13s - loss: 0.0527 - val_loss: 0.0455
2020-01-13 21:12:55,318 [INFO] epoch = 20. Intermediate model saved to results_additional_exps/train_time_ids17_lstm_deep_rep2/_model_epoch_20.pickle
 - val_f1: 0.8633
 - out_of_sample_accuracy: 0.8846
Epoch 22/100
 - 13s - loss: 0.0570 - val_loss: 0.1271
 - val_f1: 0.7024
 - out_of_sample_accuracy: 0.7579
Epoch 23/100
 - 13s - loss: 0.0964 - val_loss: 0.0996
 - val_f1: 0.7297
 - out_of_sample_accuracy: 0.8083
Epoch 24/100
 - 13s - loss: 0.0891 - val_loss: 0.0939
 - val_f1: 0.7490
 - out_of_sample_accuracy: 0.8172
Epoch 25/100
 - 13s - loss: 0.0871 - val_loss: 0.0869
 - val_f1: 0.7667
 - out_of_sample_accuracy: 0.8256
Epoch 26/100
 - 13s - loss: 0.0859 - val_loss: 0.0820
 - val_f1: 0.7829
 - out_of_sample_accuracy: 0.8333
Epoch 27/100
 - 13s - loss: 0.0911 - val_loss: 0.0931
 - val_f1: 0.7634
 - out_of_sample_accuracy: 0.8224
Epoch 28/100
 - 13s - loss: 0.0893 - val_loss: 0.0911
 - val_f1: 0.7726
 - out_of_sample_accuracy: 0.8288
Epoch 29/100
 - 13s - loss: 0.0870 - val_loss: 0.0890
 - val_f1: 0.7765
 - out_of_sample_accuracy: 0.8313
Epoch 30/100
 - 13s - loss: 0.0860 - val_loss: 0.0851
 - val_f1: 0.7803
 - out_of_sample_accuracy: 0.8331
Epoch 31/100
 - 13s - loss: 0.0851 - val_loss: 0.0810
2020-01-13 21:16:00,608 [INFO] epoch = 30. Intermediate model saved to results_additional_exps/train_time_ids17_lstm_deep_rep2/_model_epoch_30.pickle
 - val_f1: 0.7866
 - out_of_sample_accuracy: 0.8365
Epoch 32/100
 - 13s - loss: 0.0843 - val_loss: 0.0789
 - val_f1: 0.7918
 - out_of_sample_accuracy: 0.8390
Epoch 33/100
 - 13s - loss: 0.0836 - val_loss: 0.0776
 - val_f1: 0.7942
 - out_of_sample_accuracy: 0.8397
Epoch 34/100
 - 13s - loss: 0.0867 - val_loss: 0.0831
 - val_f1: 0.7830
 - out_of_sample_accuracy: 0.8338
Epoch 35/100
 - 13s - loss: 0.0862 - val_loss: 0.0813
 - val_f1: 0.7869
 - out_of_sample_accuracy: 0.8354
Epoch 36/100
 - 13s - loss: 0.0853 - val_loss: 0.0800
 - val_f1: 0.7899
 - out_of_sample_accuracy: 0.8366
Epoch 37/100
 - 13s - loss: 0.0840 - val_loss: 0.0783
 - val_f1: 0.7931
 - out_of_sample_accuracy: 0.8387
Epoch 38/100
 - 13s - loss: 0.0821 - val_loss: 0.0765
 - val_f1: 0.7959
 - out_of_sample_accuracy: 0.8402
Epoch 39/100
 - 13s - loss: 0.0817 - val_loss: 0.0758
 - val_f1: 0.7986
 - out_of_sample_accuracy: 0.8411
Epoch 40/100
 - 13s - loss: 0.0798 - val_loss: 0.0733
 - val_f1: 0.8044
 - out_of_sample_accuracy: 0.8440
Epoch 41/100
 - 13s - loss: 0.0776 - val_loss: 0.0702
2020-01-13 21:19:06,119 [INFO] epoch = 40. Intermediate model saved to results_additional_exps/train_time_ids17_lstm_deep_rep2/_model_epoch_40.pickle
 - val_f1: 0.8121
 - out_of_sample_accuracy: 0.8478
Epoch 42/100
 - 13s - loss: 0.0752 - val_loss: 0.0686
 - val_f1: 0.8187
 - out_of_sample_accuracy: 0.8527
Epoch 43/100
 - 13s - loss: 0.0736 - val_loss: 0.0656
 - val_f1: 0.8284
 - out_of_sample_accuracy: 0.8570
Epoch 44/100
 - 13s - loss: 0.0725 - val_loss: 0.0650
 - val_f1: 0.8284
 - out_of_sample_accuracy: 0.8578
Epoch 45/100
 - 13s - loss: 0.0718 - val_loss: 0.0632
 - val_f1: 0.8318
 - out_of_sample_accuracy: 0.8585
Epoch 46/100
 - 13s - loss: 0.0704 - val_loss: 0.0625
 - val_f1: 0.8344
 - out_of_sample_accuracy: 0.8616
Epoch 47/100
 - 13s - loss: 0.0690 - val_loss: 0.0611
 - val_f1: 0.8355
 - out_of_sample_accuracy: 0.8618
Epoch 48/100
 - 13s - loss: 0.0682 - val_loss: 0.0613
 - val_f1: 0.8393
 - out_of_sample_accuracy: 0.8651
Epoch 49/100
 - 13s - loss: 0.0668 - val_loss: 0.0589
 - val_f1: 0.8427
 - out_of_sample_accuracy: 0.8666
Epoch 50/100
 - 13s - loss: 0.0654 - val_loss: 0.0571
 - val_f1: 0.8458
 - out_of_sample_accuracy: 0.8678
Epoch 51/100
 - 13s - loss: 0.0639 - val_loss: 0.0577
2020-01-13 21:22:11,633 [INFO] epoch = 50. Intermediate model saved to results_additional_exps/train_time_ids17_lstm_deep_rep2/_model_epoch_50.pickle
 - val_f1: 0.8456
 - out_of_sample_accuracy: 0.8611
Epoch 52/100
 - 13s - loss: 0.0624 - val_loss: 0.0530
 - val_f1: 0.8502
 - out_of_sample_accuracy: 0.8703
Epoch 53/100
 - 13s - loss: 0.0607 - val_loss: 0.0520
 - val_f1: 0.8552
 - out_of_sample_accuracy: 0.8684
Epoch 54/100
 - 13s - loss: 0.0594 - val_loss: 0.0494
 - val_f1: 0.8603
 - out_of_sample_accuracy: 0.8755
Epoch 55/100
 - 13s - loss: 0.0568 - val_loss: 0.0463
 - val_f1: 0.8687
 - out_of_sample_accuracy: 0.8772
Epoch 56/100
 - 13s - loss: 0.0550 - val_loss: 0.0447
 - val_f1: 0.8712
 - out_of_sample_accuracy: 0.8803
Epoch 57/100
 - 13s - loss: 0.0535 - val_loss: 0.0429
 - val_f1: 0.8806
 - out_of_sample_accuracy: 0.8865
Epoch 58/100
 - 13s - loss: 0.0524 - val_loss: 0.0442
 - val_f1: 0.8762
 - out_of_sample_accuracy: 0.8818
Epoch 59/100
 - 13s - loss: 0.0514 - val_loss: 0.0414
 - val_f1: 0.8828
 - out_of_sample_accuracy: 0.8878
Epoch 60/100
 - 13s - loss: 0.0501 - val_loss: 0.0419
 - val_f1: 0.8848
 - out_of_sample_accuracy: 0.8895
Epoch 61/100
 - 13s - loss: 0.0490 - val_loss: 0.0401
2020-01-13 21:25:17,598 [INFO] epoch = 60. Intermediate model saved to results_additional_exps/train_time_ids17_lstm_deep_rep2/_model_epoch_60.pickle
 - val_f1: 0.8871
 - out_of_sample_accuracy: 0.8898
Epoch 62/100
 - 13s - loss: 0.0474 - val_loss: 0.0386
 - val_f1: 0.8886
 - out_of_sample_accuracy: 0.8875
Epoch 63/100
 - 13s - loss: 0.0458 - val_loss: 0.0378
 - val_f1: 0.8865
 - out_of_sample_accuracy: 0.8882
Epoch 64/100
 - 13s - loss: 0.0438 - val_loss: 0.0369
 - val_f1: 0.8904
 - out_of_sample_accuracy: 0.8898
Epoch 65/100
 - 13s - loss: 0.0411 - val_loss: 0.0373
 - val_f1: 0.8792
 - out_of_sample_accuracy: 0.8899
Epoch 66/100
 - 13s - loss: 0.0386 - val_loss: 0.0350
 - val_f1: 0.8887
 - out_of_sample_accuracy: 0.8943
Epoch 67/100
 - 13s - loss: 0.0366 - val_loss: 0.0397
 - val_f1: 0.8605
 - out_of_sample_accuracy: 0.8851
Epoch 68/100
 - 13s - loss: 0.0348 - val_loss: 0.0350
 - val_f1: 0.8763
 - out_of_sample_accuracy: 0.8956
Epoch 69/100
 - 13s - loss: 0.0327 - val_loss: 0.0342
 - val_f1: 0.8783
 - out_of_sample_accuracy: 0.8989
Epoch 70/100
 - 13s - loss: 0.0311 - val_loss: 0.0323
 - val_f1: 0.8912
 - out_of_sample_accuracy: 0.9079
Epoch 71/100
 - 13s - loss: 0.0295 - val_loss: 0.0342
2020-01-13 21:28:23,479 [INFO] epoch = 70. Intermediate model saved to results_additional_exps/train_time_ids17_lstm_deep_rep2/_model_epoch_70.pickle
 - val_f1: 0.8826
 - out_of_sample_accuracy: 0.9070
Epoch 72/100
 - 13s - loss: 0.0289 - val_loss: 0.0339
 - val_f1: 0.8824
 - out_of_sample_accuracy: 0.9078
Epoch 73/100
 - 13s - loss: 0.0295 - val_loss: 0.0294
 - val_f1: 0.9099
 - out_of_sample_accuracy: 0.9196
Epoch 74/100
 - 13s - loss: 0.0274 - val_loss: 0.0287
 - val_f1: 0.9107
 - out_of_sample_accuracy: 0.9217
Epoch 75/100
 - 13s - loss: 0.0257 - val_loss: 0.0297
 - val_f1: 0.8993
 - out_of_sample_accuracy: 0.9164
Epoch 76/100
 - 13s - loss: 0.0247 - val_loss: 0.0264
 - val_f1: 0.9176
 - out_of_sample_accuracy: 0.9268
Epoch 77/100
 - 13s - loss: 0.0238 - val_loss: 0.0263
 - val_f1: 0.9155
 - out_of_sample_accuracy: 0.9256
Epoch 78/100
 - 13s - loss: 0.0230 - val_loss: 0.0249
 - val_f1: 0.9243
 - out_of_sample_accuracy: 0.9323
Epoch 79/100
 - 13s - loss: 0.0222 - val_loss: 0.0233
 - val_f1: 0.9313
 - out_of_sample_accuracy: 0.9375
Epoch 80/100
 - 13s - loss: 0.0216 - val_loss: 0.0226
 - val_f1: 0.9332
 - out_of_sample_accuracy: 0.9395
Epoch 81/100
 - 13s - loss: 0.0210 - val_loss: 0.0231
2020-01-13 21:31:29,210 [INFO] epoch = 80. Intermediate model saved to results_additional_exps/train_time_ids17_lstm_deep_rep2/_model_epoch_80.pickle
 - val_f1: 0.9301
 - out_of_sample_accuracy: 0.9376
Epoch 82/100
 - 13s - loss: 0.0204 - val_loss: 0.0216
 - val_f1: 0.9340
 - out_of_sample_accuracy: 0.9407
Epoch 83/100
 - 13s - loss: 0.0196 - val_loss: 0.0199
 - val_f1: 0.9410
 - out_of_sample_accuracy: 0.9454
Epoch 84/100
 - 13s - loss: 0.0188 - val_loss: 0.0188
 - val_f1: 0.9445
 - out_of_sample_accuracy: 0.9479
Epoch 85/100
 - 13s - loss: 0.0181 - val_loss: 0.0175
 - val_f1: 0.9512
 - out_of_sample_accuracy: 0.9539
Epoch 86/100
 - 13s - loss: 0.0175 - val_loss: 0.0160
 - val_f1: 0.9558
 - out_of_sample_accuracy: 0.9580
Epoch 87/100
 - 13s - loss: 0.0169 - val_loss: 0.0162
 - val_f1: 0.9547
 - out_of_sample_accuracy: 0.9563
Epoch 88/100
 - 13s - loss: 0.0163 - val_loss: 0.0150
 - val_f1: 0.9581
 - out_of_sample_accuracy: 0.9595
Epoch 89/100
 - 13s - loss: 0.0159 - val_loss: 0.0156
 - val_f1: 0.9553
 - out_of_sample_accuracy: 0.9562
Epoch 90/100
 - 13s - loss: 0.0155 - val_loss: 0.0147
 - val_f1: 0.9611
 - out_of_sample_accuracy: 0.9615
Epoch 91/100
 - 13s - loss: 0.0149 - val_loss: 0.0135
2020-01-13 21:34:35,406 [INFO] epoch = 90. Intermediate model saved to results_additional_exps/train_time_ids17_lstm_deep_rep2/_model_epoch_90.pickle
 - val_f1: 0.9627
 - out_of_sample_accuracy: 0.9629
Epoch 92/100
 - 13s - loss: 0.0146 - val_loss: 0.0134
 - val_f1: 0.9629
 - out_of_sample_accuracy: 0.9633
Epoch 93/100
 - 13s - loss: 0.0141 - val_loss: 0.0129
 - val_f1: 0.9650
 - out_of_sample_accuracy: 0.9655
Epoch 94/100
 - 13s - loss: 0.0137 - val_loss: 0.0119
 - val_f1: 0.9685
 - out_of_sample_accuracy: 0.9687
Epoch 95/100
 - 13s - loss: 0.0133 - val_loss: 0.0124
 - val_f1: 0.9656
 - out_of_sample_accuracy: 0.9660
Epoch 96/100
 - 13s - loss: 0.0129 - val_loss: 0.0116
 - val_f1: 0.9678
 - out_of_sample_accuracy: 0.9685
Epoch 97/100
 - 13s - loss: 0.0125 - val_loss: 0.0113
 - val_f1: 0.9688
 - out_of_sample_accuracy: 0.9693
Epoch 98/100
 - 13s - loss: 0.0123 - val_loss: 0.0104
 - val_f1: 0.9714
 - out_of_sample_accuracy: 0.9717
Epoch 99/100
 - 13s - loss: 0.0118 - val_loss: 0.0099
 - val_f1: 0.9728
 - out_of_sample_accuracy: 0.9732
Epoch 100/100
 - 13s - loss: 0.0114 - val_loss: 0.0091
2020-01-13 21:37:28,849 [INFO] StopperOnGoal: did not reach goal, num_epochs = 100
2020-01-13 21:37:28,849 [INFO] WeightRestorer::on_train_end(): restoring best weights
2020-01-13 21:37:39,293 [INFO] Last epoch loss evaluation: train_loss = 0.008939, val_loss = 0.009082
2020-01-13 21:37:39,293 [INFO] Training complete. time_to_train = 1873.43 sec, 31.22 min
2020-01-13 21:37:39,298 [INFO] Model saved to results_additional_exps/train_time_ids17_lstm_deep_rep2/best_model.pickle
2020-01-13 21:37:39,300 [INFO] Training history saved to: results_additional_exps/train_time_ids17_lstm_deep_rep2/training_error_history.csv
2020-01-13 21:37:39,452 [INFO] Plot saved to: results_additional_exps/train_time_ids17_lstm_deep_rep2/training_error_history.png
2020-01-13 21:37:39,579 [INFO] Plot saved to: results_additional_exps/train_time_ids17_lstm_deep_rep2/training_f1_history.png
2020-01-13 21:37:39,579 [INFO] Making predictions on training, validation, testing data
2020-01-13 21:37:51,940 [INFO] Making predictions complete. time_to_predict = 12.36 sec, 0.21 min
2020-01-13 21:37:52,001 [INFO] Evaluating predictions (results)
/home/hasitha/anaconda3/lib/python3.7/site-packages/sklearn/metrics/classification.py:1143: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples.
  'precision', 'predicted', average, warn_for)
2020-01-13 21:38:02,420 [INFO] Dataset: Testing. Classification report below
2020-01-13 21:38:02,421 [INFO] 
                        precision    recall  f1-score   support

                BENIGN       0.98      0.99      0.98    454243
                   Bot       0.00      0.00      0.00       391
                  DDoS       1.00      0.98      0.99     25604
         DoS GoldenEye       0.98      0.90      0.94      2058
              DoS Hulk       0.99      0.91      0.95     46023
      DoS Slowhttptest       0.85      0.92      0.88      1100
         DoS slowloris       0.97      0.78      0.87      1159
           FTP-Patator       0.86      0.96      0.90      1586
              PortScan       0.85      0.96      0.90     31761
           SSH-Patator       0.98      0.52      0.68      1179
Web Attack Brute Force       0.00      0.00      0.00       302
        Web Attack XSS       0.00      0.00      0.00       130

             micro avg       0.98      0.98      0.98    565536
             macro avg       0.71      0.66      0.67    565536
          weighted avg       0.97      0.98      0.97    565536

2020-01-13 21:38:02,421 [INFO] Overall accuracy (micro avg): 0.9750661319526962
/home/hasitha/sunanda/ids_experiments/utility.py:328: RuntimeWarning: invalid value encountered in true_divide
  PPV = TP / (TP + FP)    # Precision or positive predictive value
/home/hasitha/sunanda/ids_experiments/utility.py:332: RuntimeWarning: invalid value encountered in true_divide
  FDR = FP / (TP + FP)    # False discovery rate
/home/hasitha/sunanda/ids_experiments/utility.py:334: RuntimeWarning: invalid value encountered in true_divide
  F1 = (2 * PPV * TPR) / (PPV + TPR)  # F1 score
2020-01-13 21:38:14,237 [INFO] Average metrics for Testing dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9751         0.9751                       0.9751                0.0023                   0.0249  0.9751
1     Macro avg        0.9958         0.7051                       0.6600                0.0068                   0.3400  0.6749
2  Weighted avg        0.9789         0.9747                       0.9751                0.0570                   0.0249  0.9744
2020-01-13 21:38:24,623 [INFO] Dataset: Validation. Classification report below
2020-01-13 21:38:24,623 [INFO] 
                        precision    recall  f1-score   support

                BENIGN       0.98      0.99      0.98    454243
                   Bot       0.00      0.00      0.00       391
                  DDoS       1.00      0.98      0.99     25605
         DoS GoldenEye       0.97      0.89      0.93      2059
              DoS Hulk       0.99      0.91      0.95     46023
      DoS Slowhttptest       0.86      0.91      0.88      1099
         DoS slowloris       0.96      0.78      0.86      1159
           FTP-Patator       0.85      0.95      0.90      1587
              PortScan       0.85      0.96      0.90     31758
           SSH-Patator       0.97      0.53      0.68      1180
Web Attack Brute Force       0.00      0.00      0.00       301
        Web Attack XSS       0.00      0.00      0.00       131

             micro avg       0.98      0.98      0.98    565536
             macro avg       0.70      0.66      0.67    565536
          weighted avg       0.97      0.98      0.97    565536

2020-01-13 21:38:24,623 [INFO] Overall accuracy (micro avg): 0.9752606376959203
2020-01-13 21:38:36,441 [INFO] Average metrics for Validation dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9753         0.9753                       0.9753                0.0022                   0.0247  0.9753
1     Macro avg        0.9959         0.7032                       0.6590                0.0067                   0.3410  0.6738
2  Weighted avg        0.9790         0.9749                       0.9753                0.0561                   0.0247  0.9746
2020-01-13 21:39:10,746 [INFO] Dataset: Training. Classification report below
2020-01-13 21:39:10,746 [INFO] 
                        precision    recall  f1-score   support

                BENIGN       0.98      0.99      0.98   1362781
                   Bot       0.00      0.00      0.00      1174
                  DDoS       1.00      0.98      0.99     76815
         DoS GoldenEye       0.98      0.91      0.94      6176
              DoS Hulk       0.99      0.91      0.95    138073
      DoS Slowhttptest       0.87      0.93      0.90      3300
         DoS slowloris       0.96      0.80      0.88      3478
           FTP-Patator       0.85      0.96      0.90      4761
              PortScan       0.85      0.96      0.90     95281
           SSH-Patator       0.98      0.54      0.70      3538
Web Attack Brute Force       0.00      0.00      0.00       904
        Web Attack XSS       0.00      0.00      0.00       391

             micro avg       0.98      0.98      0.98   1696672
             macro avg       0.71      0.66      0.68   1696672
          weighted avg       0.98      0.98      0.97   1696672

2020-01-13 21:39:10,746 [INFO] Overall accuracy (micro avg): 0.9754967371418872
2020-01-13 21:39:49,712 [INFO] Average metrics for Training dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9755         0.9755                       0.9755                0.0022                   0.0245  0.9755
1     Macro avg        0.9959         0.7063                       0.6646                0.0067                   0.3354  0.6786
2  Weighted avg        0.9792         0.9752                       0.9755                0.0554                   0.0245  0.9748
2020-01-13 21:39:49,736 [INFO] Results saved to: results_additional_exps/train_time_ids17_lstm_deep_rep2/train_time_ids17_lstm_deep_rep2_results.xlsx
2020-01-13 21:39:49,740 [INFO] ================= Finished running experiment no. 2 ================= 

2020-01-13 21:39:49,809 [INFO] Created directory: results_additional_exps/train_time_ids17_lstm_deep_rep3
2020-01-13 21:39:49,809 [INFO] Initialized logging. log_filename = results_additional_exps/train_time_ids17_lstm_deep_rep3/run_log.log
2020-01-13 21:39:49,809 [INFO] ================= Running experiment no. 3  ================= 

2020-01-13 21:39:49,809 [INFO] Experiment parameters given below
2020-01-13 21:39:49,809 [INFO] 
{'experiment_num': 3, 'results_dir': 'results_additional_exps/train_time_ids17_lstm_deep_rep3', 'model': 'lstm', 'model_type': 'classifier', 'normal_label': 'BENIGN', 'lstm_time_steps': 32, 'lstm_layer_units': [64, 32], 'lstm_layer_activations': ['relu', 'relu'], 'lstm_layer_dropout_rates': [0.2, 0.2], 'batch_size': 256, 'epochs': 100, 'early_stop_patience': 100, 'goal_metric': 0.994779286, 'training_set': 'train_set_only', 'dataset_dir': '../Datasets/full_datasets/ids2017', 'description': 'train_time_ids17_lstm_deep_rep3'}
2020-01-13 21:39:49,809 [INFO] Created tensorboard log directory: results_additional_exps/train_time_ids17_lstm_deep_rep3/tf_logs_run_2020_01_13-21_39_49
2020-01-13 21:39:49,810 [INFO] Loading datsets from: ../Datasets/full_datasets/ids2017
2020-01-13 21:39:49,810 [INFO] Reading X, y files
2020-01-13 21:39:49,810 [INFO] Reading HDF dataset ../Datasets/full_datasets/ids2017/X_train.h5
2020-01-13 21:39:54,024 [INFO] Reading complete. time_to_read=4.21 seconds
2020-01-13 21:39:54,025 [INFO] Reading HDF dataset ../Datasets/full_datasets/ids2017/X_val.h5
2020-01-13 21:39:55,457 [INFO] Reading complete. time_to_read=1.43 seconds
2020-01-13 21:39:55,457 [INFO] Reading HDF dataset ../Datasets/full_datasets/ids2017/X_test.h5
2020-01-13 21:39:56,889 [INFO] Reading complete. time_to_read=1.43 seconds
2020-01-13 21:39:56,890 [INFO] Reading HDF dataset ../Datasets/full_datasets/ids2017/y_train.h5
2020-01-13 21:39:57,117 [INFO] Reading complete. time_to_read=0.23 seconds
2020-01-13 21:39:57,117 [INFO] Reading HDF dataset ../Datasets/full_datasets/ids2017/y_val.h5
2020-01-13 21:39:57,191 [INFO] Reading complete. time_to_read=0.07 seconds
2020-01-13 21:39:57,191 [INFO] Reading HDF dataset ../Datasets/full_datasets/ids2017/y_test.h5
2020-01-13 21:39:57,266 [INFO] Reading complete. time_to_read=0.08 seconds
2020-01-13 21:39:59,763 [INFO] Preparing flow sequences
2020-01-13 21:40:21,793 [INFO] Extracting flows complete. time_taken = 22.03 sec
2020-01-13 21:40:22,926 [INFO] Initializing model
2020-01-13 21:40:23,377 [INFO] _________________________________________________________________
2020-01-13 21:40:23,377 [INFO] Layer (type)                 Output Shape              Param #   
2020-01-13 21:40:23,377 [INFO] =================================================================
2020-01-13 21:40:23,377 [INFO] lstm_11 (LSTM)               (None, 32, 64)            36608     
2020-01-13 21:40:23,377 [INFO] _________________________________________________________________
2020-01-13 21:40:23,377 [INFO] batch_normalization_11 (Batc (None, 32, 64)            256       
2020-01-13 21:40:23,378 [INFO] _________________________________________________________________
2020-01-13 21:40:23,378 [INFO] dropout_11 (Dropout)         (None, 32, 64)            0         
2020-01-13 21:40:23,378 [INFO] _________________________________________________________________
2020-01-13 21:40:23,378 [INFO] lstm_12 (LSTM)               (None, 32, 32)            12416     
2020-01-13 21:40:23,378 [INFO] _________________________________________________________________
2020-01-13 21:40:23,378 [INFO] batch_normalization_12 (Batc (None, 32, 32)            128       
2020-01-13 21:40:23,378 [INFO] _________________________________________________________________
2020-01-13 21:40:23,378 [INFO] dropout_12 (Dropout)         (None, 32, 32)            0         
2020-01-13 21:40:23,378 [INFO] _________________________________________________________________
2020-01-13 21:40:23,378 [INFO] time_distributed_6 (TimeDist (None, 32, 12)            396       
2020-01-13 21:40:23,378 [INFO] =================================================================
2020-01-13 21:40:23,378 [INFO] Total params: 49,804
2020-01-13 21:40:23,378 [INFO] Trainable params: 49,612
2020-01-13 21:40:23,378 [INFO] Non-trainable params: 192
2020-01-13 21:40:23,378 [INFO] _________________________________________________________________
2020-01-13 21:40:23,378 [INFO] Training model
 - val_f1: 0.9746
 - out_of_sample_accuracy: 0.9748
Train on 53021 samples, validate on 17673 samples
Epoch 1/100
 - 14s - loss: 0.1883 - val_loss: 0.0940
 - val_f1: 0.7916
 - out_of_sample_accuracy: 0.8208
Epoch 2/100
 - 13s - loss: 0.0855 - val_loss: 0.0749
 - val_f1: 0.8268
 - out_of_sample_accuracy: 0.8630
Epoch 3/100
 - 13s - loss: 0.0649 - val_loss: 0.0579
 - val_f1: 0.8362
 - out_of_sample_accuracy: 0.8693
Epoch 4/100
 - 13s - loss: 0.0521 - val_loss: 0.0459
 - val_f1: 0.8674
 - out_of_sample_accuracy: 0.8840
Epoch 5/100
 - 13s - loss: 0.0451 - val_loss: 0.0411
 - val_f1: 0.8868
 - out_of_sample_accuracy: 0.8958
Epoch 6/100
 - 13s - loss: 0.0404 - val_loss: 0.0368
 - val_f1: 0.9006
 - out_of_sample_accuracy: 0.9031
Epoch 7/100
 - 13s - loss: 0.0371 - val_loss: 0.0348
 - val_f1: 0.9051
 - out_of_sample_accuracy: 0.9048
Epoch 8/100
 - 13s - loss: 0.0380 - val_loss: 0.0318
 - val_f1: 0.9225
 - out_of_sample_accuracy: 0.9190
Epoch 9/100
 - 13s - loss: 0.0390 - val_loss: 0.0339
 - val_f1: 0.9136
 - out_of_sample_accuracy: 0.9101
Epoch 10/100
 - 13s - loss: 0.0361 - val_loss: 0.0294
 - val_f1: 0.9325
 - out_of_sample_accuracy: 0.9306
Epoch 11/100
 - 13s - loss: 0.0334 - val_loss: 0.0270
/home/hasitha/anaconda3/lib/python3.7/site-packages/sklearn/metrics/classification.py:1143: UndefinedMetricWarning: F-score is ill-defined and being set to 0.0 in labels with no predicted samples.
  'precision', 'predicted', average, warn_for)
2020-01-13 21:43:50,173 [INFO] epoch = 10. Intermediate model saved to results_additional_exps/train_time_ids17_lstm_deep_rep3/_model_epoch_10.pickle
 - val_f1: 0.9409
 - out_of_sample_accuracy: 0.9401
Epoch 12/100
 - 13s - loss: 0.0314 - val_loss: 0.0253
 - val_f1: 0.9446
 - out_of_sample_accuracy: 0.9448
Epoch 13/100
 - 13s - loss: 0.0298 - val_loss: 0.0236
 - val_f1: 0.9493
 - out_of_sample_accuracy: 0.9496
Epoch 14/100
 - 13s - loss: 0.0283 - val_loss: 0.0223
 - val_f1: 0.9522
 - out_of_sample_accuracy: 0.9530
Epoch 15/100
 - 13s - loss: 0.0270 - val_loss: 0.0217
 - val_f1: 0.9534
 - out_of_sample_accuracy: 0.9547
Epoch 16/100
 - 13s - loss: 0.0258 - val_loss: 0.0205
 - val_f1: 0.9555
 - out_of_sample_accuracy: 0.9568
Epoch 17/100
 - 13s - loss: 0.0247 - val_loss: 0.0194
 - val_f1: 0.9573
 - out_of_sample_accuracy: 0.9585
Epoch 18/100
 - 13s - loss: 0.0239 - val_loss: 0.0190
 - val_f1: 0.9581
 - out_of_sample_accuracy: 0.9596
Epoch 19/100
 - 13s - loss: 0.0229 - val_loss: 0.0182
 - val_f1: 0.9596
 - out_of_sample_accuracy: 0.9611
Epoch 20/100
 - 13s - loss: 0.0221 - val_loss: 0.0176
 - val_f1: 0.9605
 - out_of_sample_accuracy: 0.9621
Epoch 21/100
 - 13s - loss: 0.0213 - val_loss: 0.0168
2020-01-13 21:46:56,903 [INFO] epoch = 20. Intermediate model saved to results_additional_exps/train_time_ids17_lstm_deep_rep3/_model_epoch_20.pickle
 - val_f1: 0.9616
 - out_of_sample_accuracy: 0.9635
Epoch 22/100
 - 13s - loss: 0.0205 - val_loss: 0.0162
 - val_f1: 0.9625
 - out_of_sample_accuracy: 0.9642
Epoch 23/100
 - 13s - loss: 0.0199 - val_loss: 0.0162
 - val_f1: 0.9624
 - out_of_sample_accuracy: 0.9646
Epoch 24/100
 - 13s - loss: 0.0191 - val_loss: 0.0151
 - val_f1: 0.9635
 - out_of_sample_accuracy: 0.9654
Epoch 25/100
 - 13s - loss: 0.0185 - val_loss: 0.0145
 - val_f1: 0.9640
 - out_of_sample_accuracy: 0.9660
Epoch 26/100
 - 13s - loss: 0.0177 - val_loss: 0.0144
 - val_f1: 0.9644
 - out_of_sample_accuracy: 0.9665
Epoch 27/100
 - 13s - loss: 0.0172 - val_loss: 0.0138
 - val_f1: 0.9647
 - out_of_sample_accuracy: 0.9667
Epoch 28/100
 - 13s - loss: 0.0166 - val_loss: 0.0135
 - val_f1: 0.9647
 - out_of_sample_accuracy: 0.9667
Epoch 29/100
 - 13s - loss: 0.0160 - val_loss: 0.0130
 - val_f1: 0.9653
 - out_of_sample_accuracy: 0.9674
Epoch 30/100
 - 13s - loss: 0.0155 - val_loss: 0.0122
 - val_f1: 0.9666
 - out_of_sample_accuracy: 0.9675
Epoch 31/100
 - 13s - loss: 0.0150 - val_loss: 0.0123
2020-01-13 21:50:04,550 [INFO] epoch = 30. Intermediate model saved to results_additional_exps/train_time_ids17_lstm_deep_rep3/_model_epoch_30.pickle
 - val_f1: 0.9659
 - out_of_sample_accuracy: 0.9676
Epoch 32/100
 - 13s - loss: 0.0145 - val_loss: 0.0114
 - val_f1: 0.9689
 - out_of_sample_accuracy: 0.9695
Epoch 33/100
 - 13s - loss: 0.0139 - val_loss: 0.0114
 - val_f1: 0.9698
 - out_of_sample_accuracy: 0.9704
Epoch 34/100
 - 13s - loss: 0.0134 - val_loss: 0.0112
 - val_f1: 0.9710
 - out_of_sample_accuracy: 0.9711
Epoch 35/100
 - 13s - loss: 0.0131 - val_loss: 0.0103
 - val_f1: 0.9726
 - out_of_sample_accuracy: 0.9726
Epoch 36/100
 - 13s - loss: 0.0127 - val_loss: 0.0103
 - val_f1: 0.9727
 - out_of_sample_accuracy: 0.9727
Epoch 37/100
 - 13s - loss: 0.0124 - val_loss: 0.0105
 - val_f1: 0.9727
 - out_of_sample_accuracy: 0.9728
Epoch 38/100
 - 13s - loss: 0.0120 - val_loss: 0.0098
 - val_f1: 0.9744
 - out_of_sample_accuracy: 0.9746
Epoch 39/100
 - 13s - loss: 0.0116 - val_loss: 0.0095
 - val_f1: 0.9758
 - out_of_sample_accuracy: 0.9753
Epoch 40/100
 - 13s - loss: 0.0114 - val_loss: 0.0092
 - val_f1: 0.9746
 - out_of_sample_accuracy: 0.9746
Epoch 41/100
 - 13s - loss: 0.0110 - val_loss: 0.0088
2020-01-13 21:53:12,308 [INFO] epoch = 40. Intermediate model saved to results_additional_exps/train_time_ids17_lstm_deep_rep3/_model_epoch_40.pickle
 - val_f1: 0.9766
 - out_of_sample_accuracy: 0.9765
Epoch 42/100
 - 13s - loss: 0.0106 - val_loss: 0.0095
 - val_f1: 0.9736
 - out_of_sample_accuracy: 0.9737
Epoch 43/100
 - 13s - loss: 0.0102 - val_loss: 0.0089
 - val_f1: 0.9777
 - out_of_sample_accuracy: 0.9774
Epoch 44/100
 - 13s - loss: 0.0098 - val_loss: 0.0102
 - val_f1: 0.9778
 - out_of_sample_accuracy: 0.9780
Epoch 45/100
 - 13s - loss: 0.0092 - val_loss: 0.0107
 - val_f1: 0.9784
 - out_of_sample_accuracy: 0.9782
Epoch 46/100
 - 13s - loss: 0.0089 - val_loss: 0.0124
 - val_f1: 0.9788
 - out_of_sample_accuracy: 0.9786
Epoch 47/100
 - 13s - loss: 0.0084 - val_loss: 0.0130
 - val_f1: 0.9770
 - out_of_sample_accuracy: 0.9770
Epoch 48/100
 - 13s - loss: 0.0080 - val_loss: 0.0112
 - val_f1: 0.9782
 - out_of_sample_accuracy: 0.9782
Epoch 49/100
 - 13s - loss: 0.0080 - val_loss: 0.0094
 - val_f1: 0.9767
 - out_of_sample_accuracy: 0.9769
Epoch 50/100
 - 13s - loss: 0.0075 - val_loss: 0.0086
 - val_f1: 0.9782
 - out_of_sample_accuracy: 0.9785
Epoch 51/100
 - 13s - loss: 0.0072 - val_loss: 0.0084
2020-01-13 21:56:19,607 [INFO] epoch = 50. Intermediate model saved to results_additional_exps/train_time_ids17_lstm_deep_rep3/_model_epoch_50.pickle
 - val_f1: 0.9798
 - out_of_sample_accuracy: 0.9800
Epoch 52/100
 - 13s - loss: 0.0071 - val_loss: 0.0081
 - val_f1: 0.9793
 - out_of_sample_accuracy: 0.9794
Epoch 53/100
 - 13s - loss: 0.0068 - val_loss: 0.0124
 - val_f1: 0.9784
 - out_of_sample_accuracy: 0.9785
Epoch 54/100
 - 13s - loss: 0.0066 - val_loss: 0.0122
 - val_f1: 0.9785
 - out_of_sample_accuracy: 0.9787
Epoch 55/100
 - 13s - loss: 0.0065 - val_loss: 0.0062
 - val_f1: 0.9816
 - out_of_sample_accuracy: 0.9821
Epoch 56/100
 - 13s - loss: 0.0063 - val_loss: 0.0072
 - val_f1: 0.9804
 - out_of_sample_accuracy: 0.9803
Epoch 57/100
 - 13s - loss: 0.0059 - val_loss: 0.0056
 - val_f1: 0.9864
 - out_of_sample_accuracy: 0.9869
Epoch 58/100
 - 13s - loss: 0.0059 - val_loss: 0.0044
 - val_f1: 0.9910
 - out_of_sample_accuracy: 0.9914
Epoch 59/100
 - 13s - loss: 0.0058 - val_loss: 0.0047
 - val_f1: 0.9899
 - out_of_sample_accuracy: 0.9906
Epoch 60/100
 - 13s - loss: 0.0054 - val_loss: 0.0087
 - val_f1: 0.9824
 - out_of_sample_accuracy: 0.9823
Epoch 61/100
 - 13s - loss: 0.0053 - val_loss: 0.0049
2020-01-13 21:59:26,793 [INFO] epoch = 60. Intermediate model saved to results_additional_exps/train_time_ids17_lstm_deep_rep3/_model_epoch_60.pickle
 - val_f1: 0.9876
 - out_of_sample_accuracy: 0.9878
Epoch 62/100
 - 13s - loss: 0.0050 - val_loss: 0.0045
 - val_f1: 0.9897
 - out_of_sample_accuracy: 0.9900
Epoch 63/100
 - 13s - loss: 0.0050 - val_loss: 0.0036
 - val_f1: 0.9920
 - out_of_sample_accuracy: 0.9924
Epoch 64/100
 - 13s - loss: 0.0051 - val_loss: 0.0046
 - val_f1: 0.9904
 - out_of_sample_accuracy: 0.9909
Epoch 65/100
 - 13s - loss: 0.0063 - val_loss: 0.0049
 - val_f1: 0.9876
 - out_of_sample_accuracy: 0.9879
Epoch 66/100
 - 13s - loss: 0.0055 - val_loss: 0.0079
 - val_f1: 0.9792
 - out_of_sample_accuracy: 0.9790
Epoch 67/100
 - 13s - loss: 0.0054 - val_loss: 0.0072
 - val_f1: 0.9829
 - out_of_sample_accuracy: 0.9829
Epoch 68/100
 - 13s - loss: 0.0052 - val_loss: 0.0072
 - val_f1: 0.9808
 - out_of_sample_accuracy: 0.9806
Epoch 69/100
 - 13s - loss: 0.0050 - val_loss: 0.0052
 - val_f1: 0.9838
 - out_of_sample_accuracy: 0.9839
Epoch 70/100
 - 13s - loss: 0.0049 - val_loss: 0.0042
 - val_f1: 0.9917
 - out_of_sample_accuracy: 0.9921
Epoch 71/100
 - 13s - loss: 0.0051 - val_loss: 0.0067
2020-01-13 22:02:34,140 [INFO] epoch = 70. Intermediate model saved to results_additional_exps/train_time_ids17_lstm_deep_rep3/_model_epoch_70.pickle
 - val_f1: 0.9811
 - out_of_sample_accuracy: 0.9809
Epoch 72/100
 - 13s - loss: 0.0046 - val_loss: 0.0044
 - val_f1: 0.9902
 - out_of_sample_accuracy: 0.9904
Epoch 73/100
 - 13s - loss: 0.0042 - val_loss: 0.0041
 - val_f1: 0.9912
 - out_of_sample_accuracy: 0.9917
Epoch 74/100
 - 13s - loss: 0.0042 - val_loss: 0.0030
 - val_f1: 0.9938
 - out_of_sample_accuracy: 0.9942
Epoch 75/100
 - 13s - loss: 0.0041 - val_loss: 0.0047
 - val_f1: 0.9866
 - out_of_sample_accuracy: 0.9868
Epoch 76/100
 - 13s - loss: 0.0042 - val_loss: 0.0031
 - val_f1: 0.9939
 - out_of_sample_accuracy: 0.9944
Epoch 77/100
 - 13s - loss: 0.0045 - val_loss: 0.0037
 - val_f1: 0.9910
 - out_of_sample_accuracy: 0.9914
Epoch 78/100
 - 13s - loss: 0.0040 - val_loss: 0.0028
 - val_f1: 0.9941
 - out_of_sample_accuracy: 0.9946
Epoch 79/100
 - 13s - loss: 0.0039 - val_loss: 0.0034
 - val_f1: 0.9933
 - out_of_sample_accuracy: 0.9939
Epoch 80/100
 - 13s - loss: 0.0037 - val_loss: 0.0035
 - val_f1: 0.9918
 - out_of_sample_accuracy: 0.9920
Epoch 81/100
 - 13s - loss: 0.0036 - val_loss: 0.0034
2020-01-13 22:05:41,258 [INFO] epoch = 80. Intermediate model saved to results_additional_exps/train_time_ids17_lstm_deep_rep3/_model_epoch_80.pickle
 - val_f1: 0.9920
 - out_of_sample_accuracy: 0.9923
Epoch 82/100
 - 13s - loss: 0.0047 - val_loss: 0.0032
 - val_f1: 0.9941
 - out_of_sample_accuracy: 0.9944
Epoch 83/100
 - 13s - loss: 0.0041 - val_loss: 0.0066
 - val_f1: 0.9819
 - out_of_sample_accuracy: 0.9816
Epoch 84/100
 - 13s - loss: 0.0040 - val_loss: 0.0040
 - val_f1: 0.9890
 - out_of_sample_accuracy: 0.9891
Epoch 85/100
 - 13s - loss: 0.0039 - val_loss: 0.0038
 - val_f1: 0.9921
 - out_of_sample_accuracy: 0.9927
Epoch 86/100
 - 13s - loss: 0.0043 - val_loss: 0.0086
 - val_f1: 0.9764
 - out_of_sample_accuracy: 0.9766
Epoch 87/100
 - 13s - loss: 0.0057 - val_loss: 0.0045
 - val_f1: 0.9910
 - out_of_sample_accuracy: 0.9913
Epoch 88/100
 - 13s - loss: 0.0046 - val_loss: 0.0033
 - val_f1: 0.9931
 - out_of_sample_accuracy: 0.9935
Epoch 89/100
 - 13s - loss: 0.0042 - val_loss: 0.0028
 - val_f1: 0.9943
 - out_of_sample_accuracy: 0.9947
Epoch 90/100
 - 13s - loss: 0.0040 - val_loss: 0.0029
 - val_f1: 0.9931
 - out_of_sample_accuracy: 0.9934
Epoch 91/100
 - 13s - loss: 0.0037 - val_loss: 0.0028
2020-01-13 22:08:48,451 [INFO] epoch = 90. Intermediate model saved to results_additional_exps/train_time_ids17_lstm_deep_rep3/_model_epoch_90.pickle
 - val_f1: 0.9936
 - out_of_sample_accuracy: 0.9941
Epoch 92/100
 - 13s - loss: 0.0039 - val_loss: 0.0139
 - val_f1: 0.9806
 - out_of_sample_accuracy: 0.9805
Epoch 93/100
 - 13s - loss: 0.0044 - val_loss: 0.0034
 - val_f1: 0.9926
 - out_of_sample_accuracy: 0.9930
Epoch 94/100
 - 13s - loss: 0.0041 - val_loss: 0.0032
 - val_f1: 0.9929
 - out_of_sample_accuracy: 0.9931
Epoch 95/100
 - 13s - loss: 0.0040 - val_loss: 0.0037
 - val_f1: 0.9916
 - out_of_sample_accuracy: 0.9918
Epoch 96/100
 - 13s - loss: 0.0040 - val_loss: 0.0027
2020-01-13 22:10:28,148 [INFO] StopperOnGoal: reached goal_metric (accuracy). Stopping training. goal_metric = 0.9948, current_metric = 0.9952, num_epochs = 96
2020-01-13 22:10:28,152 [INFO] WeightRestorer::on_train_end(): restoring best weights
2020-01-13 22:10:38,883 [INFO] Last epoch loss evaluation: train_loss = 0.002542, val_loss = 0.002695
2020-01-13 22:10:38,883 [INFO] Training complete. time_to_train = 1815.50 sec, 30.26 min
2020-01-13 22:10:38,889 [INFO] Model saved to results_additional_exps/train_time_ids17_lstm_deep_rep3/best_model.pickle
2020-01-13 22:10:38,891 [INFO] Training history saved to: results_additional_exps/train_time_ids17_lstm_deep_rep3/training_error_history.csv
2020-01-13 22:10:39,022 [INFO] Plot saved to: results_additional_exps/train_time_ids17_lstm_deep_rep3/training_error_history.png
2020-01-13 22:10:39,148 [INFO] Plot saved to: results_additional_exps/train_time_ids17_lstm_deep_rep3/training_f1_history.png
2020-01-13 22:10:39,149 [INFO] Making predictions on training, validation, testing data
2020-01-13 22:10:51,819 [INFO] Making predictions complete. time_to_predict = 12.67 sec, 0.21 min
2020-01-13 22:10:51,880 [INFO] Evaluating predictions (results)
/home/hasitha/anaconda3/lib/python3.7/site-packages/sklearn/metrics/classification.py:1143: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples.
  'precision', 'predicted', average, warn_for)
2020-01-13 22:11:02,279 [INFO] Dataset: Testing. Classification report below
2020-01-13 22:11:02,279 [INFO] 
                        precision    recall  f1-score   support

                BENIGN       1.00      1.00      1.00    454243
                   Bot       0.97      0.37      0.53       391
                  DDoS       1.00      1.00      1.00     25604
         DoS GoldenEye       1.00      0.97      0.98      2058
              DoS Hulk       0.98      0.99      0.99     46023
      DoS Slowhttptest       0.89      0.98      0.93      1100
         DoS slowloris       0.98      0.98      0.98      1159
           FTP-Patator       1.00      0.99      0.99      1586
              PortScan       0.99      1.00      1.00     31761
           SSH-Patator       0.96      0.97      0.96      1179
Web Attack Brute Force       1.00      0.06      0.11       302
        Web Attack XSS       0.00      0.00      0.00       130

             micro avg       1.00      1.00      1.00    565536
             macro avg       0.90      0.77      0.79    565536
          weighted avg       1.00      1.00      0.99    565536

2020-01-13 22:11:02,279 [INFO] Overall accuracy (micro avg): 0.9952629010354779
/home/hasitha/sunanda/ids_experiments/utility.py:328: RuntimeWarning: invalid value encountered in true_divide
  PPV = TP / (TP + FP)    # Precision or positive predictive value
/home/hasitha/sunanda/ids_experiments/utility.py:332: RuntimeWarning: invalid value encountered in true_divide
  FDR = FP / (TP + FP)    # False discovery rate
2020-01-13 22:11:14,082 [INFO] Average metrics for Testing dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9953         0.9953                       0.9953                0.0004                   0.0047  0.9953
1     Macro avg        0.9992         0.8976                       0.7743                0.0013                   0.2257  0.7895
2  Weighted avg        0.9961         0.9951                       0.9953                0.0107                   0.0047  0.9948
2020-01-13 22:11:24,504 [INFO] Dataset: Validation. Classification report below
2020-01-13 22:11:24,504 [INFO] 
                        precision    recall  f1-score   support

                BENIGN       1.00      1.00      1.00    454243
                   Bot       0.96      0.32      0.49       391
                  DDoS       1.00      1.00      1.00     25605
         DoS GoldenEye       1.00      0.96      0.98      2059
              DoS Hulk       0.98      0.99      0.99     46023
      DoS Slowhttptest       0.89      0.98      0.93      1099
         DoS slowloris       0.98      0.98      0.98      1159
           FTP-Patator       1.00      0.99      0.99      1587
              PortScan       0.99      1.00      1.00     31758
           SSH-Patator       0.97      0.96      0.96      1180
Web Attack Brute Force       0.86      0.04      0.08       301
        Web Attack XSS       0.00      0.00      0.00       131

             micro avg       1.00      1.00      1.00    565536
             macro avg       0.88      0.77      0.78    565536
          weighted avg       1.00      1.00      0.99    565536

2020-01-13 22:11:24,504 [INFO] Overall accuracy (micro avg): 0.9953442398008261
2020-01-13 22:11:36,360 [INFO] Average metrics for Validation dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9953         0.9953                       0.9953                0.0004                   0.0047  0.9953
1     Macro avg        0.9992         0.8850                       0.7673                0.0013                   0.2327  0.7817
2  Weighted avg        0.9961         0.9951                       0.9953                0.0108                   0.0047  0.9949
2020-01-13 22:12:10,646 [INFO] Dataset: Training. Classification report below
2020-01-13 22:12:10,646 [INFO] 
                        precision    recall  f1-score   support

                BENIGN       1.00      1.00      1.00   1362781
                   Bot       0.97      0.36      0.52      1174
                  DDoS       1.00      1.00      1.00     76815
         DoS GoldenEye       1.00      0.97      0.98      6176
              DoS Hulk       0.98      0.99      0.99    138073
      DoS Slowhttptest       0.90      0.98      0.94      3300
         DoS slowloris       0.98      0.99      0.98      3478
           FTP-Patator       1.00      0.99      0.99      4761
              PortScan       0.99      1.00      1.00     95281
           SSH-Patator       0.97      0.97      0.97      3538
Web Attack Brute Force       0.91      0.05      0.09       904
        Web Attack XSS       0.00      0.00      0.00       391

             micro avg       1.00      1.00      1.00   1696672
             macro avg       0.89      0.77      0.79   1696672
          weighted avg       1.00      1.00      1.00   1696672

2020-01-13 22:12:10,646 [INFO] Overall accuracy (micro avg): 0.9956220176911035
2020-01-13 22:12:49,587 [INFO] Average metrics for Training dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9956         0.9956                       0.9956                0.0004                   0.0044  0.9956
1     Macro avg        0.9993         0.8928                       0.7738                0.0012                   0.2262  0.7886
2  Weighted avg        0.9964         0.9954                       0.9956                0.0100                   0.0044  0.9952
2020-01-13 22:12:49,611 [INFO] Results saved to: results_additional_exps/train_time_ids17_lstm_deep_rep3/train_time_ids17_lstm_deep_rep3_results.xlsx
2020-01-13 22:12:49,617 [INFO] ================= Finished running experiment no. 3 ================= 

2020-01-13 22:12:49,686 [INFO] Created directory: results_additional_exps/train_time_kdd99_lstm_deep_rep1
2020-01-13 22:12:49,686 [INFO] Initialized logging. log_filename = results_additional_exps/train_time_kdd99_lstm_deep_rep1/run_log.log
2020-01-13 22:12:49,686 [INFO] ================= Running experiment no. 1  ================= 

2020-01-13 22:12:49,686 [INFO] Experiment parameters given below
2020-01-13 22:12:49,687 [INFO] 
{'experiment_num': 1, 'results_dir': 'results_additional_exps/train_time_kdd99_lstm_deep_rep1', 'model': 'lstm', 'model_type': 'classifier', 'normal_label': 'normal', 'lstm_time_steps': 32, 'lstm_layer_units': [32, 16], 'lstm_layer_activations': ['relu', 'relu'], 'lstm_layer_dropout_rates': [0.2, 0.2], 'batch_size': 256, 'epochs': 100, 'early_stop_patience': 100, 'goal_metric': 0.919948449, 'training_set': 'train_set_only', 'dataset_dir': '../Datasets/full_datasets/kdd99_five_classes', 'description': 'train_time_kdd99_lstm_deep_rep1'}
2020-01-13 22:12:49,687 [INFO] Created tensorboard log directory: results_additional_exps/train_time_kdd99_lstm_deep_rep1/tf_logs_run_2020_01_13-22_12_49
2020-01-13 22:12:49,687 [INFO] Loading datsets from: ../Datasets/full_datasets/kdd99_five_classes
2020-01-13 22:12:49,695 [INFO] Reading X, y files
2020-01-13 22:12:49,695 [INFO] Reading HDF dataset ../Datasets/full_datasets/kdd99_five_classes/X_train.h5
2020-01-13 22:12:58,631 [INFO] Reading complete. time_to_read=8.94 seconds
2020-01-13 22:12:58,631 [INFO] Reading HDF dataset ../Datasets/full_datasets/kdd99_five_classes/X_val.h5
2020-01-13 22:13:00,853 [INFO] Reading complete. time_to_read=2.22 seconds
2020-01-13 22:13:00,854 [INFO] Reading HDF dataset ../Datasets/full_datasets/kdd99_five_classes/X_test.h5
2020-01-13 22:13:01,537 [INFO] Reading complete. time_to_read=0.68 seconds
2020-01-13 22:13:01,537 [INFO] Reading HDF dataset ../Datasets/full_datasets/kdd99_five_classes/y_train.h5
2020-01-13 22:13:01,958 [INFO] Reading complete. time_to_read=0.42 seconds
2020-01-13 22:13:01,958 [INFO] Reading HDF dataset ../Datasets/full_datasets/kdd99_five_classes/y_val.h5
2020-01-13 22:13:02,082 [INFO] Reading complete. time_to_read=0.12 seconds
2020-01-13 22:13:02,082 [INFO] Reading HDF dataset ../Datasets/full_datasets/kdd99_five_classes/y_test.h5
2020-01-13 22:13:02,122 [INFO] Reading complete. time_to_read=0.04 seconds
2020-01-13 22:13:49,013 [INFO] Preparing flow sequences
2020-01-13 22:15:27,505 [INFO] Extracting flows complete. time_taken = 98.44 sec
2020-01-13 22:15:30,879 [INFO] Initializing model
2020-01-13 22:15:34,633 [INFO] _________________________________________________________________
2020-01-13 22:15:34,635 [INFO] Layer (type)                 Output Shape              Param #   
2020-01-13 22:15:34,636 [INFO] =================================================================
2020-01-13 22:15:34,638 [INFO] lstm_13 (LSTM)               (None, 32, 32)            19968     
2020-01-13 22:15:34,639 [INFO] _________________________________________________________________
2020-01-13 22:15:34,640 [INFO] batch_normalization_13 (Batc (None, 32, 32)            128       
2020-01-13 22:15:34,641 [INFO] _________________________________________________________________
2020-01-13 22:15:34,642 [INFO] dropout_13 (Dropout)         (None, 32, 32)            0         
2020-01-13 22:15:34,643 [INFO] _________________________________________________________________
2020-01-13 22:15:34,643 [INFO] lstm_14 (LSTM)               (None, 32, 16)            3136      
2020-01-13 22:15:34,644 [INFO] _________________________________________________________________
2020-01-13 22:15:34,645 [INFO] batch_normalization_14 (Batc (None, 32, 16)            64        
2020-01-13 22:15:34,646 [INFO] _________________________________________________________________
2020-01-13 22:15:34,647 [INFO] dropout_14 (Dropout)         (None, 32, 16)            0         
2020-01-13 22:15:34,648 [INFO] _________________________________________________________________
2020-01-13 22:15:34,659 [INFO] time_distributed_7 (TimeDist (None, 32, 5)             85        
2020-01-13 22:15:34,660 [INFO] =================================================================
2020-01-13 22:15:34,661 [INFO] Total params: 23,381
2020-01-13 22:15:34,662 [INFO] Trainable params: 23,285
2020-01-13 22:15:34,663 [INFO] Non-trainable params: 96
2020-01-13 22:15:34,664 [INFO] _________________________________________________________________
2020-01-13 22:15:34,666 [INFO] Training model
 - val_f1: 0.9949
 - out_of_sample_accuracy: 0.9952
Train on 122460 samples, validate on 30615 samples
Epoch 1/100
 - 30s - loss: 0.2250 - val_loss: 0.0383
 - val_f1: 0.9722
 - out_of_sample_accuracy: 0.8269
Epoch 2/100
 - 19s - loss: 0.0562 - val_loss: 0.0519
 - val_f1: 0.9552
 - out_of_sample_accuracy: 0.8653
Epoch 3/100
 - 19s - loss: 0.0502 - val_loss: 0.0210
 - val_f1: 0.9809
 - out_of_sample_accuracy: 0.8728
Epoch 4/100
 - 19s - loss: 0.0350 - val_loss: 0.0154
 - val_f1: 0.9859
 - out_of_sample_accuracy: 0.8806
Epoch 5/100
 - 19s - loss: 0.0272 - val_loss: 0.0117
 - val_f1: 0.9907
 - out_of_sample_accuracy: 0.8908
Epoch 6/100
 - 19s - loss: 0.0218 - val_loss: 0.0099
 - val_f1: 0.9923
 - out_of_sample_accuracy: 0.8805
Epoch 7/100
 - 19s - loss: 0.0206 - val_loss: 0.0091
 - val_f1: 0.9934
 - out_of_sample_accuracy: 0.9008
Epoch 8/100
 - 19s - loss: 0.0167 - val_loss: 0.0070
 - val_f1: 0.9952
 - out_of_sample_accuracy: 0.9043
Epoch 9/100
 - 19s - loss: 0.0140 - val_loss: 0.0059
 - val_f1: 0.9962
 - out_of_sample_accuracy: 0.9074
Epoch 10/100
 - 19s - loss: 0.0116 - val_loss: 0.0048
 - val_f1: 0.9970
 - out_of_sample_accuracy: 0.9097
Epoch 11/100
 - 19s - loss: 0.0095 - val_loss: 0.0039
/home/hasitha/anaconda3/lib/python3.7/site-packages/sklearn/metrics/classification.py:1143: UndefinedMetricWarning: F-score is ill-defined and being set to 0.0 in labels with no predicted samples.
  'precision', 'predicted', average, warn_for)
2020-01-13 22:20:32,267 [INFO] epoch = 10. Intermediate model saved to results_additional_exps/train_time_kdd99_lstm_deep_rep1/_model_epoch_10.pickle
 - val_f1: 0.9976
 - out_of_sample_accuracy: 0.9107
Epoch 12/100
 - 19s - loss: 0.0080 - val_loss: 0.0035
 - val_f1: 0.9980
 - out_of_sample_accuracy: 0.9112
Epoch 13/100
 - 19s - loss: 0.0069 - val_loss: 0.0032
 - val_f1: 0.9982
 - out_of_sample_accuracy: 0.9130
Epoch 14/100
 - 19s - loss: 0.0061 - val_loss: 0.0029
 - val_f1: 0.9984
 - out_of_sample_accuracy: 0.9147
Epoch 15/100
 - 19s - loss: 0.0054 - val_loss: 0.0027
 - val_f1: 0.9986
 - out_of_sample_accuracy: 0.9160
Epoch 16/100
 - 19s - loss: 0.0048 - val_loss: 0.0024
 - val_f1: 0.9987
 - out_of_sample_accuracy: 0.9160
Epoch 17/100
 - 19s - loss: 0.0042 - val_loss: 0.0022
 - val_f1: 0.9987
 - out_of_sample_accuracy: 0.9145
Epoch 18/100
 - 19s - loss: 0.0038 - val_loss: 0.0021
 - val_f1: 0.9988
 - out_of_sample_accuracy: 0.9148
Epoch 19/100
 - 19s - loss: 0.0035 - val_loss: 0.0019
 - val_f1: 0.9989
 - out_of_sample_accuracy: 0.9163
Epoch 20/100
 - 19s - loss: 0.0031 - val_loss: 0.0017
 - val_f1: 0.9989
 - out_of_sample_accuracy: 0.9163
Epoch 21/100
 - 19s - loss: 0.0029 - val_loss: 0.0016
2020-01-13 22:24:39,833 [INFO] epoch = 20. Intermediate model saved to results_additional_exps/train_time_kdd99_lstm_deep_rep1/_model_epoch_20.pickle
 - val_f1: 0.9991
 - out_of_sample_accuracy: 0.9170
Epoch 22/100
 - 19s - loss: 0.0025 - val_loss: 0.0014
 - val_f1: 0.9991
 - out_of_sample_accuracy: 0.9180
Epoch 23/100
 - 19s - loss: 0.0022 - val_loss: 0.0012
 - val_f1: 0.9992
 - out_of_sample_accuracy: 0.9180
Epoch 24/100
 - 19s - loss: 0.0020 - val_loss: 0.0010
 - val_f1: 0.9993
 - out_of_sample_accuracy: 0.9175
Epoch 25/100
 - 19s - loss: 0.0018 - val_loss: 9.6072e-04
 - val_f1: 0.9993
 - out_of_sample_accuracy: 0.9169
Epoch 26/100
 - 19s - loss: 0.0015 - val_loss: 8.2944e-04
 - val_f1: 0.9994
 - out_of_sample_accuracy: 0.9165
Epoch 27/100
 - 19s - loss: 0.0014 - val_loss: 7.3982e-04
 - val_f1: 0.9995
 - out_of_sample_accuracy: 0.9166
Epoch 28/100
 - 19s - loss: 0.0013 - val_loss: 7.1922e-04
 - val_f1: 0.9995
 - out_of_sample_accuracy: 0.9169
Epoch 29/100
 - 19s - loss: 0.0012 - val_loss: 6.6258e-04
 - val_f1: 0.9996
 - out_of_sample_accuracy: 0.9167
Epoch 30/100
 - 19s - loss: 0.0011 - val_loss: 6.5801e-04
 - val_f1: 0.9996
 - out_of_sample_accuracy: 0.9167
Epoch 31/100
 - 19s - loss: 0.0010 - val_loss: 5.8957e-04
2020-01-13 22:28:47,078 [INFO] epoch = 30. Intermediate model saved to results_additional_exps/train_time_kdd99_lstm_deep_rep1/_model_epoch_30.pickle
 - val_f1: 0.9996
 - out_of_sample_accuracy: 0.9169
Epoch 32/100
 - 19s - loss: 9.2016e-04 - val_loss: 5.4920e-04
 - val_f1: 0.9997
 - out_of_sample_accuracy: 0.9179
Epoch 33/100
 - 19s - loss: 8.4813e-04 - val_loss: 5.3049e-04
 - val_f1: 0.9997
 - out_of_sample_accuracy: 0.9178
Epoch 34/100
 - 19s - loss: 8.0447e-04 - val_loss: 5.6491e-04
 - val_f1: 0.9996
 - out_of_sample_accuracy: 0.9178
Epoch 35/100
 - 19s - loss: 7.4522e-04 - val_loss: 4.9536e-04
 - val_f1: 0.9997
 - out_of_sample_accuracy: 0.9196
Epoch 36/100
 - 19s - loss: 6.8731e-04 - val_loss: 4.9698e-04
2020-01-13 22:30:56,535 [INFO] StopperOnGoal: reached goal_metric (accuracy). Stopping training. goal_metric = 0.9199, current_metric = 0.9204, num_epochs = 36
2020-01-13 22:30:56,539 [INFO] WeightRestorer::on_train_end(): restoring best weights
2020-01-13 22:31:17,440 [INFO] Last epoch loss evaluation: train_loss = 0.000418, val_loss = 0.000495
2020-01-13 22:31:17,440 [INFO] Training complete. time_to_train = 942.77 sec, 15.71 min
2020-01-13 22:31:17,446 [INFO] Model saved to results_additional_exps/train_time_kdd99_lstm_deep_rep1/best_model.pickle
2020-01-13 22:31:17,473 [INFO] Training history saved to: results_additional_exps/train_time_kdd99_lstm_deep_rep1/training_error_history.csv
2020-01-13 22:31:17,769 [INFO] Plot saved to: results_additional_exps/train_time_kdd99_lstm_deep_rep1/training_error_history.png
2020-01-13 22:31:17,894 [INFO] Plot saved to: results_additional_exps/train_time_kdd99_lstm_deep_rep1/training_f1_history.png
2020-01-13 22:31:17,894 [INFO] Making predictions on training, validation, testing data
2020-01-13 22:31:39,958 [INFO] Making predictions complete. time_to_predict = 22.06 sec, 0.37 min
2020-01-13 22:31:40,075 [INFO] Evaluating predictions (results)
2020-01-13 22:31:44,751 [INFO] Dataset: Testing. Classification report below
2020-01-13 22:31:44,751 [INFO] 
              precision    recall  f1-score   support

         dos       1.00      0.97      0.98    229853
     normal.       0.72      0.98      0.83     60580
       probe       0.68      0.67      0.68      4166
         r2l       0.71      0.01      0.02     13773
         u2r       0.00      0.00      0.00      2636

   micro avg       0.92      0.92      0.92    311008
   macro avg       0.62      0.53      0.50    311008
weighted avg       0.92      0.92      0.90    311008

2020-01-13 22:31:44,751 [INFO] Overall accuracy (micro avg): 0.9197962753369688
/home/hasitha/sunanda/ids_experiments/utility.py:334: RuntimeWarning: invalid value encountered in true_divide
  F1 = (2 * PPV * TPR) / (PPV + TPR)  # F1 score
2020-01-13 22:31:50,121 [INFO] Average metrics for Testing dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9198         0.9198                       0.9198                0.0201                   0.0802  0.9198
1     Macro avg        0.9679         0.6228                       0.5276                0.0205                   0.4724  0.5035
2  Weighted avg        0.9668         0.9189                       0.9198                0.0221                   0.0802  0.9004
2020-01-13 22:32:06,661 [INFO] Dataset: Validation. Classification report below
2020-01-13 22:32:06,661 [INFO] 
              precision    recall  f1-score   support

         dos       1.00      1.00      1.00    776671
     normal.       1.00      1.00      1.00    194553
       probe       0.99      0.99      0.99      8221
         r2l       0.91      0.44      0.59       225
         u2r       0.00      0.00      0.00        10

   micro avg       1.00      1.00      1.00    979680
   macro avg       0.78      0.69      0.72    979680
weighted avg       1.00      1.00      1.00    979680

2020-01-13 22:32:06,661 [INFO] Overall accuracy (micro avg): 0.9996886738526866
2020-01-13 22:32:25,462 [INFO] Average metrics for Validation dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9997         0.9997                       0.9997                0.0001                   0.0003  0.9997
1     Macro avg        0.9999         0.7800                       0.6855                0.0001                   0.3145  0.7162
2  Weighted avg        0.9999         0.9997                       0.9997                0.0002                   0.0003  0.9997
2020-01-13 22:33:37,671 [INFO] Dataset: Training. Classification report below
2020-01-13 22:33:37,671 [INFO] 
              precision    recall  f1-score   support

         dos       1.00      1.00      1.00   3106675
     normal.       1.00      1.00      1.00    778221
       probe       0.99      0.99      0.99     32881
         r2l       0.94      0.47      0.63       901
         u2r       0.42      0.12      0.19        42

   micro avg       1.00      1.00      1.00   3918720
   macro avg       0.87      0.72      0.76   3918720
weighted avg       1.00      1.00      1.00   3918720

2020-01-13 22:33:37,671 [INFO] Overall accuracy (micro avg): 0.9997192960966846
2020-01-13 22:34:59,578 [INFO] Average metrics for Training dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9997         0.9997                       0.9997                0.0001                   0.0003  0.9997
1     Macro avg        0.9999         0.8697                       0.7164                0.0001                   0.2836  0.7610
2  Weighted avg        0.9999         0.9997                       0.9997                0.0002                   0.0003  0.9997
2020-01-13 22:34:59,624 [INFO] Results saved to: results_additional_exps/train_time_kdd99_lstm_deep_rep1/train_time_kdd99_lstm_deep_rep1_results.xlsx
2020-01-13 22:34:59,636 [INFO] ================= Finished running experiment no. 1 ================= 

2020-01-13 22:34:59,841 [INFO] Created directory: results_additional_exps/train_time_kdd99_lstm_deep_rep2
2020-01-13 22:34:59,841 [INFO] Initialized logging. log_filename = results_additional_exps/train_time_kdd99_lstm_deep_rep2/run_log.log
2020-01-13 22:34:59,841 [INFO] ================= Running experiment no. 2  ================= 

2020-01-13 22:34:59,841 [INFO] Experiment parameters given below
2020-01-13 22:34:59,842 [INFO] 
{'experiment_num': 2, 'results_dir': 'results_additional_exps/train_time_kdd99_lstm_deep_rep2', 'model': 'lstm', 'model_type': 'classifier', 'normal_label': 'normal', 'lstm_time_steps': 32, 'lstm_layer_units': [32, 16], 'lstm_layer_activations': ['relu', 'relu'], 'lstm_layer_dropout_rates': [0.2, 0.2], 'batch_size': 256, 'epochs': 100, 'early_stop_patience': 100, 'goal_metric': 0.919948449, 'training_set': 'train_set_only', 'dataset_dir': '../Datasets/full_datasets/kdd99_five_classes', 'description': 'train_time_kdd99_lstm_deep_rep2'}
2020-01-13 22:34:59,842 [INFO] Created tensorboard log directory: results_additional_exps/train_time_kdd99_lstm_deep_rep2/tf_logs_run_2020_01_13-22_34_59
2020-01-13 22:34:59,842 [INFO] Loading datsets from: ../Datasets/full_datasets/kdd99_five_classes
2020-01-13 22:34:59,842 [INFO] Reading X, y files
2020-01-13 22:34:59,842 [INFO] Reading HDF dataset ../Datasets/full_datasets/kdd99_five_classes/X_train.h5
2020-01-13 22:35:09,098 [INFO] Reading complete. time_to_read=9.26 seconds
2020-01-13 22:35:09,098 [INFO] Reading HDF dataset ../Datasets/full_datasets/kdd99_five_classes/X_val.h5
2020-01-13 22:35:11,364 [INFO] Reading complete. time_to_read=2.27 seconds
2020-01-13 22:35:11,364 [INFO] Reading HDF dataset ../Datasets/full_datasets/kdd99_five_classes/X_test.h5
2020-01-13 22:35:12,046 [INFO] Reading complete. time_to_read=0.68 seconds
2020-01-13 22:35:12,046 [INFO] Reading HDF dataset ../Datasets/full_datasets/kdd99_five_classes/y_train.h5
2020-01-13 22:35:12,544 [INFO] Reading complete. time_to_read=0.50 seconds
2020-01-13 22:35:12,544 [INFO] Reading HDF dataset ../Datasets/full_datasets/kdd99_five_classes/y_val.h5
2020-01-13 22:35:12,661 [INFO] Reading complete. time_to_read=0.12 seconds
2020-01-13 22:35:12,661 [INFO] Reading HDF dataset ../Datasets/full_datasets/kdd99_five_classes/y_test.h5
2020-01-13 22:35:12,716 [INFO] Reading complete. time_to_read=0.05 seconds
2020-01-13 22:35:52,431 [INFO] Preparing flow sequences
2020-01-13 22:37:27,798 [INFO] Extracting flows complete. time_taken = 95.31 sec
2020-01-13 22:37:32,063 [INFO] Initializing model
2020-01-13 22:37:35,575 [INFO] _________________________________________________________________
2020-01-13 22:37:35,576 [INFO] Layer (type)                 Output Shape              Param #   
2020-01-13 22:37:35,576 [INFO] =================================================================
2020-01-13 22:37:35,577 [INFO] lstm_15 (LSTM)               (None, 32, 32)            19968     
2020-01-13 22:37:35,577 [INFO] _________________________________________________________________
2020-01-13 22:37:35,577 [INFO] batch_normalization_15 (Batc (None, 32, 32)            128       
2020-01-13 22:37:35,577 [INFO] _________________________________________________________________
2020-01-13 22:37:35,577 [INFO] dropout_15 (Dropout)         (None, 32, 32)            0         
2020-01-13 22:37:35,577 [INFO] _________________________________________________________________
2020-01-13 22:37:35,577 [INFO] lstm_16 (LSTM)               (None, 32, 16)            3136      
2020-01-13 22:37:35,577 [INFO] _________________________________________________________________
2020-01-13 22:37:35,578 [INFO] batch_normalization_16 (Batc (None, 32, 16)            64        
2020-01-13 22:37:35,578 [INFO] _________________________________________________________________
2020-01-13 22:37:35,578 [INFO] dropout_16 (Dropout)         (None, 32, 16)            0         
2020-01-13 22:37:35,578 [INFO] _________________________________________________________________
2020-01-13 22:37:35,578 [INFO] time_distributed_8 (TimeDist (None, 32, 5)             85        
2020-01-13 22:37:35,578 [INFO] =================================================================
2020-01-13 22:37:35,578 [INFO] Total params: 23,381
2020-01-13 22:37:35,578 [INFO] Trainable params: 23,285
2020-01-13 22:37:35,578 [INFO] Non-trainable params: 96
2020-01-13 22:37:35,578 [INFO] _________________________________________________________________
2020-01-13 22:37:35,578 [INFO] Training model
 - val_f1: 0.9997
 - out_of_sample_accuracy: 0.9204
Train on 122460 samples, validate on 30615 samples
Epoch 1/100
 - 30s - loss: 0.1158 - val_loss: 0.0091
 - val_f1: 0.9947
 - out_of_sample_accuracy: 0.9124
Epoch 2/100
 - 19s - loss: 0.0097 - val_loss: 0.0040
 - val_f1: 0.9979
 - out_of_sample_accuracy: 0.9161
Epoch 3/100
 - 19s - loss: 0.0051 - val_loss: 0.0022
 - val_f1: 0.9986
 - out_of_sample_accuracy: 0.9197
Epoch 4/100
 - 19s - loss: 0.0037 - val_loss: 0.0019
/home/hasitha/anaconda3/lib/python3.7/site-packages/sklearn/metrics/classification.py:1143: UndefinedMetricWarning: F-score is ill-defined and being set to 0.0 in labels with no predicted samples.
  'precision', 'predicted', average, warn_for)
2020-01-13 22:39:43,147 [INFO] StopperOnGoal: reached goal_metric (accuracy). Stopping training. goal_metric = 0.9199, current_metric = 0.9204, num_epochs = 4
2020-01-13 22:39:43,149 [INFO] WeightRestorer::on_train_end(): restoring best weights
2020-01-13 22:40:04,498 [INFO] Last epoch loss evaluation: train_loss = 0.001922, val_loss = 0.001931
2020-01-13 22:40:04,499 [INFO] Training complete. time_to_train = 148.92 sec, 2.48 min
2020-01-13 22:40:06,785 [INFO] Model saved to results_additional_exps/train_time_kdd99_lstm_deep_rep2/best_model.pickle
2020-01-13 22:40:06,888 [INFO] Training history saved to: results_additional_exps/train_time_kdd99_lstm_deep_rep2/training_error_history.csv
2020-01-13 22:40:07,347 [INFO] Plot saved to: results_additional_exps/train_time_kdd99_lstm_deep_rep2/training_error_history.png
2020-01-13 22:40:07,478 [INFO] Plot saved to: results_additional_exps/train_time_kdd99_lstm_deep_rep2/training_f1_history.png
2020-01-13 22:40:07,482 [INFO] Making predictions on training, validation, testing data
2020-01-13 22:40:30,089 [INFO] Making predictions complete. time_to_predict = 22.61 sec, 0.38 min
2020-01-13 22:40:30,209 [INFO] Evaluating predictions (results)
2020-01-13 22:40:34,984 [INFO] Dataset: Testing. Classification report below
2020-01-13 22:40:34,984 [INFO] 
              precision    recall  f1-score   support

         dos       0.99      0.97      0.98    229853
     normal.       0.73      0.99      0.84     60580
       probe       0.74      0.68      0.71      4166
         r2l       0.67      0.00      0.00     13773
         u2r       0.02      0.00      0.00      2636

   micro avg       0.92      0.92      0.92    311008
   macro avg       0.63      0.53      0.51    311008
weighted avg       0.92      0.92      0.90    311008

2020-01-13 22:40:34,984 [INFO] Overall accuracy (micro avg): 0.9205454522070172
2020-01-13 22:40:40,444 [INFO] Average metrics for Testing dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9205         0.9205                       0.9205                0.0199                   0.0795  0.9205
1     Macro avg        0.9682         0.6306                       0.5298                0.0215                   0.4702  0.5076
2  Weighted avg        0.9651         0.9166                       0.9205                0.0281                   0.0795  0.8998
2020-01-13 22:40:57,278 [INFO] Dataset: Validation. Classification report below
2020-01-13 22:40:57,278 [INFO] 
              precision    recall  f1-score   support

         dos       1.00      1.00      1.00    776671
     normal.       1.00      1.00      1.00    194553
       probe       0.99      0.93      0.96      8221
         r2l       0.00      0.00      0.00       225
         u2r       0.00      0.00      0.00        10

   micro avg       1.00      1.00      1.00    979680
   macro avg       0.60      0.59      0.59    979680
weighted avg       1.00      1.00      1.00    979680

2020-01-13 22:40:57,278 [INFO] Overall accuracy (micro avg): 0.9989006614404704
/home/hasitha/sunanda/ids_experiments/utility.py:334: RuntimeWarning: invalid value encountered in true_divide
  F1 = (2 * PPV * TPR) / (PPV + TPR)  # F1 score
2020-01-13 22:41:16,350 [INFO] Average metrics for Validation dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9989         0.9989                       0.9989                0.0003                   0.0011  0.9989
1     Macro avg        0.9996         0.5973                       0.5866                0.0005                   0.4134  0.5918
2  Weighted avg        0.9995         0.9987                       0.9989                0.0013                   0.0011  0.9988
2020-01-13 22:42:29,760 [INFO] Dataset: Training. Classification report below
2020-01-13 22:42:29,761 [INFO] 
              precision    recall  f1-score   support

         dos       1.00      1.00      1.00   3106675
     normal.       1.00      1.00      1.00    778221
       probe       0.99      0.94      0.96     32881
         r2l       0.20      0.00      0.00       901
         u2r       0.00      0.00      0.00        42

   micro avg       1.00      1.00      1.00   3918720
   macro avg       0.64      0.59      0.59   3918720
weighted avg       1.00      1.00      1.00   3918720

2020-01-13 22:42:29,761 [INFO] Overall accuracy (micro avg): 0.9989363873918014
2020-01-13 22:43:52,850 [INFO] Average metrics for Training dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9989         0.9989                       0.9989                0.0003                   0.0011  0.9989
1     Macro avg        0.9996         0.6376                       0.5873                0.0004                   0.4127  0.5929
2  Weighted avg        0.9995         0.9987                       0.9989                0.0012                   0.0011  0.9988
2020-01-13 22:43:52,915 [INFO] Results saved to: results_additional_exps/train_time_kdd99_lstm_deep_rep2/train_time_kdd99_lstm_deep_rep2_results.xlsx
2020-01-13 22:43:52,923 [INFO] ================= Finished running experiment no. 2 ================= 

2020-01-13 22:43:53,128 [INFO] Created directory: results_additional_exps/train_time_kdd99_lstm_deep_rep3
2020-01-13 22:43:53,141 [INFO] Initialized logging. log_filename = results_additional_exps/train_time_kdd99_lstm_deep_rep3/run_log.log
2020-01-13 22:43:53,142 [INFO] ================= Running experiment no. 3  ================= 

2020-01-13 22:43:53,142 [INFO] Experiment parameters given below
2020-01-13 22:43:53,142 [INFO] 
{'experiment_num': 3, 'results_dir': 'results_additional_exps/train_time_kdd99_lstm_deep_rep3', 'model': 'lstm', 'model_type': 'classifier', 'normal_label': 'normal', 'lstm_time_steps': 32, 'lstm_layer_units': [32, 16], 'lstm_layer_activations': ['relu', 'relu'], 'lstm_layer_dropout_rates': [0.2, 0.2], 'batch_size': 256, 'epochs': 100, 'early_stop_patience': 100, 'goal_metric': 0.919948449, 'training_set': 'train_set_only', 'dataset_dir': '../Datasets/full_datasets/kdd99_five_classes', 'description': 'train_time_kdd99_lstm_deep_rep3'}
2020-01-13 22:43:53,142 [INFO] Created tensorboard log directory: results_additional_exps/train_time_kdd99_lstm_deep_rep3/tf_logs_run_2020_01_13-22_43_53
2020-01-13 22:43:53,142 [INFO] Loading datsets from: ../Datasets/full_datasets/kdd99_five_classes
2020-01-13 22:43:53,157 [INFO] Reading X, y files
2020-01-13 22:43:53,158 [INFO] Reading HDF dataset ../Datasets/full_datasets/kdd99_five_classes/X_train.h5
2020-01-13 22:44:02,444 [INFO] Reading complete. time_to_read=9.29 seconds
2020-01-13 22:44:02,445 [INFO] Reading HDF dataset ../Datasets/full_datasets/kdd99_five_classes/X_val.h5
2020-01-13 22:44:04,766 [INFO] Reading complete. time_to_read=2.32 seconds
2020-01-13 22:44:04,767 [INFO] Reading HDF dataset ../Datasets/full_datasets/kdd99_five_classes/X_test.h5
2020-01-13 22:44:05,450 [INFO] Reading complete. time_to_read=0.68 seconds
2020-01-13 22:44:05,450 [INFO] Reading HDF dataset ../Datasets/full_datasets/kdd99_five_classes/y_train.h5
2020-01-13 22:44:05,964 [INFO] Reading complete. time_to_read=0.51 seconds
2020-01-13 22:44:05,964 [INFO] Reading HDF dataset ../Datasets/full_datasets/kdd99_five_classes/y_val.h5
2020-01-13 22:44:06,081 [INFO] Reading complete. time_to_read=0.12 seconds
2020-01-13 22:44:06,081 [INFO] Reading HDF dataset ../Datasets/full_datasets/kdd99_five_classes/y_test.h5
2020-01-13 22:44:06,136 [INFO] Reading complete. time_to_read=0.06 seconds
2020-01-13 22:44:49,845 [INFO] Preparing flow sequences
2020-01-13 22:46:33,790 [INFO] Extracting flows complete. time_taken = 103.90 sec
2020-01-13 22:46:37,996 [INFO] Initializing model
2020-01-13 22:46:49,003 [INFO] _________________________________________________________________
2020-01-13 22:46:49,004 [INFO] Layer (type)                 Output Shape              Param #   
2020-01-13 22:46:49,004 [INFO] =================================================================
2020-01-13 22:46:49,004 [INFO] lstm_17 (LSTM)               (None, 32, 32)            19968     
2020-01-13 22:46:49,004 [INFO] _________________________________________________________________
2020-01-13 22:46:49,004 [INFO] batch_normalization_17 (Batc (None, 32, 32)            128       
2020-01-13 22:46:49,004 [INFO] _________________________________________________________________
2020-01-13 22:46:49,004 [INFO] dropout_17 (Dropout)         (None, 32, 32)            0         
2020-01-13 22:46:49,014 [INFO] _________________________________________________________________
2020-01-13 22:46:49,014 [INFO] lstm_18 (LSTM)               (None, 32, 16)            3136      
2020-01-13 22:46:49,014 [INFO] _________________________________________________________________
2020-01-13 22:46:49,014 [INFO] batch_normalization_18 (Batc (None, 32, 16)            64        
2020-01-13 22:46:49,014 [INFO] _________________________________________________________________
2020-01-13 22:46:49,014 [INFO] dropout_18 (Dropout)         (None, 32, 16)            0         
2020-01-13 22:46:49,014 [INFO] _________________________________________________________________
2020-01-13 22:46:49,014 [INFO] time_distributed_9 (TimeDist (None, 32, 5)             85        
2020-01-13 22:46:49,014 [INFO] =================================================================
2020-01-13 22:46:49,014 [INFO] Total params: 23,381
2020-01-13 22:46:49,015 [INFO] Trainable params: 23,285
2020-01-13 22:46:49,015 [INFO] Non-trainable params: 96
2020-01-13 22:46:49,015 [INFO] _________________________________________________________________
2020-01-13 22:46:49,015 [INFO] Training model
 - val_f1: 0.9988
 - out_of_sample_accuracy: 0.9204
Train on 122460 samples, validate on 30615 samples
Epoch 1/100
 - 30s - loss: 0.1190 - val_loss: 0.0148
 - val_f1: 0.9962
 - out_of_sample_accuracy: 0.9130
Epoch 2/100
 - 18s - loss: 0.0081 - val_loss: 0.0030
 - val_f1: 0.9984
 - out_of_sample_accuracy: 0.9141
Epoch 3/100
 - 19s - loss: 0.0046 - val_loss: 0.0021
 - val_f1: 0.9988
 - out_of_sample_accuracy: 0.9054
Epoch 4/100
 - 19s - loss: 0.0034 - val_loss: 0.0019
 - val_f1: 0.9989
 - out_of_sample_accuracy: 0.9083
Epoch 5/100
 - 19s - loss: 0.0027 - val_loss: 0.0014
 - val_f1: 0.9992
 - out_of_sample_accuracy: 0.8794
Epoch 6/100
 - 19s - loss: 0.0022 - val_loss: 0.0011
 - val_f1: 0.9992
 - out_of_sample_accuracy: 0.9182
Epoch 7/100
 - 19s - loss: 0.0018 - val_loss: 0.0010
 - val_f1: 0.9993
 - out_of_sample_accuracy: 0.9194
Epoch 8/100
 - 19s - loss: 0.0015 - val_loss: 8.7885e-04
 - val_f1: 0.9993
 - out_of_sample_accuracy: 0.9192
Epoch 9/100
 - 19s - loss: 0.0013 - val_loss: 7.4339e-04
 - val_f1: 0.9994
 - out_of_sample_accuracy: 0.9181
Epoch 10/100
 - 19s - loss: 0.0012 - val_loss: 6.9276e-04
 - val_f1: 0.9994
 - out_of_sample_accuracy: 0.9177
Epoch 11/100
 - 19s - loss: 0.0012 - val_loss: 7.4402e-04
/home/hasitha/anaconda3/lib/python3.7/site-packages/sklearn/metrics/classification.py:1143: UndefinedMetricWarning: F-score is ill-defined and being set to 0.0 in labels with no predicted samples.
  'precision', 'predicted', average, warn_for)
2020-01-13 22:51:43,763 [INFO] epoch = 10. Intermediate model saved to results_additional_exps/train_time_kdd99_lstm_deep_rep3/_model_epoch_10.pickle
 - val_f1: 0.9994
 - out_of_sample_accuracy: 0.9195
Epoch 12/100
 - 19s - loss: 0.0011 - val_loss: 7.6678e-04
2020-01-13 22:52:14,680 [INFO] StopperOnGoal: reached goal_metric (accuracy). Stopping training. goal_metric = 0.9199, current_metric = 0.9212, num_epochs = 12
2020-01-13 22:52:14,681 [INFO] WeightRestorer::on_train_end(): restoring best weights
2020-01-13 22:52:36,432 [INFO] Last epoch loss evaluation: train_loss = 0.000661, val_loss = 0.000693
2020-01-13 22:52:36,432 [INFO] Training complete. time_to_train = 347.42 sec, 5.79 min
2020-01-13 22:52:36,438 [INFO] Model saved to results_additional_exps/train_time_kdd99_lstm_deep_rep3/best_model.pickle
2020-01-13 22:52:36,475 [INFO] Training history saved to: results_additional_exps/train_time_kdd99_lstm_deep_rep3/training_error_history.csv
2020-01-13 22:52:36,788 [INFO] Plot saved to: results_additional_exps/train_time_kdd99_lstm_deep_rep3/training_error_history.png
2020-01-13 22:52:36,912 [INFO] Plot saved to: results_additional_exps/train_time_kdd99_lstm_deep_rep3/training_f1_history.png
2020-01-13 22:52:36,913 [INFO] Making predictions on training, validation, testing data
2020-01-13 22:52:59,675 [INFO] Making predictions complete. time_to_predict = 22.76 sec, 0.38 min
2020-01-13 22:52:59,791 [INFO] Evaluating predictions (results)
/home/hasitha/anaconda3/lib/python3.7/site-packages/sklearn/metrics/classification.py:1143: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples.
  'precision', 'predicted', average, warn_for)
2020-01-13 22:53:04,493 [INFO] Dataset: Testing. Classification report below
2020-01-13 22:53:04,493 [INFO] 
              precision    recall  f1-score   support

         dos       1.00      0.97      0.98    229853
     normal.       0.72      0.98      0.83     60580
       probe       0.69      0.72      0.70      4166
         r2l       0.18      0.00      0.01     13773
         u2r       0.00      0.00      0.00      2636

   micro avg       0.92      0.92      0.92    311008
   macro avg       0.52      0.53      0.50    311008
weighted avg       0.89      0.92      0.90    311008

2020-01-13 22:53:04,493 [INFO] Overall accuracy (micro avg): 0.9178734952155572
/home/hasitha/sunanda/ids_experiments/utility.py:328: RuntimeWarning: invalid value encountered in true_divide
  PPV = TP / (TP + FP)    # Precision or positive predictive value
/home/hasitha/sunanda/ids_experiments/utility.py:332: RuntimeWarning: invalid value encountered in true_divide
  FDR = FP / (TP + FP)    # False discovery rate
2020-01-13 22:53:09,873 [INFO] Average metrics for Testing dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9179         0.9179                       0.9179                0.0205                   0.0821  0.9179
1     Macro avg        0.9671         0.5178                       0.5344                0.0210                   0.4656  0.5042
2  Weighted avg        0.9647         0.8946                       0.9179                0.0226                   0.0821  0.8981
2020-01-13 22:53:26,402 [INFO] Dataset: Validation. Classification report below
2020-01-13 22:53:26,402 [INFO] 
              precision    recall  f1-score   support

         dos       1.00      1.00      1.00    776671
     normal.       1.00      1.00      1.00    194553
       probe       0.99      0.98      0.99      8221
         r2l       0.76      0.11      0.19       225
         u2r       0.00      0.00      0.00        10

   micro avg       1.00      1.00      1.00    979680
   macro avg       0.75      0.62      0.64    979680
weighted avg       1.00      1.00      1.00    979680

2020-01-13 22:53:26,402 [INFO] Overall accuracy (micro avg): 0.9995273967009636
2020-01-13 22:53:45,178 [INFO] Average metrics for Validation dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9995         0.9995                       0.9995                0.0001                   0.0005  0.9995
1     Macro avg        0.9998         0.7498                       0.6186                0.0002                   0.3814  0.6361
2  Weighted avg        0.9998         0.9995                       0.9995                0.0004                   0.0005  0.9994
2020-01-13 22:54:57,353 [INFO] Dataset: Training. Classification report below
2020-01-13 22:54:57,353 [INFO] 
              precision    recall  f1-score   support

         dos       1.00      1.00      1.00   3106675
     normal.       1.00      1.00      1.00    778221
       probe       0.99      0.98      0.99     32881
         r2l       0.69      0.09      0.15       901
         u2r       0.00      0.00      0.00        42

   micro avg       1.00      1.00      1.00   3918720
   macro avg       0.74      0.61      0.63   3918720
weighted avg       1.00      1.00      1.00   3918720

2020-01-13 22:54:57,353 [INFO] Overall accuracy (micro avg): 0.9995383696717296
/home/hasitha/sunanda/ids_experiments/utility.py:334: RuntimeWarning: invalid value encountered in true_divide
  F1 = (2 * PPV * TPR) / (PPV + TPR)  # F1 score
2020-01-13 22:56:19,016 [INFO] Average metrics for Training dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9995         0.9995                       0.9995                0.0001                   0.0005  0.9995
1     Macro avg        0.9998         0.7360                       0.6138                0.0002                   0.3862  0.6280
2  Weighted avg        0.9998         0.9995                       0.9995                0.0004                   0.0005  0.9994
2020-01-13 22:56:19,063 [INFO] Results saved to: results_additional_exps/train_time_kdd99_lstm_deep_rep3/train_time_kdd99_lstm_deep_rep3_results.xlsx
2020-01-13 22:56:19,070 [INFO] ================= Finished running experiment no. 3 ================= 

2020-01-13 22:56:19,277 [INFO] Created directory: results_additional_exps/train_time_ids18_subset_lstm_deep_rep1
2020-01-13 22:56:19,278 [INFO] Initialized logging. log_filename = results_additional_exps/train_time_ids18_subset_lstm_deep_rep1/run_log.log
2020-01-13 22:56:19,278 [INFO] ================= Running experiment no. 1  ================= 

2020-01-13 22:56:19,278 [INFO] Experiment parameters given below
2020-01-13 22:56:19,278 [INFO] 
{'experiment_num': 1, 'results_dir': 'results_additional_exps/train_time_ids18_subset_lstm_deep_rep1', 'model': 'lstm', 'model_type': 'classifier', 'normal_label': 'BENIGN', 'lstm_time_steps': 32, 'lstm_layer_units': [64, 32], 'lstm_layer_activations': ['relu', 'relu'], 'lstm_layer_dropout_rates': [0.2, 0.2], 'batch_size': 256, 'epochs': 100, 'early_stop_patience': 100, 'goal_metric': 0.983310557, 'training_set': 'train_set_only', 'dataset_dir': '../Datasets/small_datasets/ids2018', 'description': 'train_time_ids18_subset_lstm_deep_rep1'}
2020-01-13 22:56:19,278 [INFO] Created tensorboard log directory: results_additional_exps/train_time_ids18_subset_lstm_deep_rep1/tf_logs_run_2020_01_13-22_56_19
2020-01-13 22:56:19,278 [INFO] Loading datsets from: ../Datasets/small_datasets/ids2018
2020-01-13 22:56:19,289 [INFO] Reading X, y files
2020-01-13 22:56:19,289 [INFO] Reading HDF dataset ../Datasets/small_datasets/ids2018/X_train.h5
2020-01-13 22:56:25,533 [INFO] Reading complete. time_to_read=6.24 seconds
2020-01-13 22:56:25,534 [INFO] Reading HDF dataset ../Datasets/small_datasets/ids2018/X_val.h5
2020-01-13 22:56:27,209 [INFO] Reading complete. time_to_read=1.68 seconds
2020-01-13 22:56:27,209 [INFO] Reading HDF dataset ../Datasets/small_datasets/ids2018/X_test.h5
2020-01-13 22:56:28,901 [INFO] Reading complete. time_to_read=1.69 seconds
2020-01-13 22:56:28,901 [INFO] Reading HDF dataset ../Datasets/small_datasets/ids2018/y_train.h5
2020-01-13 22:56:29,799 [INFO] Reading complete. time_to_read=0.90 seconds
2020-01-13 22:56:29,799 [INFO] Reading HDF dataset ../Datasets/small_datasets/ids2018/y_val.h5
2020-01-13 22:56:29,989 [INFO] Reading complete. time_to_read=0.19 seconds
2020-01-13 22:56:29,989 [INFO] Reading HDF dataset ../Datasets/small_datasets/ids2018/y_test.h5
2020-01-13 22:56:30,165 [INFO] Reading complete. time_to_read=0.18 seconds
2020-01-13 22:56:32,997 [INFO] Preparing flow sequences
2020-01-13 22:56:58,076 [INFO] Extracting flows complete. time_taken = 25.08 sec
2020-01-13 22:56:59,371 [INFO] Initializing model
2020-01-13 22:57:00,005 [INFO] _________________________________________________________________
2020-01-13 22:57:00,005 [INFO] Layer (type)                 Output Shape              Param #   
2020-01-13 22:57:00,005 [INFO] =================================================================
2020-01-13 22:57:00,005 [INFO] lstm_19 (LSTM)               (None, 32, 64)            36352     
2020-01-13 22:57:00,005 [INFO] _________________________________________________________________
2020-01-13 22:57:00,005 [INFO] batch_normalization_19 (Batc (None, 32, 64)            256       
2020-01-13 22:57:00,005 [INFO] _________________________________________________________________
2020-01-13 22:57:00,006 [INFO] dropout_19 (Dropout)         (None, 32, 64)            0         
2020-01-13 22:57:00,006 [INFO] _________________________________________________________________
2020-01-13 22:57:00,006 [INFO] lstm_20 (LSTM)               (None, 32, 32)            12416     
2020-01-13 22:57:00,006 [INFO] _________________________________________________________________
2020-01-13 22:57:00,006 [INFO] batch_normalization_20 (Batc (None, 32, 32)            128       
2020-01-13 22:57:00,006 [INFO] _________________________________________________________________
2020-01-13 22:57:00,006 [INFO] dropout_20 (Dropout)         (None, 32, 32)            0         
2020-01-13 22:57:00,006 [INFO] _________________________________________________________________
2020-01-13 22:57:00,006 [INFO] time_distributed_10 (TimeDis (None, 32, 15)            495       
2020-01-13 22:57:00,006 [INFO] =================================================================
2020-01-13 22:57:00,006 [INFO] Total params: 49,647
2020-01-13 22:57:00,006 [INFO] Trainable params: 49,455
2020-01-13 22:57:00,006 [INFO] Non-trainable params: 192
2020-01-13 22:57:00,006 [INFO] _________________________________________________________________
2020-01-13 22:57:00,006 [INFO] Training model
 - val_f1: 0.9994
 - out_of_sample_accuracy: 0.9212
Train on 60514 samples, validate on 20171 samples
Epoch 1/100
 - 17s - loss: 0.1664 - val_loss: 0.0883
 - val_f1: 0.7517
 - out_of_sample_accuracy: 0.8270
Epoch 2/100
 - 15s - loss: 0.0803 - val_loss: 0.0730
 - val_f1: 0.7614
 - out_of_sample_accuracy: 0.8283
Epoch 3/100
 - 15s - loss: 0.0674 - val_loss: 0.0614
 - val_f1: 0.7691
 - out_of_sample_accuracy: 0.8294
Epoch 4/100
 - 15s - loss: 0.0585 - val_loss: 0.0533
 - val_f1: 0.7836
 - out_of_sample_accuracy: 0.8268
Epoch 5/100
 - 15s - loss: 0.0519 - val_loss: 0.0573
 - val_f1: 0.7727
 - out_of_sample_accuracy: 0.8314
Epoch 6/100
 - 15s - loss: 0.0465 - val_loss: 0.0419
 - val_f1: 0.8091
 - out_of_sample_accuracy: 0.8312
Epoch 7/100
 - 15s - loss: 0.0418 - val_loss: 0.0341
 - val_f1: 0.8862
 - out_of_sample_accuracy: 0.8865
Epoch 8/100
 - 15s - loss: 0.0380 - val_loss: 0.0288
 - val_f1: 0.9170
 - out_of_sample_accuracy: 0.9220
Epoch 9/100
 - 15s - loss: 0.0347 - val_loss: 0.0257
 - val_f1: 0.9260
 - out_of_sample_accuracy: 0.9339
Epoch 10/100
 - 15s - loss: 0.0320 - val_loss: 0.0231
 - val_f1: 0.9334
 - out_of_sample_accuracy: 0.9445
Epoch 11/100
 - 15s - loss: 0.0299 - val_loss: 0.0216
/home/hasitha/anaconda3/lib/python3.7/site-packages/sklearn/metrics/classification.py:1143: UndefinedMetricWarning: F-score is ill-defined and being set to 0.0 in labels with no predicted samples.
  'precision', 'predicted', average, warn_for)
2020-01-13 23:01:05,825 [INFO] epoch = 10. Intermediate model saved to results_additional_exps/train_time_ids18_subset_lstm_deep_rep1/_model_epoch_10.pickle
 - val_f1: 0.9359
 - out_of_sample_accuracy: 0.9478
Epoch 12/100
 - 15s - loss: 0.0276 - val_loss: 0.0200
 - val_f1: 0.9388
 - out_of_sample_accuracy: 0.9511
Epoch 13/100
 - 15s - loss: 0.0258 - val_loss: 0.0185
 - val_f1: 0.9411
 - out_of_sample_accuracy: 0.9533
Epoch 14/100
 - 15s - loss: 0.0242 - val_loss: 0.0175
 - val_f1: 0.9465
 - out_of_sample_accuracy: 0.9563
Epoch 15/100
 - 15s - loss: 0.0229 - val_loss: 0.0166
 - val_f1: 0.9525
 - out_of_sample_accuracy: 0.9599
Epoch 16/100
 - 15s - loss: 0.0216 - val_loss: 0.0160
 - val_f1: 0.9538
 - out_of_sample_accuracy: 0.9607
Epoch 17/100
 - 15s - loss: 0.0207 - val_loss: 0.0149
 - val_f1: 0.9570
 - out_of_sample_accuracy: 0.9628
Epoch 18/100
 - 15s - loss: 0.0198 - val_loss: 0.0144
 - val_f1: 0.9595
 - out_of_sample_accuracy: 0.9630
Epoch 19/100
 - 15s - loss: 0.0189 - val_loss: 0.0138
 - val_f1: 0.9603
 - out_of_sample_accuracy: 0.9642
Epoch 20/100
 - 15s - loss: 0.0181 - val_loss: 0.0132
 - val_f1: 0.9643
 - out_of_sample_accuracy: 0.9668
Epoch 21/100
 - 15s - loss: 0.0173 - val_loss: 0.0130
2020-01-13 23:04:44,416 [INFO] epoch = 20. Intermediate model saved to results_additional_exps/train_time_ids18_subset_lstm_deep_rep1/_model_epoch_20.pickle
 - val_f1: 0.9668
 - out_of_sample_accuracy: 0.9704
Epoch 22/100
 - 15s - loss: 0.0167 - val_loss: 0.0127
 - val_f1: 0.9680
 - out_of_sample_accuracy: 0.9722
Epoch 23/100
 - 15s - loss: 0.0163 - val_loss: 0.0127
 - val_f1: 0.9658
 - out_of_sample_accuracy: 0.9703
Epoch 24/100
 - 15s - loss: 0.0156 - val_loss: 0.0118
 - val_f1: 0.9697
 - out_of_sample_accuracy: 0.9743
Epoch 25/100
 - 15s - loss: 0.0151 - val_loss: 0.0116
 - val_f1: 0.9704
 - out_of_sample_accuracy: 0.9750
Epoch 26/100
 - 15s - loss: 0.0146 - val_loss: 0.0113
 - val_f1: 0.9712
 - out_of_sample_accuracy: 0.9763
Epoch 27/100
 - 15s - loss: 0.0142 - val_loss: 0.0111
 - val_f1: 0.9724
 - out_of_sample_accuracy: 0.9770
Epoch 28/100
 - 15s - loss: 0.0137 - val_loss: 0.0110
 - val_f1: 0.9715
 - out_of_sample_accuracy: 0.9766
Epoch 29/100
 - 15s - loss: 0.0133 - val_loss: 0.0107
 - val_f1: 0.9726
 - out_of_sample_accuracy: 0.9775
Epoch 30/100
 - 15s - loss: 0.0130 - val_loss: 0.0114
 - val_f1: 0.9695
 - out_of_sample_accuracy: 0.9745
Epoch 31/100
 - 15s - loss: 0.0127 - val_loss: 0.0112
2020-01-13 23:08:22,883 [INFO] epoch = 30. Intermediate model saved to results_additional_exps/train_time_ids18_subset_lstm_deep_rep1/_model_epoch_30.pickle
 - val_f1: 0.9702
 - out_of_sample_accuracy: 0.9749
Epoch 32/100
 - 15s - loss: 0.0125 - val_loss: 0.0107
 - val_f1: 0.9731
 - out_of_sample_accuracy: 0.9781
Epoch 33/100
 - 15s - loss: 0.0122 - val_loss: 0.0103
 - val_f1: 0.9738
 - out_of_sample_accuracy: 0.9786
Epoch 34/100
 - 15s - loss: 0.0121 - val_loss: 0.0102
 - val_f1: 0.9730
 - out_of_sample_accuracy: 0.9785
Epoch 35/100
 - 15s - loss: 0.0119 - val_loss: 0.0101
 - val_f1: 0.9738
 - out_of_sample_accuracy: 0.9788
Epoch 36/100
 - 15s - loss: 0.0117 - val_loss: 0.0101
 - val_f1: 0.9736
 - out_of_sample_accuracy: 0.9789
Epoch 37/100
 - 15s - loss: 0.0116 - val_loss: 0.0098
 - val_f1: 0.9746
 - out_of_sample_accuracy: 0.9794
Epoch 38/100
 - 15s - loss: 0.0114 - val_loss: 0.0098
 - val_f1: 0.9740
 - out_of_sample_accuracy: 0.9790
Epoch 39/100
 - 15s - loss: 0.0112 - val_loss: 0.0096
 - val_f1: 0.9746
 - out_of_sample_accuracy: 0.9795
Epoch 40/100
 - 15s - loss: 0.0110 - val_loss: 0.0094
 - val_f1: 0.9746
 - out_of_sample_accuracy: 0.9796
Epoch 41/100
 - 15s - loss: 0.0108 - val_loss: 0.0094
2020-01-13 23:12:01,432 [INFO] epoch = 40. Intermediate model saved to results_additional_exps/train_time_ids18_subset_lstm_deep_rep1/_model_epoch_40.pickle
 - val_f1: 0.9749
 - out_of_sample_accuracy: 0.9797
Epoch 42/100
 - 15s - loss: 0.0107 - val_loss: 0.0092
 - val_f1: 0.9747
 - out_of_sample_accuracy: 0.9797
Epoch 43/100
 - 15s - loss: 0.0106 - val_loss: 0.0092
 - val_f1: 0.9758
 - out_of_sample_accuracy: 0.9805
Epoch 44/100
 - 15s - loss: 0.0104 - val_loss: 0.0091
 - val_f1: 0.9754
 - out_of_sample_accuracy: 0.9802
Epoch 45/100
 - 15s - loss: 0.0103 - val_loss: 0.0091
 - val_f1: 0.9745
 - out_of_sample_accuracy: 0.9797
Epoch 46/100
 - 15s - loss: 0.0102 - val_loss: 0.0090
 - val_f1: 0.9745
 - out_of_sample_accuracy: 0.9798
Epoch 47/100
 - 15s - loss: 0.0101 - val_loss: 0.0090
 - val_f1: 0.9753
 - out_of_sample_accuracy: 0.9801
Epoch 48/100
 - 15s - loss: 0.0100 - val_loss: 0.0090
 - val_f1: 0.9753
 - out_of_sample_accuracy: 0.9801
Epoch 49/100
 - 15s - loss: 0.0099 - val_loss: 0.0089
 - val_f1: 0.9750
 - out_of_sample_accuracy: 0.9801
Epoch 50/100
 - 15s - loss: 0.0098 - val_loss: 0.0088
 - val_f1: 0.9757
 - out_of_sample_accuracy: 0.9804
Epoch 51/100
 - 15s - loss: 0.0098 - val_loss: 0.0089
2020-01-13 23:15:40,107 [INFO] epoch = 50. Intermediate model saved to results_additional_exps/train_time_ids18_subset_lstm_deep_rep1/_model_epoch_50.pickle
 - val_f1: 0.9747
 - out_of_sample_accuracy: 0.9799
Epoch 52/100
 - 15s - loss: 0.0097 - val_loss: 0.0088
 - val_f1: 0.9759
 - out_of_sample_accuracy: 0.9805
Epoch 53/100
 - 15s - loss: 0.0096 - val_loss: 0.0087
 - val_f1: 0.9755
 - out_of_sample_accuracy: 0.9803
Epoch 54/100
 - 15s - loss: 0.0096 - val_loss: 0.0087
 - val_f1: 0.9764
 - out_of_sample_accuracy: 0.9809
Epoch 55/100
 - 15s - loss: 0.0095 - val_loss: 0.0087
 - val_f1: 0.9752
 - out_of_sample_accuracy: 0.9801
Epoch 56/100
 - 15s - loss: 0.0095 - val_loss: 0.0086
 - val_f1: 0.9768
 - out_of_sample_accuracy: 0.9814
Epoch 57/100
 - 15s - loss: 0.0094 - val_loss: 0.0087
 - val_f1: 0.9758
 - out_of_sample_accuracy: 0.9806
Epoch 58/100
 - 15s - loss: 0.0093 - val_loss: 0.0087
 - val_f1: 0.9758
 - out_of_sample_accuracy: 0.9806
Epoch 59/100
 - 15s - loss: 0.0092 - val_loss: 0.0085
 - val_f1: 0.9770
 - out_of_sample_accuracy: 0.9821
Epoch 60/100
 - 15s - loss: 0.0091 - val_loss: 0.0084
 - val_f1: 0.9758
 - out_of_sample_accuracy: 0.9808
Epoch 61/100
 - 15s - loss: 0.0090 - val_loss: 0.0084
2020-01-13 23:19:18,619 [INFO] epoch = 60. Intermediate model saved to results_additional_exps/train_time_ids18_subset_lstm_deep_rep1/_model_epoch_60.pickle
 - val_f1: 0.9758
 - out_of_sample_accuracy: 0.9810
Epoch 62/100
 - 15s - loss: 0.0089 - val_loss: 0.0083
 - val_f1: 0.9759
 - out_of_sample_accuracy: 0.9810
Epoch 63/100
 - 15s - loss: 0.0089 - val_loss: 0.0086
 - val_f1: 0.9760
 - out_of_sample_accuracy: 0.9807
Epoch 64/100
 - 15s - loss: 0.0088 - val_loss: 0.0083
 - val_f1: 0.9767
 - out_of_sample_accuracy: 0.9815
Epoch 65/100
 - 15s - loss: 0.0088 - val_loss: 0.0082
 - val_f1: 0.9773
 - out_of_sample_accuracy: 0.9824
Epoch 66/100
 - 15s - loss: 0.0087 - val_loss: 0.0082
 - val_f1: 0.9771
 - out_of_sample_accuracy: 0.9819
Epoch 67/100
 - 15s - loss: 0.0087 - val_loss: 0.0082
 - val_f1: 0.9761
 - out_of_sample_accuracy: 0.9813
Epoch 68/100
 - 15s - loss: 0.0086 - val_loss: 0.0081
 - val_f1: 0.9773
 - out_of_sample_accuracy: 0.9823
Epoch 69/100
 - 15s - loss: 0.0086 - val_loss: 0.0081
 - val_f1: 0.9773
 - out_of_sample_accuracy: 0.9822
Epoch 70/100
 - 15s - loss: 0.0086 - val_loss: 0.0082
 - val_f1: 0.9762
 - out_of_sample_accuracy: 0.9813
Epoch 71/100
 - 15s - loss: 0.0086 - val_loss: 0.0081
2020-01-13 23:22:57,119 [INFO] epoch = 70. Intermediate model saved to results_additional_exps/train_time_ids18_subset_lstm_deep_rep1/_model_epoch_70.pickle
 - val_f1: 0.9765
 - out_of_sample_accuracy: 0.9814
Epoch 72/100
 - 15s - loss: 0.0085 - val_loss: 0.0081
 - val_f1: 0.9775
 - out_of_sample_accuracy: 0.9826
Epoch 73/100
 - 15s - loss: 0.0085 - val_loss: 0.0081
 - val_f1: 0.9769
 - out_of_sample_accuracy: 0.9817
Epoch 74/100
 - 15s - loss: 0.0084 - val_loss: 0.0081
 - val_f1: 0.9761
 - out_of_sample_accuracy: 0.9814
Epoch 75/100
 - 15s - loss: 0.0084 - val_loss: 0.0082
 - val_f1: 0.9775
 - out_of_sample_accuracy: 0.9825
Epoch 76/100
 - 15s - loss: 0.0084 - val_loss: 0.0081
 - val_f1: 0.9764
 - out_of_sample_accuracy: 0.9815
Epoch 77/100
 - 15s - loss: 0.0084 - val_loss: 0.0080
 - val_f1: 0.9771
 - out_of_sample_accuracy: 0.9820
Epoch 78/100
 - 15s - loss: 0.0083 - val_loss: 0.0081
 - val_f1: 0.9763
 - out_of_sample_accuracy: 0.9814
Epoch 79/100
 - 15s - loss: 0.0083 - val_loss: 0.0080
 - val_f1: 0.9765
 - out_of_sample_accuracy: 0.9816
Epoch 80/100
 - 15s - loss: 0.0083 - val_loss: 0.0080
 - val_f1: 0.9770
 - out_of_sample_accuracy: 0.9818
Epoch 81/100
 - 15s - loss: 0.0083 - val_loss: 0.0080
2020-01-13 23:26:35,744 [INFO] epoch = 80. Intermediate model saved to results_additional_exps/train_time_ids18_subset_lstm_deep_rep1/_model_epoch_80.pickle
 - val_f1: 0.9776
 - out_of_sample_accuracy: 0.9826
Epoch 82/100
 - 15s - loss: 0.0083 - val_loss: 0.0080
 - val_f1: 0.9776
 - out_of_sample_accuracy: 0.9826
Epoch 83/100
 - 15s - loss: 0.0083 - val_loss: 0.0080
 - val_f1: 0.9766
 - out_of_sample_accuracy: 0.9816
Epoch 84/100
 - 15s - loss: 0.0082 - val_loss: 0.0080
 - val_f1: 0.9765
 - out_of_sample_accuracy: 0.9816
Epoch 85/100
 - 15s - loss: 0.0082 - val_loss: 0.0080
 - val_f1: 0.9763
 - out_of_sample_accuracy: 0.9815
Epoch 86/100
 - 15s - loss: 0.0082 - val_loss: 0.0080
 - val_f1: 0.9771
 - out_of_sample_accuracy: 0.9819
Epoch 87/100
 - 15s - loss: 0.0082 - val_loss: 0.0080
 - val_f1: 0.9778
 - out_of_sample_accuracy: 0.9829
Epoch 88/100
 - 15s - loss: 0.0082 - val_loss: 0.0080
 - val_f1: 0.9778
 - out_of_sample_accuracy: 0.9829
Epoch 89/100
 - 15s - loss: 0.0082 - val_loss: 0.0080
 - val_f1: 0.9766
 - out_of_sample_accuracy: 0.9816
Epoch 90/100
 - 15s - loss: 0.0081 - val_loss: 0.0080
 - val_f1: 0.9777
 - out_of_sample_accuracy: 0.9828
Epoch 91/100
 - 15s - loss: 0.0081 - val_loss: 0.0079
2020-01-13 23:30:14,319 [INFO] epoch = 90. Intermediate model saved to results_additional_exps/train_time_ids18_subset_lstm_deep_rep1/_model_epoch_90.pickle
 - val_f1: 0.9779
 - out_of_sample_accuracy: 0.9830
Epoch 92/100
 - 15s - loss: 0.0081 - val_loss: 0.0081
 - val_f1: 0.9775
 - out_of_sample_accuracy: 0.9825
Epoch 93/100
 - 15s - loss: 0.0081 - val_loss: 0.0079
 - val_f1: 0.9780
 - out_of_sample_accuracy: 0.9831
Epoch 94/100
 - 15s - loss: 0.0081 - val_loss: 0.0079
 - val_f1: 0.9778
 - out_of_sample_accuracy: 0.9830
Epoch 95/100
 - 15s - loss: 0.0082 - val_loss: 0.0080
 - val_f1: 0.9775
 - out_of_sample_accuracy: 0.9823
Epoch 96/100
 - 15s - loss: 0.0081 - val_loss: 0.0080
 - val_f1: 0.9780
 - out_of_sample_accuracy: 0.9831
Epoch 97/100
 - 15s - loss: 0.0081 - val_loss: 0.0085
 - val_f1: 0.9765
 - out_of_sample_accuracy: 0.9816
Epoch 98/100
 - 15s - loss: 0.0081 - val_loss: 0.0081
 - val_f1: 0.9778
 - out_of_sample_accuracy: 0.9826
Epoch 99/100
 - 15s - loss: 0.0080 - val_loss: 0.0083
 - val_f1: 0.9759
 - out_of_sample_accuracy: 0.9811
Epoch 100/100
 - 15s - loss: 0.0080 - val_loss: 0.0083
2020-01-13 23:33:38,099 [INFO] StopperOnGoal: did not reach goal, num_epochs = 100
2020-01-13 23:33:38,099 [INFO] WeightRestorer::on_train_end(): restoring best weights
2020-01-13 23:33:51,192 [INFO] Last epoch loss evaluation: train_loss = 0.007816, val_loss = 0.007890
2020-01-13 23:33:51,192 [INFO] Training complete. time_to_train = 2211.19 sec, 36.85 min
2020-01-13 23:33:51,198 [INFO] Model saved to results_additional_exps/train_time_ids18_subset_lstm_deep_rep1/best_model.pickle
2020-01-13 23:33:51,200 [INFO] Training history saved to: results_additional_exps/train_time_ids18_subset_lstm_deep_rep1/training_error_history.csv
2020-01-13 23:33:51,336 [INFO] Plot saved to: results_additional_exps/train_time_ids18_subset_lstm_deep_rep1/training_error_history.png
2020-01-13 23:33:51,451 [INFO] Plot saved to: results_additional_exps/train_time_ids18_subset_lstm_deep_rep1/training_f1_history.png
2020-01-13 23:33:51,451 [INFO] Making predictions on training, validation, testing data
2020-01-13 23:34:06,130 [INFO] Making predictions complete. time_to_predict = 14.68 sec, 0.24 min
2020-01-13 23:34:06,200 [INFO] Evaluating predictions (results)
/home/hasitha/anaconda3/lib/python3.7/site-packages/sklearn/metrics/classification.py:1143: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples.
  'precision', 'predicted', average, warn_for)
2020-01-13 23:34:18,261 [INFO] Dataset: Testing. Classification report below
2020-01-13 23:34:18,261 [INFO] 
                          precision    recall  f1-score   support

                  Benign       0.99      1.00      0.99    535639
                     Bot       1.00      1.00      1.00     11465
        Brute Force -Web       0.75      0.12      0.21        24
        Brute Force -XSS       1.00      0.33      0.50         9
        DDOS attack-HOIC       1.00      1.00      1.00     27446
    DDOS attack-LOIC-UDP       0.78      0.81      0.79        67
  DDoS attacks-LOIC-HTTP       0.99      1.00      0.99     23008
   DoS attacks-GoldenEye       0.99      0.99      0.99      1651
        DoS attacks-Hulk       1.00      1.00      1.00     18477
DoS attacks-SlowHTTPTest       0.74      0.46      0.56      5596
   DoS attacks-Slowloris       0.99      0.77      0.87       440
          FTP-BruteForce       0.69      0.88      0.77      7718
           Infilteration       0.73      0.00      0.00      6403
           SQL Injection       0.00      0.00      0.00         4
          SSH-Bruteforce       1.00      1.00      1.00      7525

               micro avg       0.98      0.98      0.98    645472
               macro avg       0.84      0.69      0.71    645472
            weighted avg       0.98      0.98      0.98    645472

2020-01-13 23:34:18,262 [INFO] Overall accuracy (micro avg): 0.9830480640523523
/home/hasitha/sunanda/ids_experiments/utility.py:328: RuntimeWarning: invalid value encountered in true_divide
  PPV = TP / (TP + FP)    # Precision or positive predictive value
/home/hasitha/sunanda/ids_experiments/utility.py:332: RuntimeWarning: invalid value encountered in true_divide
  FDR = FP / (TP + FP)    # False discovery rate
2020-01-13 23:34:31,917 [INFO] Average metrics for Testing dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9830         0.9830                       0.9830                0.0012                   0.0170  0.9830
1     Macro avg        0.9977         0.8430                       0.6905                0.0045                   0.3095  0.7127
2  Weighted avg        0.9908         0.9806                       0.9830                0.0505                   0.0170  0.9778
2020-01-13 23:34:44,208 [INFO] Dataset: Validation. Classification report below
2020-01-13 23:34:44,208 [INFO] 
                          precision    recall  f1-score   support

                  Benign       0.99      1.00      0.99    535636
                     Bot       1.00      1.00      1.00     11464
        Brute Force -Web       1.00      0.16      0.28        25
        Brute Force -XSS       1.00      0.67      0.80         9
        DDOS attack-HOIC       1.00      1.00      1.00     27447
    DDOS attack-LOIC-UDP       0.82      0.74      0.78        68
  DDoS attacks-LOIC-HTTP       0.99      1.00      0.99     23009
   DoS attacks-GoldenEye       0.99      0.99      0.99      1651
        DoS attacks-Hulk       1.00      1.00      1.00     18478
DoS attacks-SlowHTTPTest       0.75      0.45      0.56      5596
   DoS attacks-Slowloris       0.98      0.83      0.90       439
          FTP-BruteForce       0.69      0.89      0.78      7718
           Infilteration       0.33      0.00      0.00      6403
           SQL Injection       0.00      0.00      0.00         4
          SSH-Bruteforce       1.00      1.00      1.00      7525

               micro avg       0.98      0.98      0.98    645472
               macro avg       0.84      0.71      0.74    645472
            weighted avg       0.98      0.98      0.98    645472

2020-01-13 23:34:44,208 [INFO] Overall accuracy (micro avg): 0.9831332730157156
2020-01-13 23:34:58,173 [INFO] Average metrics for Validation dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9831         0.9831                       0.9831                0.0012                   0.0169  0.9831
1     Macro avg        0.9978         0.8356                       0.7144                0.0045                   0.2856  0.7376
2  Weighted avg        0.9909         0.9768                       0.9831                0.0503                   0.0169  0.9778
2020-01-13 23:35:37,866 [INFO] Dataset: Training. Classification report below
2020-01-13 23:35:37,866 [INFO] 
                          precision    recall  f1-score   support

                  Benign       0.99      1.00      0.99   1606935
                     Bot       1.00      1.00      1.00     34396
        Brute Force -Web       1.00      0.12      0.22        73
        Brute Force -XSS       1.00      0.50      0.67        26
        DDOS attack-HOIC       1.00      1.00      1.00     82341
    DDOS attack-LOIC-UDP       0.78      0.80      0.79       203
  DDoS attacks-LOIC-HTTP       0.99      1.00      0.99     69029
   DoS attacks-GoldenEye       0.99      1.00      1.00      4954
        DoS attacks-Hulk       1.00      1.00      1.00     55435
DoS attacks-SlowHTTPTest       0.74      0.45      0.56     16787
   DoS attacks-Slowloris       0.99      0.83      0.90      1318
          FTP-BruteForce       0.69      0.88      0.78     23153
           Infilteration       0.62      0.00      0.00     19210
           SQL Injection       0.00      0.00      0.00        12
          SSH-Bruteforce       1.00      1.00      1.00     22576

               micro avg       0.98      0.98      0.98   1936448
               macro avg       0.85      0.71      0.73   1936448
            weighted avg       0.98      0.98      0.98   1936448

2020-01-13 23:35:37,866 [INFO] Overall accuracy (micro avg): 0.9831831270449813
2020-01-13 23:36:22,938 [INFO] Average metrics for Training dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9832         0.9832                       0.9832                0.0012                   0.0168  0.9832
1     Macro avg        0.9978         0.8528                       0.7055                0.0045                   0.2945  0.7265
2  Weighted avg        0.9909         0.9798                       0.9832                0.0501                   0.0168  0.9779
2020-01-13 23:36:22,968 [INFO] Results saved to: results_additional_exps/train_time_ids18_subset_lstm_deep_rep1/train_time_ids18_subset_lstm_deep_rep1_results.xlsx
2020-01-13 23:36:22,973 [INFO] ================= Finished running experiment no. 1 ================= 

2020-01-13 23:36:23,065 [INFO] Created directory: results_additional_exps/train_time_ids18_subset_lstm_deep_rep2
2020-01-13 23:36:23,066 [INFO] Initialized logging. log_filename = results_additional_exps/train_time_ids18_subset_lstm_deep_rep2/run_log.log
2020-01-13 23:36:23,066 [INFO] ================= Running experiment no. 2  ================= 

2020-01-13 23:36:23,066 [INFO] Experiment parameters given below
2020-01-13 23:36:23,066 [INFO] 
{'experiment_num': 2, 'results_dir': 'results_additional_exps/train_time_ids18_subset_lstm_deep_rep2', 'model': 'lstm', 'model_type': 'classifier', 'normal_label': 'BENIGN', 'lstm_time_steps': 32, 'lstm_layer_units': [64, 32], 'lstm_layer_activations': ['relu', 'relu'], 'lstm_layer_dropout_rates': [0.2, 0.2], 'batch_size': 256, 'epochs': 100, 'early_stop_patience': 100, 'goal_metric': 0.983310557, 'training_set': 'train_set_only', 'dataset_dir': '../Datasets/small_datasets/ids2018', 'description': 'train_time_ids18_subset_lstm_deep_rep2'}
2020-01-13 23:36:23,066 [INFO] Created tensorboard log directory: results_additional_exps/train_time_ids18_subset_lstm_deep_rep2/tf_logs_run_2020_01_13-23_36_23
2020-01-13 23:36:23,066 [INFO] Loading datsets from: ../Datasets/small_datasets/ids2018
2020-01-13 23:36:23,066 [INFO] Reading X, y files
2020-01-13 23:36:23,066 [INFO] Reading HDF dataset ../Datasets/small_datasets/ids2018/X_train.h5
2020-01-13 23:36:27,617 [INFO] Reading complete. time_to_read=4.55 seconds
2020-01-13 23:36:27,618 [INFO] Reading HDF dataset ../Datasets/small_datasets/ids2018/X_val.h5
2020-01-13 23:36:29,191 [INFO] Reading complete. time_to_read=1.57 seconds
2020-01-13 23:36:29,192 [INFO] Reading HDF dataset ../Datasets/small_datasets/ids2018/X_test.h5
2020-01-13 23:36:30,765 [INFO] Reading complete. time_to_read=1.57 seconds
2020-01-13 23:36:30,765 [INFO] Reading HDF dataset ../Datasets/small_datasets/ids2018/y_train.h5
2020-01-13 23:36:31,010 [INFO] Reading complete. time_to_read=0.25 seconds
2020-01-13 23:36:31,010 [INFO] Reading HDF dataset ../Datasets/small_datasets/ids2018/y_val.h5
2020-01-13 23:36:31,097 [INFO] Reading complete. time_to_read=0.09 seconds
2020-01-13 23:36:31,097 [INFO] Reading HDF dataset ../Datasets/small_datasets/ids2018/y_test.h5
2020-01-13 23:36:31,183 [INFO] Reading complete. time_to_read=0.09 seconds
2020-01-13 23:36:34,019 [INFO] Preparing flow sequences
2020-01-13 23:36:59,091 [INFO] Extracting flows complete. time_taken = 25.07 sec
2020-01-13 23:37:00,486 [INFO] Initializing model
2020-01-13 23:37:00,964 [INFO] _________________________________________________________________
2020-01-13 23:37:00,965 [INFO] Layer (type)                 Output Shape              Param #   
2020-01-13 23:37:00,965 [INFO] =================================================================
2020-01-13 23:37:00,965 [INFO] lstm_21 (LSTM)               (None, 32, 64)            36352     
2020-01-13 23:37:00,965 [INFO] _________________________________________________________________
2020-01-13 23:37:00,965 [INFO] batch_normalization_21 (Batc (None, 32, 64)            256       
2020-01-13 23:37:00,965 [INFO] _________________________________________________________________
2020-01-13 23:37:00,965 [INFO] dropout_21 (Dropout)         (None, 32, 64)            0         
2020-01-13 23:37:00,965 [INFO] _________________________________________________________________
2020-01-13 23:37:00,965 [INFO] lstm_22 (LSTM)               (None, 32, 32)            12416     
2020-01-13 23:37:00,965 [INFO] _________________________________________________________________
2020-01-13 23:37:00,965 [INFO] batch_normalization_22 (Batc (None, 32, 32)            128       
2020-01-13 23:37:00,965 [INFO] _________________________________________________________________
2020-01-13 23:37:00,965 [INFO] dropout_22 (Dropout)         (None, 32, 32)            0         
2020-01-13 23:37:00,965 [INFO] _________________________________________________________________
2020-01-13 23:37:00,965 [INFO] time_distributed_11 (TimeDis (None, 32, 15)            495       
2020-01-13 23:37:00,965 [INFO] =================================================================
2020-01-13 23:37:00,966 [INFO] Total params: 49,647
2020-01-13 23:37:00,966 [INFO] Trainable params: 49,455
2020-01-13 23:37:00,966 [INFO] Non-trainable params: 192
2020-01-13 23:37:00,966 [INFO] _________________________________________________________________
2020-01-13 23:37:00,966 [INFO] Training model
 - val_f1: 0.9762
 - out_of_sample_accuracy: 0.9814
Train on 60514 samples, validate on 20171 samples
Epoch 1/100
 - 17s - loss: 0.1400 - val_loss: 0.0546
 - val_f1: 0.7882
 - out_of_sample_accuracy: 0.8265
Epoch 2/100
 - 15s - loss: 0.0299 - val_loss: 0.0221
 - val_f1: 0.9377
 - out_of_sample_accuracy: 0.9493
Epoch 3/100
 - 15s - loss: 0.0176 - val_loss: 0.0141
 - val_f1: 0.9574
 - out_of_sample_accuracy: 0.9636
Epoch 4/100
 - 15s - loss: 0.0141 - val_loss: 0.0121
 - val_f1: 0.9630
 - out_of_sample_accuracy: 0.9671
Epoch 5/100
 - 15s - loss: 0.0124 - val_loss: 0.0101
 - val_f1: 0.9738
 - out_of_sample_accuracy: 0.9778
Epoch 6/100
 - 15s - loss: 0.0114 - val_loss: 0.0097
 - val_f1: 0.9753
 - out_of_sample_accuracy: 0.9797
Epoch 7/100
 - 15s - loss: 0.0109 - val_loss: 0.0094
 - val_f1: 0.9757
 - out_of_sample_accuracy: 0.9800
Epoch 8/100
 - 15s - loss: 0.0105 - val_loss: 0.0093
 - val_f1: 0.9758
 - out_of_sample_accuracy: 0.9802
Epoch 9/100
 - 15s - loss: 0.0101 - val_loss: 0.0090
 - val_f1: 0.9762
 - out_of_sample_accuracy: 0.9805
Epoch 10/100
 - 15s - loss: 0.0097 - val_loss: 0.0088
 - val_f1: 0.9764
 - out_of_sample_accuracy: 0.9806
Epoch 11/100
 - 15s - loss: 0.0094 - val_loss: 0.0087
/home/hasitha/anaconda3/lib/python3.7/site-packages/sklearn/metrics/classification.py:1143: UndefinedMetricWarning: F-score is ill-defined and being set to 0.0 in labels with no predicted samples.
  'precision', 'predicted', average, warn_for)
2020-01-13 23:41:09,900 [INFO] epoch = 10. Intermediate model saved to results_additional_exps/train_time_ids18_subset_lstm_deep_rep2/_model_epoch_10.pickle
 - val_f1: 0.9765
 - out_of_sample_accuracy: 0.9808
Epoch 12/100
 - 15s - loss: 0.0092 - val_loss: 0.0088
 - val_f1: 0.9764
 - out_of_sample_accuracy: 0.9811
Epoch 13/100
 - 15s - loss: 0.0091 - val_loss: 0.0086
 - val_f1: 0.9767
 - out_of_sample_accuracy: 0.9817
Epoch 14/100
 - 15s - loss: 0.0090 - val_loss: 0.0087
 - val_f1: 0.9773
 - out_of_sample_accuracy: 0.9823
Epoch 15/100
 - 15s - loss: 0.0089 - val_loss: 0.0089
 - val_f1: 0.9758
 - out_of_sample_accuracy: 0.9808
Epoch 16/100
 - 15s - loss: 0.0089 - val_loss: 0.0084
 - val_f1: 0.9772
 - out_of_sample_accuracy: 0.9821
Epoch 17/100
 - 15s - loss: 0.0088 - val_loss: 0.0084
 - val_f1: 0.9775
 - out_of_sample_accuracy: 0.9826
Epoch 18/100
 - 15s - loss: 0.0087 - val_loss: 0.0090
 - val_f1: 0.9766
 - out_of_sample_accuracy: 0.9817
Epoch 19/100
 - 15s - loss: 0.0087 - val_loss: 0.0100
 - val_f1: 0.9731
 - out_of_sample_accuracy: 0.9782
Epoch 20/100
 - 15s - loss: 0.0086 - val_loss: 0.0086
 - val_f1: 0.9774
 - out_of_sample_accuracy: 0.9825
Epoch 21/100
 - 15s - loss: 0.0085 - val_loss: 0.0086
2020-01-13 23:44:50,145 [INFO] epoch = 20. Intermediate model saved to results_additional_exps/train_time_ids18_subset_lstm_deep_rep2/_model_epoch_20.pickle
 - val_f1: 0.9774
 - out_of_sample_accuracy: 0.9825
Epoch 22/100
 - 15s - loss: 0.0085 - val_loss: 0.0085
 - val_f1: 0.9773
 - out_of_sample_accuracy: 0.9824
Epoch 23/100
 - 15s - loss: 0.0085 - val_loss: 0.0088
 - val_f1: 0.9766
 - out_of_sample_accuracy: 0.9816
Epoch 24/100
 - 15s - loss: 0.0084 - val_loss: 0.0084
 - val_f1: 0.9774
 - out_of_sample_accuracy: 0.9826
Epoch 25/100
 - 15s - loss: 0.0084 - val_loss: 0.0086
 - val_f1: 0.9771
 - out_of_sample_accuracy: 0.9821
Epoch 26/100
 - 15s - loss: 0.0084 - val_loss: 0.0085
 - val_f1: 0.9772
 - out_of_sample_accuracy: 0.9822
Epoch 27/100
 - 15s - loss: 0.0083 - val_loss: 0.0084
 - val_f1: 0.9774
 - out_of_sample_accuracy: 0.9826
Epoch 28/100
 - 15s - loss: 0.0083 - val_loss: 0.0095
 - val_f1: 0.9735
 - out_of_sample_accuracy: 0.9787
Epoch 29/100
 - 15s - loss: 0.0083 - val_loss: 0.0082
 - val_f1: 0.9774
 - out_of_sample_accuracy: 0.9825
Epoch 30/100
 - 15s - loss: 0.0082 - val_loss: 0.0082
 - val_f1: 0.9774
 - out_of_sample_accuracy: 0.9826
Epoch 31/100
 - 15s - loss: 0.0082 - val_loss: 0.0082
2020-01-13 23:48:30,259 [INFO] epoch = 30. Intermediate model saved to results_additional_exps/train_time_ids18_subset_lstm_deep_rep2/_model_epoch_30.pickle
 - val_f1: 0.9776
 - out_of_sample_accuracy: 0.9828
Epoch 32/100
 - 15s - loss: 0.0082 - val_loss: 0.0083
 - val_f1: 0.9772
 - out_of_sample_accuracy: 0.9824
Epoch 33/100
 - 15s - loss: 0.0082 - val_loss: 0.0081
 - val_f1: 0.9776
 - out_of_sample_accuracy: 0.9828
Epoch 34/100
 - 15s - loss: 0.0081 - val_loss: 0.0084
 - val_f1: 0.9771
 - out_of_sample_accuracy: 0.9824
Epoch 35/100
 - 15s - loss: 0.0081 - val_loss: 0.0083
 - val_f1: 0.9772
 - out_of_sample_accuracy: 0.9824
Epoch 36/100
 - 15s - loss: 0.0081 - val_loss: 0.0082
 - val_f1: 0.9775
 - out_of_sample_accuracy: 0.9827
Epoch 37/100
 - 15s - loss: 0.0081 - val_loss: 0.0082
 - val_f1: 0.9774
 - out_of_sample_accuracy: 0.9826
Epoch 38/100
 - 15s - loss: 0.0081 - val_loss: 0.0082
 - val_f1: 0.9774
 - out_of_sample_accuracy: 0.9826
Epoch 39/100
 - 15s - loss: 0.0081 - val_loss: 0.0081
 - val_f1: 0.9775
 - out_of_sample_accuracy: 0.9827
Epoch 40/100
 - 15s - loss: 0.0081 - val_loss: 0.0082
 - val_f1: 0.9773
 - out_of_sample_accuracy: 0.9825
Epoch 41/100
 - 15s - loss: 0.0081 - val_loss: 0.0081
2020-01-13 23:52:10,118 [INFO] epoch = 40. Intermediate model saved to results_additional_exps/train_time_ids18_subset_lstm_deep_rep2/_model_epoch_40.pickle
 - val_f1: 0.9774
 - out_of_sample_accuracy: 0.9826
Epoch 42/100
 - 15s - loss: 0.0081 - val_loss: 0.0081
 - val_f1: 0.9775
 - out_of_sample_accuracy: 0.9828
Epoch 43/100
 - 15s - loss: 0.0080 - val_loss: 0.0080
 - val_f1: 0.9777
 - out_of_sample_accuracy: 0.9829
Epoch 44/100
 - 15s - loss: 0.0080 - val_loss: 0.0083
 - val_f1: 0.9771
 - out_of_sample_accuracy: 0.9823
Epoch 45/100
 - 15s - loss: 0.0080 - val_loss: 0.0080
 - val_f1: 0.9775
 - out_of_sample_accuracy: 0.9828
Epoch 46/100
 - 15s - loss: 0.0080 - val_loss: 0.0081
 - val_f1: 0.9778
 - out_of_sample_accuracy: 0.9830
Epoch 47/100
 - 15s - loss: 0.0080 - val_loss: 0.0081
 - val_f1: 0.9777
 - out_of_sample_accuracy: 0.9828
Epoch 48/100
 - 15s - loss: 0.0080 - val_loss: 0.0081
 - val_f1: 0.9775
 - out_of_sample_accuracy: 0.9827
Epoch 49/100
 - 15s - loss: 0.0080 - val_loss: 0.0080
 - val_f1: 0.9775
 - out_of_sample_accuracy: 0.9826
Epoch 50/100
 - 15s - loss: 0.0080 - val_loss: 0.0079
 - val_f1: 0.9777
 - out_of_sample_accuracy: 0.9829
Epoch 51/100
 - 15s - loss: 0.0080 - val_loss: 0.0080
2020-01-13 23:55:50,358 [INFO] epoch = 50. Intermediate model saved to results_additional_exps/train_time_ids18_subset_lstm_deep_rep2/_model_epoch_50.pickle
 - val_f1: 0.9775
 - out_of_sample_accuracy: 0.9827
Epoch 52/100
 - 15s - loss: 0.0080 - val_loss: 0.0079
 - val_f1: 0.9778
 - out_of_sample_accuracy: 0.9830
Epoch 53/100
 - 15s - loss: 0.0080 - val_loss: 0.0081
 - val_f1: 0.9773
 - out_of_sample_accuracy: 0.9825
Epoch 54/100
 - 15s - loss: 0.0079 - val_loss: 0.0079
 - val_f1: 0.9779
 - out_of_sample_accuracy: 0.9831
Epoch 55/100
 - 15s - loss: 0.0079 - val_loss: 0.0080
 - val_f1: 0.9777
 - out_of_sample_accuracy: 0.9828
Epoch 56/100
 - 15s - loss: 0.0079 - val_loss: 0.0080
 - val_f1: 0.9776
 - out_of_sample_accuracy: 0.9828
Epoch 57/100
 - 15s - loss: 0.0079 - val_loss: 0.0080
 - val_f1: 0.9776
 - out_of_sample_accuracy: 0.9827
Epoch 58/100
 - 15s - loss: 0.0079 - val_loss: 0.0080
 - val_f1: 0.9775
 - out_of_sample_accuracy: 0.9827
Epoch 59/100
 - 15s - loss: 0.0079 - val_loss: 0.0081
 - val_f1: 0.9776
 - out_of_sample_accuracy: 0.9826
Epoch 60/100
 - 15s - loss: 0.0079 - val_loss: 0.0080
 - val_f1: 0.9779
 - out_of_sample_accuracy: 0.9830
Epoch 61/100
 - 15s - loss: 0.0079 - val_loss: 0.0080
2020-01-13 23:59:30,756 [INFO] epoch = 60. Intermediate model saved to results_additional_exps/train_time_ids18_subset_lstm_deep_rep2/_model_epoch_60.pickle
 - val_f1: 0.9778
 - out_of_sample_accuracy: 0.9830
Epoch 62/100
 - 15s - loss: 0.0079 - val_loss: 0.0080
 - val_f1: 0.9776
 - out_of_sample_accuracy: 0.9829
Epoch 63/100
 - 15s - loss: 0.0079 - val_loss: 0.0080
 - val_f1: 0.9778
 - out_of_sample_accuracy: 0.9829
Epoch 64/100
 - 15s - loss: 0.0079 - val_loss: 0.0080
 - val_f1: 0.9776
 - out_of_sample_accuracy: 0.9828
Epoch 65/100
 - 15s - loss: 0.0079 - val_loss: 0.0082
 - val_f1: 0.9772
 - out_of_sample_accuracy: 0.9824
Epoch 66/100
 - 15s - loss: 0.0079 - val_loss: 0.0081
 - val_f1: 0.9779
 - out_of_sample_accuracy: 0.9831
Epoch 67/100
 - 15s - loss: 0.0079 - val_loss: 0.0082
 - val_f1: 0.9772
 - out_of_sample_accuracy: 0.9823
Epoch 68/100
 - 15s - loss: 0.0078 - val_loss: 0.0082
 - val_f1: 0.9773
 - out_of_sample_accuracy: 0.9825
Epoch 69/100
 - 15s - loss: 0.0079 - val_loss: 0.0081
 - val_f1: 0.9778
 - out_of_sample_accuracy: 0.9829
Epoch 70/100
 - 15s - loss: 0.0079 - val_loss: 0.0082
 - val_f1: 0.9775
 - out_of_sample_accuracy: 0.9827
Epoch 71/100
 - 15s - loss: 0.0079 - val_loss: 0.0081
2020-01-14 00:03:11,013 [INFO] epoch = 70. Intermediate model saved to results_additional_exps/train_time_ids18_subset_lstm_deep_rep2/_model_epoch_70.pickle
 - val_f1: 0.9776
 - out_of_sample_accuracy: 0.9827
Epoch 72/100
 - 15s - loss: 0.0078 - val_loss: 0.0081
 - val_f1: 0.9774
 - out_of_sample_accuracy: 0.9825
Epoch 73/100
 - 15s - loss: 0.0078 - val_loss: 0.0082
 - val_f1: 0.9775
 - out_of_sample_accuracy: 0.9827
Epoch 74/100
 - 15s - loss: 0.0078 - val_loss: 0.0082
 - val_f1: 0.9777
 - out_of_sample_accuracy: 0.9828
Epoch 75/100
 - 15s - loss: 0.0078 - val_loss: 0.0080
 - val_f1: 0.9778
 - out_of_sample_accuracy: 0.9829
Epoch 76/100
 - 15s - loss: 0.0078 - val_loss: 0.0081
 - val_f1: 0.9777
 - out_of_sample_accuracy: 0.9828
Epoch 77/100
 - 15s - loss: 0.0078 - val_loss: 0.0080
 - val_f1: 0.9779
 - out_of_sample_accuracy: 0.9830
Epoch 78/100
 - 15s - loss: 0.0078 - val_loss: 0.0083
 - val_f1: 0.9773
 - out_of_sample_accuracy: 0.9825
Epoch 79/100
 - 15s - loss: 0.0078 - val_loss: 0.0082
 - val_f1: 0.9778
 - out_of_sample_accuracy: 0.9829
Epoch 80/100
 - 15s - loss: 0.0078 - val_loss: 0.0083
 - val_f1: 0.9778
 - out_of_sample_accuracy: 0.9828
Epoch 81/100
 - 15s - loss: 0.0078 - val_loss: 0.0080
2020-01-14 00:06:50,999 [INFO] epoch = 80. Intermediate model saved to results_additional_exps/train_time_ids18_subset_lstm_deep_rep2/_model_epoch_80.pickle
 - val_f1: 0.9781
 - out_of_sample_accuracy: 0.9831
Epoch 82/100
 - 15s - loss: 0.0078 - val_loss: 0.0081
 - val_f1: 0.9780
 - out_of_sample_accuracy: 0.9830
Epoch 83/100
 - 15s - loss: 0.0078 - val_loss: 0.0083
 - val_f1: 0.9780
 - out_of_sample_accuracy: 0.9830
Epoch 84/100
 - 15s - loss: 0.0078 - val_loss: 0.0082
 - val_f1: 0.9779
 - out_of_sample_accuracy: 0.9830
Epoch 85/100
 - 15s - loss: 0.0078 - val_loss: 0.0082
 - val_f1: 0.9775
 - out_of_sample_accuracy: 0.9828
Epoch 86/100
 - 15s - loss: 0.0078 - val_loss: 0.0081
 - val_f1: 0.9780
 - out_of_sample_accuracy: 0.9831
Epoch 87/100
 - 15s - loss: 0.0078 - val_loss: 0.0081
 - val_f1: 0.9776
 - out_of_sample_accuracy: 0.9826
Epoch 88/100
 - 15s - loss: 0.0078 - val_loss: 0.0079
 - val_f1: 0.9780
 - out_of_sample_accuracy: 0.9832
Epoch 89/100
 - 15s - loss: 0.0078 - val_loss: 0.0080
2020-01-14 00:09:54,611 [INFO] StopperOnGoal: reached goal_metric (accuracy). Stopping training. goal_metric = 0.9833, current_metric = 0.9833, num_epochs = 89
2020-01-14 00:09:54,613 [INFO] WeightRestorer::on_train_end(): restoring best weights
2020-01-14 00:10:07,992 [INFO] Last epoch loss evaluation: train_loss = 0.007702, val_loss = 0.007870
2020-01-14 00:10:07,992 [INFO] Training complete. time_to_train = 1987.03 sec, 33.12 min
2020-01-14 00:10:07,999 [INFO] Model saved to results_additional_exps/train_time_ids18_subset_lstm_deep_rep2/best_model.pickle
2020-01-14 00:10:08,013 [INFO] Training history saved to: results_additional_exps/train_time_ids18_subset_lstm_deep_rep2/training_error_history.csv
/home/hasitha/anaconda3/lib/python3.7/site-packages/matplotlib/pyplot.py:514: RuntimeWarning: More than 20 figures have been opened. Figures created through the pyplot interface (`matplotlib.pyplot.figure`) are retained until explicitly closed and may consume too much memory. (To control this warning, see the rcParam `figure.max_open_warning`).
  max_open_warning, RuntimeWarning)
2020-01-14 00:10:08,213 [INFO] Plot saved to: results_additional_exps/train_time_ids18_subset_lstm_deep_rep2/training_error_history.png
2020-01-14 00:10:08,334 [INFO] Plot saved to: results_additional_exps/train_time_ids18_subset_lstm_deep_rep2/training_f1_history.png
2020-01-14 00:10:08,334 [INFO] Making predictions on training, validation, testing data
2020-01-14 00:10:23,287 [INFO] Making predictions complete. time_to_predict = 14.95 sec, 0.25 min
2020-01-14 00:10:23,358 [INFO] Evaluating predictions (results)
/home/hasitha/anaconda3/lib/python3.7/site-packages/sklearn/metrics/classification.py:1143: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples.
  'precision', 'predicted', average, warn_for)
2020-01-14 00:10:35,461 [INFO] Dataset: Testing. Classification report below
2020-01-14 00:10:35,461 [INFO] 
                          precision    recall  f1-score   support

                  Benign       0.99      1.00      0.99    535639
                     Bot       1.00      1.00      1.00     11465
        Brute Force -Web       1.00      0.08      0.15        24
        Brute Force -XSS       1.00      0.33      0.50         9
        DDOS attack-HOIC       1.00      1.00      1.00     27446
    DDOS attack-LOIC-UDP       0.69      0.97      0.81        67
  DDoS attacks-LOIC-HTTP       0.99      0.99      0.99     23008
   DoS attacks-GoldenEye       0.99      1.00      1.00      1651
        DoS attacks-Hulk       1.00      1.00      1.00     18477
DoS attacks-SlowHTTPTest       0.73      0.47      0.57      5596
   DoS attacks-Slowloris       0.91      0.96      0.94       440
          FTP-BruteForce       0.69      0.88      0.78      7718
           Infilteration       0.43      0.00      0.00      6403
           SQL Injection       0.00      0.00      0.00         4
          SSH-Bruteforce       1.00      1.00      1.00      7525

               micro avg       0.98      0.98      0.98    645472
               macro avg       0.83      0.71      0.72    645472
            weighted avg       0.98      0.98      0.98    645472

2020-01-14 00:10:35,461 [INFO] Overall accuracy (micro avg): 0.9832060879480442
/home/hasitha/sunanda/ids_experiments/utility.py:328: RuntimeWarning: invalid value encountered in true_divide
  PPV = TP / (TP + FP)    # Precision or positive predictive value
/home/hasitha/sunanda/ids_experiments/utility.py:332: RuntimeWarning: invalid value encountered in true_divide
  FDR = FP / (TP + FP)    # False discovery rate
2020-01-14 00:10:49,221 [INFO] Average metrics for Testing dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9832         0.9832                       0.9832                0.0012                   0.0168  0.9832
1     Macro avg        0.9978         0.8291                       0.7122                0.0045                   0.2878  0.7152
2  Weighted avg        0.9909         0.9778                       0.9832                0.0503                   0.0168  0.9780
2020-01-14 00:11:01,523 [INFO] Dataset: Validation. Classification report below
2020-01-14 00:11:01,524 [INFO] 
                          precision    recall  f1-score   support

                  Benign       0.99      1.00      0.99    535636
                     Bot       1.00      1.00      1.00     11464
        Brute Force -Web       1.00      0.16      0.28        25
        Brute Force -XSS       1.00      0.67      0.80         9
        DDOS attack-HOIC       1.00      1.00      1.00     27447
    DDOS attack-LOIC-UDP       0.71      0.91      0.80        68
  DDoS attacks-LOIC-HTTP       0.99      0.99      0.99     23009
   DoS attacks-GoldenEye       1.00      1.00      1.00      1651
        DoS attacks-Hulk       1.00      1.00      1.00     18478
DoS attacks-SlowHTTPTest       0.74      0.46      0.57      5596
   DoS attacks-Slowloris       0.92      0.96      0.94       439
          FTP-BruteForce       0.69      0.88      0.78      7718
           Infilteration       0.47      0.00      0.00      6403
           SQL Injection       0.00      0.00      0.00         4
          SSH-Bruteforce       1.00      1.00      1.00      7525

               micro avg       0.98      0.98      0.98    645472
               macro avg       0.83      0.74      0.74    645472
            weighted avg       0.98      0.98      0.98    645472

2020-01-14 00:11:01,524 [INFO] Overall accuracy (micro avg): 0.9832742551187348
2020-01-14 00:11:15,514 [INFO] Average metrics for Validation dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9833         0.9833                       0.9833                0.0012                   0.0167  0.9833
1     Macro avg        0.9978         0.8339                       0.7357                0.0045                   0.2643  0.7430
2  Weighted avg        0.9909         0.9783                       0.9833                0.0501                   0.0167  0.9780
2020-01-14 00:11:55,240 [INFO] Dataset: Training. Classification report below
2020-01-14 00:11:55,240 [INFO] 
                          precision    recall  f1-score   support

                  Benign       0.99      1.00      0.99   1606935
                     Bot       1.00      1.00      1.00     34396
        Brute Force -Web       0.62      0.14      0.22        73
        Brute Force -XSS       1.00      0.50      0.67        26
        DDOS attack-HOIC       1.00      1.00      1.00     82341
    DDOS attack-LOIC-UDP       0.72      0.93      0.81       203
  DDoS attacks-LOIC-HTTP       0.99      0.99      0.99     69029
   DoS attacks-GoldenEye       1.00      1.00      1.00      4954
        DoS attacks-Hulk       1.00      1.00      1.00     55435
DoS attacks-SlowHTTPTest       0.74      0.47      0.57     16787
   DoS attacks-Slowloris       0.95      0.98      0.97      1318
          FTP-BruteForce       0.70      0.88      0.78     23153
           Infilteration       0.61      0.00      0.00     19210
           SQL Injection       0.00      0.00      0.00        12
          SSH-Bruteforce       1.00      1.00      1.00     22576

               micro avg       0.98      0.98      0.98   1936448
               macro avg       0.82      0.73      0.73   1936448
            weighted avg       0.98      0.98      0.98   1936448

2020-01-14 00:11:55,240 [INFO] Overall accuracy (micro avg): 0.9834356512542552
2020-01-14 00:12:40,326 [INFO] Average metrics for Training dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9834         0.9834                       0.9834                0.0012                   0.0166  0.9834
1     Macro avg        0.9978         0.8215                       0.7261                0.0044                   0.2739  0.7338
2  Weighted avg        0.9911         0.9799                       0.9834                0.0498                   0.0166  0.9782
2020-01-14 00:12:40,358 [INFO] Results saved to: results_additional_exps/train_time_ids18_subset_lstm_deep_rep2/train_time_ids18_subset_lstm_deep_rep2_results.xlsx
2020-01-14 00:12:40,363 [INFO] ================= Finished running experiment no. 2 ================= 

2020-01-14 00:12:40,458 [INFO] Created directory: results_additional_exps/train_time_ids18_subset_lstm_deep_rep3
2020-01-14 00:12:40,459 [INFO] Initialized logging. log_filename = results_additional_exps/train_time_ids18_subset_lstm_deep_rep3/run_log.log
2020-01-14 00:12:40,459 [INFO] ================= Running experiment no. 3  ================= 

2020-01-14 00:12:40,459 [INFO] Experiment parameters given below
2020-01-14 00:12:40,459 [INFO] 
{'experiment_num': 3, 'results_dir': 'results_additional_exps/train_time_ids18_subset_lstm_deep_rep3', 'model': 'lstm', 'model_type': 'classifier', 'normal_label': 'BENIGN', 'lstm_time_steps': 32, 'lstm_layer_units': [64, 32], 'lstm_layer_activations': ['relu', 'relu'], 'lstm_layer_dropout_rates': [0.2, 0.2], 'batch_size': 256, 'epochs': 100, 'early_stop_patience': 100, 'goal_metric': 0.983310557, 'training_set': 'train_set_only', 'dataset_dir': '../Datasets/small_datasets/ids2018', 'description': 'train_time_ids18_subset_lstm_deep_rep3'}
2020-01-14 00:12:40,459 [INFO] Created tensorboard log directory: results_additional_exps/train_time_ids18_subset_lstm_deep_rep3/tf_logs_run_2020_01_14-00_12_40
2020-01-14 00:12:40,459 [INFO] Loading datsets from: ../Datasets/small_datasets/ids2018
2020-01-14 00:12:40,459 [INFO] Reading X, y files
2020-01-14 00:12:40,459 [INFO] Reading HDF dataset ../Datasets/small_datasets/ids2018/X_train.h5
2020-01-14 00:12:45,767 [INFO] Reading complete. time_to_read=5.31 seconds
2020-01-14 00:12:45,767 [INFO] Reading HDF dataset ../Datasets/small_datasets/ids2018/X_val.h5
2020-01-14 00:12:47,715 [INFO] Reading complete. time_to_read=1.95 seconds
2020-01-14 00:12:47,715 [INFO] Reading HDF dataset ../Datasets/small_datasets/ids2018/X_test.h5
2020-01-14 00:12:49,560 [INFO] Reading complete. time_to_read=1.85 seconds
2020-01-14 00:12:49,560 [INFO] Reading HDF dataset ../Datasets/small_datasets/ids2018/y_train.h5
2020-01-14 00:12:49,835 [INFO] Reading complete. time_to_read=0.27 seconds
2020-01-14 00:12:49,835 [INFO] Reading HDF dataset ../Datasets/small_datasets/ids2018/y_val.h5
2020-01-14 00:12:49,944 [INFO] Reading complete. time_to_read=0.11 seconds
2020-01-14 00:12:49,944 [INFO] Reading HDF dataset ../Datasets/small_datasets/ids2018/y_test.h5
2020-01-14 00:12:50,064 [INFO] Reading complete. time_to_read=0.12 seconds
2020-01-14 00:12:52,925 [INFO] Preparing flow sequences
2020-01-14 00:13:18,012 [INFO] Extracting flows complete. time_taken = 25.09 sec
2020-01-14 00:13:19,302 [INFO] Initializing model
2020-01-14 00:13:19,763 [INFO] _________________________________________________________________
2020-01-14 00:13:19,763 [INFO] Layer (type)                 Output Shape              Param #   
2020-01-14 00:13:19,763 [INFO] =================================================================
2020-01-14 00:13:19,763 [INFO] lstm_23 (LSTM)               (None, 32, 64)            36352     
2020-01-14 00:13:19,763 [INFO] _________________________________________________________________
2020-01-14 00:13:19,763 [INFO] batch_normalization_23 (Batc (None, 32, 64)            256       
2020-01-14 00:13:19,763 [INFO] _________________________________________________________________
2020-01-14 00:13:19,763 [INFO] dropout_23 (Dropout)         (None, 32, 64)            0         
2020-01-14 00:13:19,763 [INFO] _________________________________________________________________
2020-01-14 00:13:19,764 [INFO] lstm_24 (LSTM)               (None, 32, 32)            12416     
2020-01-14 00:13:19,764 [INFO] _________________________________________________________________
2020-01-14 00:13:19,764 [INFO] batch_normalization_24 (Batc (None, 32, 32)            128       
2020-01-14 00:13:19,764 [INFO] _________________________________________________________________
2020-01-14 00:13:19,764 [INFO] dropout_24 (Dropout)         (None, 32, 32)            0         
2020-01-14 00:13:19,764 [INFO] _________________________________________________________________
2020-01-14 00:13:19,764 [INFO] time_distributed_12 (TimeDis (None, 32, 15)            495       
2020-01-14 00:13:19,764 [INFO] =================================================================
2020-01-14 00:13:19,764 [INFO] Total params: 49,647
2020-01-14 00:13:19,764 [INFO] Trainable params: 49,455
2020-01-14 00:13:19,764 [INFO] Non-trainable params: 192
2020-01-14 00:13:19,764 [INFO] _________________________________________________________________
2020-01-14 00:13:19,764 [INFO] Training model
 - val_f1: 0.9782
 - out_of_sample_accuracy: 0.9833
Train on 60514 samples, validate on 20171 samples
Epoch 1/100
 - 17s - loss: 0.1700 - val_loss: 0.0929
 - val_f1: 0.7499
 - out_of_sample_accuracy: 0.8222
Epoch 2/100
 - 15s - loss: 0.0936 - val_loss: 0.0860
 - val_f1: 0.7500
 - out_of_sample_accuracy: 0.8231
Epoch 3/100
 - 15s - loss: 0.0893 - val_loss: 0.0827
 - val_f1: 0.7517
 - out_of_sample_accuracy: 0.8273
Epoch 4/100
 - 15s - loss: 0.0802 - val_loss: 0.0740
 - val_f1: 0.7523
 - out_of_sample_accuracy: 0.8285
Epoch 5/100
 - 15s - loss: 0.0704 - val_loss: 0.0650
 - val_f1: 0.7604
 - out_of_sample_accuracy: 0.8277
Epoch 6/100
 - 15s - loss: 0.0638 - val_loss: 0.0580
 - val_f1: 0.7752
 - out_of_sample_accuracy: 0.8253
Epoch 7/100
 - 15s - loss: 0.0588 - val_loss: 0.0529
 - val_f1: 0.7875
 - out_of_sample_accuracy: 0.8219
Epoch 8/100
 - 15s - loss: 0.0548 - val_loss: 0.0498
 - val_f1: 0.7934
 - out_of_sample_accuracy: 0.8207
Epoch 9/100
 - 15s - loss: 0.0516 - val_loss: 0.0466
 - val_f1: 0.7985
 - out_of_sample_accuracy: 0.8220
Epoch 10/100
 - 15s - loss: 0.0482 - val_loss: 0.0424
 - val_f1: 0.8073
 - out_of_sample_accuracy: 0.8258
Epoch 11/100
 - 15s - loss: 0.0444 - val_loss: 0.0376
/home/hasitha/anaconda3/lib/python3.7/site-packages/sklearn/metrics/classification.py:1143: UndefinedMetricWarning: F-score is ill-defined and being set to 0.0 in labels with no predicted samples.
  'precision', 'predicted', average, warn_for)
2020-01-14 00:17:29,166 [INFO] epoch = 10. Intermediate model saved to results_additional_exps/train_time_ids18_subset_lstm_deep_rep3/_model_epoch_10.pickle
 - val_f1: 0.8433
 - out_of_sample_accuracy: 0.8523
Epoch 12/100
 - 15s - loss: 0.0417 - val_loss: 0.0353
 - val_f1: 0.8723
 - out_of_sample_accuracy: 0.8788
Epoch 13/100
 - 15s - loss: 0.0375 - val_loss: 0.0306
 - val_f1: 0.9030
 - out_of_sample_accuracy: 0.9106
Epoch 14/100
 - 15s - loss: 0.0342 - val_loss: 0.0269
 - val_f1: 0.9153
 - out_of_sample_accuracy: 0.9234
Epoch 15/100
 - 15s - loss: 0.0314 - val_loss: 0.0236
 - val_f1: 0.9264
 - out_of_sample_accuracy: 0.9355
Epoch 16/100
 - 15s - loss: 0.0289 - val_loss: 0.0207
 - val_f1: 0.9367
 - out_of_sample_accuracy: 0.9448
Epoch 17/100
 - 15s - loss: 0.0263 - val_loss: 0.0189
 - val_f1: 0.9477
 - out_of_sample_accuracy: 0.9534
Epoch 18/100
 - 15s - loss: 0.0245 - val_loss: 0.0176
 - val_f1: 0.9515
 - out_of_sample_accuracy: 0.9572
Epoch 19/100
 - 15s - loss: 0.0226 - val_loss: 0.0162
 - val_f1: 0.9542
 - out_of_sample_accuracy: 0.9597
Epoch 20/100
 - 15s - loss: 0.0210 - val_loss: 0.0160
 - val_f1: 0.9543
 - out_of_sample_accuracy: 0.9605
Epoch 21/100
 - 15s - loss: 0.0199 - val_loss: 0.0159
2020-01-14 00:21:09,199 [INFO] epoch = 20. Intermediate model saved to results_additional_exps/train_time_ids18_subset_lstm_deep_rep3/_model_epoch_20.pickle
 - val_f1: 0.9518
 - out_of_sample_accuracy: 0.9593
Epoch 22/100
 - 15s - loss: 0.0189 - val_loss: 0.0146
 - val_f1: 0.9555
 - out_of_sample_accuracy: 0.9625
Epoch 23/100
 - 15s - loss: 0.0180 - val_loss: 0.0145
 - val_f1: 0.9566
 - out_of_sample_accuracy: 0.9632
Epoch 24/100
 - 15s - loss: 0.0172 - val_loss: 0.0128
 - val_f1: 0.9647
 - out_of_sample_accuracy: 0.9696
Epoch 25/100
 - 15s - loss: 0.0165 - val_loss: 0.0125
 - val_f1: 0.9653
 - out_of_sample_accuracy: 0.9705
Epoch 26/100
 - 15s - loss: 0.0159 - val_loss: 0.0118
 - val_f1: 0.9692
 - out_of_sample_accuracy: 0.9741
Epoch 27/100
 - 15s - loss: 0.0152 - val_loss: 0.0117
 - val_f1: 0.9688
 - out_of_sample_accuracy: 0.9736
Epoch 28/100
 - 15s - loss: 0.0146 - val_loss: 0.0110
 - val_f1: 0.9719
 - out_of_sample_accuracy: 0.9766
Epoch 29/100
 - 15s - loss: 0.0141 - val_loss: 0.0108
 - val_f1: 0.9722
 - out_of_sample_accuracy: 0.9770
Epoch 30/100
 - 15s - loss: 0.0136 - val_loss: 0.0106
 - val_f1: 0.9727
 - out_of_sample_accuracy: 0.9773
Epoch 31/100
 - 15s - loss: 0.0132 - val_loss: 0.0102
2020-01-14 00:24:49,347 [INFO] epoch = 30. Intermediate model saved to results_additional_exps/train_time_ids18_subset_lstm_deep_rep3/_model_epoch_30.pickle
 - val_f1: 0.9736
 - out_of_sample_accuracy: 0.9784
Epoch 32/100
 - 15s - loss: 0.0128 - val_loss: 0.0102
 - val_f1: 0.9737
 - out_of_sample_accuracy: 0.9785
Epoch 33/100
 - 15s - loss: 0.0125 - val_loss: 0.0102
 - val_f1: 0.9738
 - out_of_sample_accuracy: 0.9784
Epoch 34/100
 - 15s - loss: 0.0122 - val_loss: 0.0101
 - val_f1: 0.9744
 - out_of_sample_accuracy: 0.9791
Epoch 35/100
 - 15s - loss: 0.0119 - val_loss: 0.0098
 - val_f1: 0.9749
 - out_of_sample_accuracy: 0.9795
Epoch 36/100
 - 15s - loss: 0.0116 - val_loss: 0.0096
 - val_f1: 0.9752
 - out_of_sample_accuracy: 0.9799
Epoch 37/100
 - 15s - loss: 0.0113 - val_loss: 0.0098
 - val_f1: 0.9744
 - out_of_sample_accuracy: 0.9792
Epoch 38/100
 - 15s - loss: 0.0112 - val_loss: 0.0095
 - val_f1: 0.9757
 - out_of_sample_accuracy: 0.9804
Epoch 39/100
 - 15s - loss: 0.0109 - val_loss: 0.0095
 - val_f1: 0.9753
 - out_of_sample_accuracy: 0.9801
Epoch 40/100
 - 15s - loss: 0.0107 - val_loss: 0.0093
 - val_f1: 0.9756
 - out_of_sample_accuracy: 0.9803
Epoch 41/100
 - 15s - loss: 0.0106 - val_loss: 0.0094
2020-01-14 00:28:29,201 [INFO] epoch = 40. Intermediate model saved to results_additional_exps/train_time_ids18_subset_lstm_deep_rep3/_model_epoch_40.pickle
 - val_f1: 0.9754
 - out_of_sample_accuracy: 0.9803
Epoch 42/100
 - 15s - loss: 0.0104 - val_loss: 0.0092
 - val_f1: 0.9759
 - out_of_sample_accuracy: 0.9807
Epoch 43/100
 - 15s - loss: 0.0103 - val_loss: 0.0093
 - val_f1: 0.9756
 - out_of_sample_accuracy: 0.9805
Epoch 44/100
 - 15s - loss: 0.0102 - val_loss: 0.0092
 - val_f1: 0.9757
 - out_of_sample_accuracy: 0.9805
Epoch 45/100
 - 15s - loss: 0.0101 - val_loss: 0.0097
 - val_f1: 0.9753
 - out_of_sample_accuracy: 0.9798
Epoch 46/100
 - 15s - loss: 0.0099 - val_loss: 0.0102
 - val_f1: 0.9732
 - out_of_sample_accuracy: 0.9772
Epoch 47/100
 - 15s - loss: 0.0098 - val_loss: 0.0100
 - val_f1: 0.9736
 - out_of_sample_accuracy: 0.9782
Epoch 48/100
 - 15s - loss: 0.0098 - val_loss: 0.0097
 - val_f1: 0.9746
 - out_of_sample_accuracy: 0.9790
Epoch 49/100
 - 15s - loss: 0.0097 - val_loss: 0.0096
 - val_f1: 0.9751
 - out_of_sample_accuracy: 0.9796
Epoch 50/100
 - 15s - loss: 0.0096 - val_loss: 0.0093
 - val_f1: 0.9759
 - out_of_sample_accuracy: 0.9805
Epoch 51/100
 - 15s - loss: 0.0095 - val_loss: 0.0093
2020-01-14 00:32:09,042 [INFO] epoch = 50. Intermediate model saved to results_additional_exps/train_time_ids18_subset_lstm_deep_rep3/_model_epoch_50.pickle
 - val_f1: 0.9760
 - out_of_sample_accuracy: 0.9806
Epoch 52/100
 - 15s - loss: 0.0096 - val_loss: 0.0101
 - val_f1: 0.9752
 - out_of_sample_accuracy: 0.9801
Epoch 53/100
 - 15s - loss: 0.0097 - val_loss: 0.0096
 - val_f1: 0.9754
 - out_of_sample_accuracy: 0.9802
Epoch 54/100
 - 15s - loss: 0.0095 - val_loss: 0.0096
 - val_f1: 0.9754
 - out_of_sample_accuracy: 0.9801
Epoch 55/100
 - 15s - loss: 0.0094 - val_loss: 0.0097
 - val_f1: 0.9752
 - out_of_sample_accuracy: 0.9797
Epoch 56/100
 - 15s - loss: 0.0093 - val_loss: 0.0093
 - val_f1: 0.9760
 - out_of_sample_accuracy: 0.9806
Epoch 57/100
 - 15s - loss: 0.0092 - val_loss: 0.0100
 - val_f1: 0.9736
 - out_of_sample_accuracy: 0.9780
Epoch 58/100
 - 15s - loss: 0.0092 - val_loss: 0.0095
 - val_f1: 0.9754
 - out_of_sample_accuracy: 0.9798
Epoch 59/100
 - 15s - loss: 0.0091 - val_loss: 0.0103
 - val_f1: 0.9703
 - out_of_sample_accuracy: 0.9751
Epoch 60/100
 - 15s - loss: 0.0091 - val_loss: 0.0095
 - val_f1: 0.9757
 - out_of_sample_accuracy: 0.9802
Epoch 61/100
 - 15s - loss: 0.0091 - val_loss: 0.0091
2020-01-14 00:35:48,823 [INFO] epoch = 60. Intermediate model saved to results_additional_exps/train_time_ids18_subset_lstm_deep_rep3/_model_epoch_60.pickle
 - val_f1: 0.9759
 - out_of_sample_accuracy: 0.9806
Epoch 62/100
 - 15s - loss: 0.0090 - val_loss: 0.0095
 - val_f1: 0.9750
 - out_of_sample_accuracy: 0.9797
Epoch 63/100
 - 15s - loss: 0.0090 - val_loss: 0.0094
 - val_f1: 0.9754
 - out_of_sample_accuracy: 0.9801
Epoch 64/100
 - 15s - loss: 0.0090 - val_loss: 0.0106
 - val_f1: 0.9713
 - out_of_sample_accuracy: 0.9763
Epoch 65/100
 - 15s - loss: 0.0089 - val_loss: 0.0091
 - val_f1: 0.9761
 - out_of_sample_accuracy: 0.9809
Epoch 66/100
 - 15s - loss: 0.0089 - val_loss: 0.0091
 - val_f1: 0.9747
 - out_of_sample_accuracy: 0.9792
Epoch 67/100
 - 15s - loss: 0.0089 - val_loss: 0.0090
 - val_f1: 0.9763
 - out_of_sample_accuracy: 0.9814
Epoch 68/100
 - 15s - loss: 0.0089 - val_loss: 0.0088
 - val_f1: 0.9765
 - out_of_sample_accuracy: 0.9815
Epoch 69/100
 - 15s - loss: 0.0089 - val_loss: 0.0102
 - val_f1: 0.9719
 - out_of_sample_accuracy: 0.9763
Epoch 70/100
 - 15s - loss: 0.0088 - val_loss: 0.0097
 - val_f1: 0.9739
 - out_of_sample_accuracy: 0.9787
Epoch 71/100
 - 15s - loss: 0.0088 - val_loss: 0.0095
2020-01-14 00:39:28,634 [INFO] epoch = 70. Intermediate model saved to results_additional_exps/train_time_ids18_subset_lstm_deep_rep3/_model_epoch_70.pickle
 - val_f1: 0.9746
 - out_of_sample_accuracy: 0.9797
Epoch 72/100
 - 15s - loss: 0.0088 - val_loss: 0.0092
 - val_f1: 0.9753
 - out_of_sample_accuracy: 0.9801
Epoch 73/100
 - 15s - loss: 0.0086 - val_loss: 0.0091
 - val_f1: 0.9755
 - out_of_sample_accuracy: 0.9806
Epoch 74/100
 - 15s - loss: 0.0086 - val_loss: 0.0087
 - val_f1: 0.9763
 - out_of_sample_accuracy: 0.9811
Epoch 75/100
 - 15s - loss: 0.0086 - val_loss: 0.0095
 - val_f1: 0.9736
 - out_of_sample_accuracy: 0.9787
Epoch 76/100
 - 15s - loss: 0.0086 - val_loss: 0.0093
 - val_f1: 0.9747
 - out_of_sample_accuracy: 0.9797
Epoch 77/100
 - 15s - loss: 0.0085 - val_loss: 0.0089
 - val_f1: 0.9760
 - out_of_sample_accuracy: 0.9810
Epoch 78/100
 - 15s - loss: 0.0085 - val_loss: 0.0088
 - val_f1: 0.9758
 - out_of_sample_accuracy: 0.9808
Epoch 79/100
 - 15s - loss: 0.0085 - val_loss: 0.0087
 - val_f1: 0.9762
 - out_of_sample_accuracy: 0.9811
Epoch 80/100
 - 15s - loss: 0.0084 - val_loss: 0.0088
 - val_f1: 0.9760
 - out_of_sample_accuracy: 0.9808
Epoch 81/100
 - 15s - loss: 0.0084 - val_loss: 0.0089
2020-01-14 00:43:08,340 [INFO] epoch = 80. Intermediate model saved to results_additional_exps/train_time_ids18_subset_lstm_deep_rep3/_model_epoch_80.pickle
 - val_f1: 0.9761
 - out_of_sample_accuracy: 0.9811
Epoch 82/100
 - 15s - loss: 0.0084 - val_loss: 0.0103
 - val_f1: 0.9694
 - out_of_sample_accuracy: 0.9749
Epoch 83/100
 - 15s - loss: 0.0084 - val_loss: 0.0101
 - val_f1: 0.9711
 - out_of_sample_accuracy: 0.9761
Epoch 84/100
 - 15s - loss: 0.0082 - val_loss: 0.0086
 - val_f1: 0.9763
 - out_of_sample_accuracy: 0.9813
Epoch 85/100
 - 15s - loss: 0.0082 - val_loss: 0.0083
 - val_f1: 0.9774
 - out_of_sample_accuracy: 0.9825
Epoch 86/100
 - 15s - loss: 0.0082 - val_loss: 0.0086
 - val_f1: 0.9764
 - out_of_sample_accuracy: 0.9816
Epoch 87/100
 - 15s - loss: 0.0081 - val_loss: 0.0086
 - val_f1: 0.9765
 - out_of_sample_accuracy: 0.9815
Epoch 88/100
 - 15s - loss: 0.0081 - val_loss: 0.0090
 - val_f1: 0.9751
 - out_of_sample_accuracy: 0.9799
Epoch 89/100
 - 15s - loss: 0.0081 - val_loss: 0.0083
 - val_f1: 0.9771
 - out_of_sample_accuracy: 0.9821
Epoch 90/100
 - 15s - loss: 0.0081 - val_loss: 0.0084
 - val_f1: 0.9767
 - out_of_sample_accuracy: 0.9819
Epoch 91/100
 - 15s - loss: 0.0081 - val_loss: 0.0082
2020-01-14 00:46:48,512 [INFO] epoch = 90. Intermediate model saved to results_additional_exps/train_time_ids18_subset_lstm_deep_rep3/_model_epoch_90.pickle
 - val_f1: 0.9774
 - out_of_sample_accuracy: 0.9825
Epoch 92/100
 - 15s - loss: 0.0081 - val_loss: 0.0082
 - val_f1: 0.9771
 - out_of_sample_accuracy: 0.9822
Epoch 93/100
 - 15s - loss: 0.0081 - val_loss: 0.0081
 - val_f1: 0.9775
 - out_of_sample_accuracy: 0.9826
Epoch 94/100
 - 15s - loss: 0.0080 - val_loss: 0.0083
 - val_f1: 0.9769
 - out_of_sample_accuracy: 0.9820
Epoch 95/100
 - 15s - loss: 0.0080 - val_loss: 0.0081
 - val_f1: 0.9776
 - out_of_sample_accuracy: 0.9827
Epoch 96/100
 - 15s - loss: 0.0080 - val_loss: 0.0082
 - val_f1: 0.9775
 - out_of_sample_accuracy: 0.9827
Epoch 97/100
 - 15s - loss: 0.0080 - val_loss: 0.0081
 - val_f1: 0.9776
 - out_of_sample_accuracy: 0.9828
Epoch 98/100
 - 15s - loss: 0.0080 - val_loss: 0.0083
 - val_f1: 0.9772
 - out_of_sample_accuracy: 0.9823
Epoch 99/100
 - 15s - loss: 0.0081 - val_loss: 0.0082
 - val_f1: 0.9773
 - out_of_sample_accuracy: 0.9823
Epoch 100/100
 - 15s - loss: 0.0080 - val_loss: 0.0083
2020-01-14 00:50:14,872 [INFO] StopperOnGoal: did not reach goal, num_epochs = 100
2020-01-14 00:50:14,872 [INFO] WeightRestorer::on_train_end(): restoring best weights
2020-01-14 00:50:28,541 [INFO] Last epoch loss evaluation: train_loss = 0.008040, val_loss = 0.008089
2020-01-14 00:50:28,541 [INFO] Training complete. time_to_train = 2228.78 sec, 37.15 min
2020-01-14 00:50:28,547 [INFO] Model saved to results_additional_exps/train_time_ids18_subset_lstm_deep_rep3/best_model.pickle
2020-01-14 00:50:28,549 [INFO] Training history saved to: results_additional_exps/train_time_ids18_subset_lstm_deep_rep3/training_error_history.csv
/home/hasitha/anaconda3/lib/python3.7/site-packages/matplotlib/pyplot.py:514: RuntimeWarning: More than 20 figures have been opened. Figures created through the pyplot interface (`matplotlib.pyplot.figure`) are retained until explicitly closed and may consume too much memory. (To control this warning, see the rcParam `figure.max_open_warning`).
  max_open_warning, RuntimeWarning)
2020-01-14 00:50:28,687 [INFO] Plot saved to: results_additional_exps/train_time_ids18_subset_lstm_deep_rep3/training_error_history.png
2020-01-14 00:50:28,805 [INFO] Plot saved to: results_additional_exps/train_time_ids18_subset_lstm_deep_rep3/training_f1_history.png
2020-01-14 00:50:28,805 [INFO] Making predictions on training, validation, testing data
2020-01-14 00:50:43,946 [INFO] Making predictions complete. time_to_predict = 15.14 sec, 0.25 min
2020-01-14 00:50:44,016 [INFO] Evaluating predictions (results)
/home/hasitha/anaconda3/lib/python3.7/site-packages/sklearn/metrics/classification.py:1143: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples.
  'precision', 'predicted', average, warn_for)
2020-01-14 00:50:56,088 [INFO] Dataset: Testing. Classification report below
2020-01-14 00:50:56,088 [INFO] 
                          precision    recall  f1-score   support

                  Benign       0.99      1.00      0.99    535639
                     Bot       1.00      1.00      1.00     11465
        Brute Force -Web       0.67      0.08      0.15        24
        Brute Force -XSS       1.00      0.33      0.50         9
        DDOS attack-HOIC       1.00      1.00      1.00     27446
    DDOS attack-LOIC-UDP       0.70      1.00      0.82        67
  DDoS attacks-LOIC-HTTP       1.00      0.98      0.99     23008
   DoS attacks-GoldenEye       0.99      0.98      0.98      1651
        DoS attacks-Hulk       1.00      1.00      1.00     18477
DoS attacks-SlowHTTPTest       0.72      0.46      0.56      5596
   DoS attacks-Slowloris       1.00      0.74      0.85       440
          FTP-BruteForce       0.69      0.87      0.77      7718
           Infilteration       0.60      0.00      0.00      6403
           SQL Injection       0.00      0.00      0.00         4
          SSH-Bruteforce       1.00      1.00      1.00      7525

               micro avg       0.98      0.98      0.98    645472
               macro avg       0.82      0.70      0.71    645472
            weighted avg       0.98      0.98      0.98    645472

2020-01-14 00:50:56,088 [INFO] Overall accuracy (micro avg): 0.9826483565514849
/home/hasitha/sunanda/ids_experiments/utility.py:328: RuntimeWarning: invalid value encountered in true_divide
  PPV = TP / (TP + FP)    # Precision or positive predictive value
/home/hasitha/sunanda/ids_experiments/utility.py:332: RuntimeWarning: invalid value encountered in true_divide
  FDR = FP / (TP + FP)    # False discovery rate
2020-01-14 00:51:09,786 [INFO] Average metrics for Testing dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9826         0.9826                       0.9826                0.0012                   0.0174  0.9826
1     Macro avg        0.9977         0.8229                       0.6961                0.0047                   0.3039  0.7077
2  Weighted avg        0.9906         0.9789                       0.9826                0.0530                   0.0174  0.9774
2020-01-14 00:51:22,047 [INFO] Dataset: Validation. Classification report below
2020-01-14 00:51:22,047 [INFO] 
                          precision    recall  f1-score   support

                  Benign       0.99      1.00      0.99    535636
                     Bot       1.00      1.00      1.00     11464
        Brute Force -Web       1.00      0.20      0.33        25
        Brute Force -XSS       0.86      0.67      0.75         9
        DDOS attack-HOIC       1.00      1.00      1.00     27447
    DDOS attack-LOIC-UDP       0.76      0.99      0.86        68
  DDoS attacks-LOIC-HTTP       1.00      0.98      0.99     23009
   DoS attacks-GoldenEye       1.00      0.98      0.99      1651
        DoS attacks-Hulk       1.00      1.00      1.00     18478
DoS attacks-SlowHTTPTest       0.72      0.46      0.56      5596
   DoS attacks-Slowloris       0.99      0.79      0.88       439
          FTP-BruteForce       0.69      0.87      0.77      7718
           Infilteration       0.42      0.00      0.00      6403
           SQL Injection       0.00      0.00      0.00         4
          SSH-Bruteforce       1.00      1.00      1.00      7525

               micro avg       0.98      0.98      0.98    645472
               macro avg       0.83      0.73      0.74    645472
            weighted avg       0.98      0.98      0.98    645472

2020-01-14 00:51:22,047 [INFO] Overall accuracy (micro avg): 0.9827769446234693
2020-01-14 00:51:35,976 [INFO] Average metrics for Validation dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9828         0.9828                       0.9828                0.0012                   0.0172  0.9828
1     Macro avg        0.9977         0.8275                       0.7290                0.0046                   0.2710  0.7414
2  Weighted avg        0.9907         0.9772                       0.9828                0.0525                   0.0172  0.9775
2020-01-14 00:52:15,732 [INFO] Dataset: Training. Classification report below
2020-01-14 00:52:15,732 [INFO] 
                          precision    recall  f1-score   support

                  Benign       0.99      1.00      0.99   1606935
                     Bot       1.00      1.00      1.00     34396
        Brute Force -Web       1.00      0.12      0.22        73
        Brute Force -XSS       0.93      0.50      0.65        26
        DDOS attack-HOIC       1.00      1.00      1.00     82341
    DDOS attack-LOIC-UDP       0.72      0.98      0.83       203
  DDoS attacks-LOIC-HTTP       1.00      0.98      0.99     69029
   DoS attacks-GoldenEye       0.99      0.98      0.99      4954
        DoS attacks-Hulk       1.00      1.00      1.00     55435
DoS attacks-SlowHTTPTest       0.72      0.46      0.56     16787
   DoS attacks-Slowloris       1.00      0.78      0.87      1318
          FTP-BruteForce       0.69      0.87      0.77     23153
           Infilteration       0.47      0.00      0.00     19210
           SQL Injection       0.00      0.00      0.00        12
          SSH-Bruteforce       1.00      1.00      1.00     22576

               micro avg       0.98      0.98      0.98   1936448
               macro avg       0.83      0.71      0.72   1936448
            weighted avg       0.98      0.98      0.98   1936448

2020-01-14 00:52:15,733 [INFO] Overall accuracy (micro avg): 0.9827787784644876
2020-01-14 00:53:00,850 [INFO] Average metrics for Training dataset below
   average type  avg accuracy  avg precision  avg detection rate (recall)  avg false alarm rate  avg false negative rate  avg f1
0     Micro avg        0.9828         0.9828                       0.9828                0.0012                   0.0172  0.9828
1     Macro avg        0.9977         0.8334                       0.7113                0.0047                   0.2887  0.7245
2  Weighted avg        0.9907         0.9778                       0.9828                0.0526                   0.0172  0.9775
2020-01-14 00:53:00,877 [INFO] Results saved to: results_additional_exps/train_time_ids18_subset_lstm_deep_rep3/train_time_ids18_subset_lstm_deep_rep3_results.xlsx
2020-01-14 00:53:00,882 [INFO] ================= Finished running experiment no. 3 ================= 

2020-01-14 00:53:00,980 [INFO] ================= Finished running 12 experiments ================= 

 - val_f1: 0.9772
 - out_of_sample_accuracy: 0.9824
